!function(){var e=this,t=e._,i={},n=Array.prototype,s=Object.prototype,r=Function.prototype,o=n.push,a=n.slice,l=n.concat,c=s.toString,h=s.hasOwnProperty,u=n.forEach,d=n.map,p=n.reduce,f=n.reduceRight,m=n.filter,g=n.every,v=n.some,b=n.indexOf,_=n.lastIndexOf,y=Array.isArray,w=Object.keys,k=r.bind,S=function(e){return e instanceof S?e:this instanceof S?(this._wrapped=e,void 0):new S(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=S),exports._=S):e._=S,S.VERSION="1.4.4";var x=S.each=S.forEach=function(e,t,n){if(null!=e)if(u&&e.forEach===u)e.forEach(t,n);else if(e.length===+e.length){for(var s=0,r=e.length;r>s;s++)if(t.call(n,e[s],s,e)===i)return}else for(var o in e)if(S.has(e,o)&&t.call(n,e[o],o,e)===i)return};S.map=S.collect=function(e,t,i){var n=[];return null==e?n:d&&e.map===d?e.map(t,i):(x(e,function(e,s,r){n[n.length]=t.call(i,e,s,r)}),n)};var P="Reduce of empty array with no initial value";S.reduce=S.foldl=S.inject=function(e,t,i,n){var s=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return n&&(t=S.bind(t,n)),s?e.reduce(t,i):e.reduce(t);if(x(e,function(e,r,o){s?i=t.call(n,i,e,r,o):(i=e,s=!0)}),!s)throw new TypeError(P);return i},S.reduceRight=S.foldr=function(e,t,i,n){var s=arguments.length>2;if(null==e&&(e=[]),f&&e.reduceRight===f)return n&&(t=S.bind(t,n)),s?e.reduceRight(t,i):e.reduceRight(t);var r=e.length;if(r!==+r){var o=S.keys(e);r=o.length}if(x(e,function(a,l,c){l=o?o[--r]:--r,s?i=t.call(n,i,e[l],l,c):(i=e[l],s=!0)}),!s)throw new TypeError(P);return i},S.find=S.detect=function(e,t,i){var n;return C(e,function(e,s,r){return t.call(i,e,s,r)?(n=e,!0):void 0}),n},S.filter=S.select=function(e,t,i){var n=[];return null==e?n:m&&e.filter===m?e.filter(t,i):(x(e,function(e,s,r){t.call(i,e,s,r)&&(n[n.length]=e)}),n)},S.reject=function(e,t,i){return S.filter(e,function(e,n,s){return!t.call(i,e,n,s)},i)},S.every=S.all=function(e,t,n){t||(t=S.identity);var s=!0;return null==e?s:g&&e.every===g?e.every(t,n):(x(e,function(e,r,o){return(s=s&&t.call(n,e,r,o))?void 0:i}),!!s)};var C=S.some=S.any=function(e,t,n){t||(t=S.identity);var s=!1;return null==e?s:v&&e.some===v?e.some(t,n):(x(e,function(e,r,o){return s||(s=t.call(n,e,r,o))?i:void 0}),!!s)};S.contains=S.include=function(e,t){return null==e?!1:b&&e.indexOf===b?-1!=e.indexOf(t):C(e,function(e){return e===t})},S.invoke=function(e,t){var i=a.call(arguments,2),n=S.isFunction(t);return S.map(e,function(e){return(n?t:e[t]).apply(e,i)})},S.pluck=function(e,t){return S.map(e,function(e){return e[t]})},S.where=function(e,t,i){return S.isEmpty(t)?i?null:[]:S[i?"find":"filter"](e,function(e){for(var i in t)if(t[i]!==e[i])return!1;return!0})},S.findWhere=function(e,t){return S.where(e,t,!0)},S.max=function(e,t,i){if(!t&&S.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&S.isEmpty(e))return-1/0;var n={computed:-1/0,value:-1/0};return x(e,function(e,s,r){var o=t?t.call(i,e,s,r):e;o>=n.computed&&(n={value:e,computed:o})}),n.value},S.min=function(e,t,i){if(!t&&S.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&S.isEmpty(e))return 1/0;var n={computed:1/0,value:1/0};return x(e,function(e,s,r){var o=t?t.call(i,e,s,r):e;o<n.computed&&(n={value:e,computed:o})}),n.value},S.shuffle=function(e){var t,i=0,n=[];return x(e,function(e){t=S.random(i++),n[i-1]=n[t],n[t]=e}),n};var T=function(e){return S.isFunction(e)?e:function(t){return t[e]}};S.sortBy=function(e,t,i){var n=T(t);return S.pluck(S.map(e,function(e,t,s){return{value:e,index:t,criteria:n.call(i,e,t,s)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return e.index<t.index?-1:1}),"value")};var N=function(e,t,i,n){var s={},r=T(t||S.identity);return x(e,function(t,o){var a=r.call(i,t,o,e);n(s,a,t)}),s};S.groupBy=function(e,t,i){return N(e,t,i,function(e,t,i){(S.has(e,t)?e[t]:e[t]=[]).push(i)})},S.countBy=function(e,t,i){return N(e,t,i,function(e,t){S.has(e,t)||(e[t]=0),e[t]++})},S.sortedIndex=function(e,t,i,n){i=null==i?S.identity:T(i);for(var s=i.call(n,t),r=0,o=e.length;o>r;){var a=r+o>>>1;i.call(n,e[a])<s?r=a+1:o=a}return r},S.toArray=function(e){return e?S.isArray(e)?a.call(e):e.length===+e.length?S.map(e,S.identity):S.values(e):[]},S.size=function(e){return null==e?0:e.length===+e.length?e.length:S.keys(e).length},S.first=S.head=S.take=function(e,t,i){return null==e?void 0:null==t||i?e[0]:a.call(e,0,t)},S.initial=function(e,t,i){return a.call(e,0,e.length-(null==t||i?1:t))},S.last=function(e,t,i){return null==e?void 0:null==t||i?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},S.rest=S.tail=S.drop=function(e,t,i){return a.call(e,null==t||i?1:t)},S.compact=function(e){return S.filter(e,S.identity)};var E=function(e,t,i){return x(e,function(e){S.isArray(e)?t?o.apply(i,e):E(e,t,i):i.push(e)}),i};S.flatten=function(e,t){return E(e,t,[])},S.without=function(e){return S.difference(e,a.call(arguments,1))},S.uniq=S.unique=function(e,t,i,n){S.isFunction(t)&&(n=i,i=t,t=!1);var s=i?S.map(e,i,n):e,r=[],o=[];return x(s,function(i,n){(t?n&&o[o.length-1]===i:S.contains(o,i))||(o.push(i),r.push(e[n]))}),r},S.union=function(){return S.uniq(l.apply(n,arguments))},S.intersection=function(e){var t=a.call(arguments,1);return S.filter(S.uniq(e),function(e){return S.every(t,function(t){return S.indexOf(t,e)>=0})})},S.difference=function(e){var t=l.apply(n,a.call(arguments,1));return S.filter(e,function(e){return!S.contains(t,e)})},S.zip=function(){for(var e=a.call(arguments),t=S.max(S.pluck(e,"length")),i=new Array(t),n=0;t>n;n++)i[n]=S.pluck(e,""+n);return i},S.object=function(e,t){if(null==e)return{};for(var i={},n=0,s=e.length;s>n;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},S.indexOf=function(e,t,i){if(null==e)return-1;var n=0,s=e.length;if(i){if("number"!=typeof i)return n=S.sortedIndex(e,t),e[n]===t?n:-1;n=0>i?Math.max(0,s+i):i}if(b&&e.indexOf===b)return e.indexOf(t,i);for(;s>n;n++)if(e[n]===t)return n;return-1},S.lastIndexOf=function(e,t,i){if(null==e)return-1;var n=null!=i;if(_&&e.lastIndexOf===_)return n?e.lastIndexOf(t,i):e.lastIndexOf(t);for(var s=n?i:e.length;s--;)if(e[s]===t)return s;return-1},S.range=function(e,t,i){arguments.length<=1&&(t=e||0,e=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((t-e)/i),0),s=0,r=new Array(n);n>s;)r[s++]=e,e+=i;return r},S.bind=function(e,t){if(e.bind===k&&k)return k.apply(e,a.call(arguments,1));var i=a.call(arguments,2);return function(){return e.apply(t,i.concat(a.call(arguments)))}},S.partial=function(e){var t=a.call(arguments,1);return function(){return e.apply(this,t.concat(a.call(arguments)))}},S.bindAll=function(e){var t=a.call(arguments,1);return 0===t.length&&(t=S.functions(e)),x(t,function(t){e[t]=S.bind(e[t],e)}),e},S.memoize=function(e,t){var i={};return t||(t=S.identity),function(){var n=t.apply(this,arguments);return S.has(i,n)?i[n]:i[n]=e.apply(this,arguments)}},S.delay=function(e,t){var i=a.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(a.call(arguments,1)))},S.throttle=function(e,t){var i,n,s,r,o=0,a=function(){o=new Date,s=null,r=e.apply(i,n)};return function(){var l=new Date,c=t-(l-o);return i=this,n=arguments,0>=c?(clearTimeout(s),s=null,o=l,r=e.apply(i,n)):s||(s=setTimeout(a,c)),r}},S.debounce=function(e,t,i){var n,s;return function(){var r=this,o=arguments,a=function(){n=null,i||(s=e.apply(r,o))},l=i&&!n;return clearTimeout(n),n=setTimeout(a,t),l&&(s=e.apply(r,o)),s}},S.once=function(e){var t,i=!1;return function(){return i?t:(i=!0,t=e.apply(this,arguments),e=null,t)}},S.wrap=function(e,t){return function(){var i=[e];return o.apply(i,arguments),t.apply(this,i)}},S.compose=function(){var e=arguments;return function(){for(var t=arguments,i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},S.after=function(e,t){return 0>=e?t():function(){return--e<1?t.apply(this,arguments):void 0}},S.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var i in e)S.has(e,i)&&(t[t.length]=i);return t},S.values=function(e){var t=[];for(var i in e)S.has(e,i)&&t.push(e[i]);return t},S.pairs=function(e){var t=[];for(var i in e)S.has(e,i)&&t.push([i,e[i]]);return t},S.invert=function(e){var t={};for(var i in e)S.has(e,i)&&(t[e[i]]=i);return t},S.functions=S.methods=function(e){var t=[];for(var i in e)S.isFunction(e[i])&&t.push(i);return t.sort()},S.extend=function(e){return x(a.call(arguments,1),function(t){if(t)for(var i in t)e[i]=t[i]}),e},S.pick=function(e){var t={},i=l.apply(n,a.call(arguments,1));return x(i,function(i){i in e&&(t[i]=e[i])}),t},S.omit=function(e){var t={},i=l.apply(n,a.call(arguments,1));for(var s in e)S.contains(i,s)||(t[s]=e[s]);return t},S.defaults=function(e){return x(a.call(arguments,1),function(t){if(t)for(var i in t)null==e[i]&&(e[i]=t[i])}),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.tap=function(e,t){return t(e),e};var I=function(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof S&&(e=e._wrapped),t instanceof S&&(t=t._wrapped);var s=c.call(e);if(s!=c.call(t))return!1;switch(s){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var r=i.length;r--;)if(i[r]==e)return n[r]==t;i.push(e),n.push(t);var o=0,a=!0;if("[object Array]"==s){if(o=e.length,a=o==t.length)for(;o--&&(a=I(e[o],t[o],i,n)););}else{var l=e.constructor,h=t.constructor;if(l!==h&&!(S.isFunction(l)&&l instanceof l&&S.isFunction(h)&&h instanceof h))return!1;for(var u in e)if(S.has(e,u)&&(o++,!(a=S.has(t,u)&&I(e[u],t[u],i,n))))break;if(a){for(u in t)if(S.has(t,u)&&!o--)break;a=!o}}return i.pop(),n.pop(),a};S.isEqual=function(e,t){return I(e,t,[],[])},S.isEmpty=function(e){if(null==e)return!0;if(S.isArray(e)||S.isString(e))return 0===e.length;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!(!e||1!==e.nodeType)},S.isArray=y||function(e){return"[object Array]"==c.call(e)},S.isObject=function(e){return e===Object(e)},x(["Arguments","Function","String","Number","Date","RegExp"],function(e){S["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),S.isArguments(arguments)||(S.isArguments=function(e){return!(!e||!S.has(e,"callee"))}),"function"!=typeof/./&&(S.isFunction=function(e){return"function"==typeof e}),S.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},S.isNaN=function(e){return S.isNumber(e)&&e!=+e},S.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==c.call(e)},S.isNull=function(e){return null===e},S.isUndefined=function(e){return void 0===e},S.has=function(e,t){return h.call(e,t)},S.noConflict=function(){return e._=t,this},S.identity=function(e){return e},S.times=function(e,t,i){for(var n=Array(e),s=0;e>s;s++)n[s]=t.call(i,s);return n},S.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=S.invert(M.escape);var A={escape:new RegExp("["+S.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+S.keys(M.unescape).join("|")+")","g")};S.each(["escape","unescape"],function(e){S[e]=function(t){return null==t?"":(""+t).replace(A[e],function(t){return M[e][t]})}}),S.result=function(e,t){if(null==e)return null;var i=e[t];return S.isFunction(i)?i.call(e):i},S.mixin=function(e){x(S.functions(e),function(t){var i=S[t]=e[t];S.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),R.call(this,i.apply(S,e))}})};var O=0;S.uniqueId=function(e){var t=++O+"";return e?e+t:t},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,$={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},H=/\\|'|\r|\n|\t|\u2028|\u2029/g;S.template=function(e,t,i){var n;i=S.defaults({},i,S.templateSettings);var s=new RegExp([(i.escape||L).source,(i.interpolate||L).source,(i.evaluate||L).source].join("|")+"|$","g"),r=0,o="__p+='";e.replace(s,function(t,i,n,s,a){return o+=e.slice(r,a).replace(H,function(e){return"\\"+$[e]}),i&&(o+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(o+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),s&&(o+="';\n"+s+"\n__p+='"),r=a+t.length,t}),o+="';\n",i.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{n=new Function(i.variable||"obj","_",o)}catch(a){throw a.source=o,a}if(t)return n(t,S);var l=function(e){return n.call(this,e,S)};return l.source="function("+(i.variable||"obj")+"){\n"+o+"}",l},S.chain=function(e){return S(e).chain()};var R=function(e){return this._chain?S(e).chain():e};S.mixin(S),x(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];S.prototype[e]=function(){var i=this._wrapped;return t.apply(i,arguments),"shift"!=e&&"splice"!=e||0!==i.length||delete i[0],R.call(this,i)}}),x(["concat","join","slice"],function(e){var t=n[e];S.prototype[e]=function(){return R.call(this,t.apply(this._wrapped,arguments))}}),S.extend(S.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return S})}.call(this),function(e,t){"undefined"!=typeof exports?t(e,exports,require("underscore")):"function"==typeof define&&define.amd?define("backbone",["underscore","jquery","exports"],function(i,n,s){e.Backbone=t(e,s,i,n)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,i,n){var s=e.Backbone,r=[],o=r.push,a=r.slice,l=r.splice;t.VERSION="1.0.0",t.$=n,t.noConflict=function(){return e.Backbone=s,this},t.emulateHTTP=!1,t.emulateJSON=!1;var c=t.Events={on:function(e,t,i){if(!u(this,"on",e,[t,i])||!t)return this;this._events||(this._events={});var n=this._events[e]||(this._events[e]=[]);return n.push({callback:t,context:i,ctx:i||this}),this},once:function(e,t,n){if(!u(this,"once",e,[t,n])||!t)return this;var s=this,r=i.once(function(){s.off(e,r),t.apply(this,arguments)});return r._callback=t,this.on(e,r,n)},off:function(e,t,n){var s,r,o,a,l,c,h,d;if(!this._events||!u(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;for(a=e?[e]:i.keys(this._events),l=0,c=a.length;c>l;l++)if(e=a[l],o=this._events[e]){if(this._events[e]=s=[],t||n)for(h=0,d=o.length;d>h;h++)r=o[h],(t&&t!==r.callback&&t!==r.callback._callback||n&&n!==r.context)&&s.push(r);s.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=a.call(arguments,1);if(!u(this,"trigger",e,t))return this;var i=this._events[e],n=this._events.all;return i&&d(i,t),n&&d(n,arguments),this},stopListening:function(e,t,i){var n=this._listeners;if(!n)return this;var s=!t&&!i;"object"==typeof t&&(i=this),e&&((n={})[e._listenerId]=e);for(var r in n)n[r].off(t,i,this),s&&delete this._listeners[r];return this}},h=/\s+/,u=function(e,t,i,n){if(!i)return!0;if("object"==typeof i){for(var s in i)e[t].apply(e,[s,i[s]].concat(n));return!1}if(h.test(i)){for(var r=i.split(h),o=0,a=r.length;a>o;o++)e[t].apply(e,[r[o]].concat(n));return!1}return!0},d=function(e,t){var i,n=-1,s=e.length,r=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++n<s;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<s;)(i=e[n]).callback.call(i.ctx,r);return;case 2:for(;++n<s;)(i=e[n]).callback.call(i.ctx,r,o);return;case 3:for(;++n<s;)(i=e[n]).callback.call(i.ctx,r,o,a);return;default:for(;++n<s;)(i=e[n]).callback.apply(i.ctx,t)}},p={listenTo:"on",listenToOnce:"once"};i.each(p,function(e,t){c[t]=function(t,n,s){var r=this._listeners||(this._listeners={}),o=t._listenerId||(t._listenerId=i.uniqueId("l"));return r[o]=t,"object"==typeof n&&(s=this),t[e](n,s,this),this}}),c.bind=c.on,c.unbind=c.off,i.extend(t,c);var f=t.Model=function(e,t){var n,s=e||{};t||(t={}),this.cid=i.uniqueId("c"),this.attributes={},i.extend(this,i.pick(t,m)),t.parse&&(s=this.parse(s,t)||{}),(n=i.result(this,"defaults"))&&(s=i.defaults({},s,n)),this.set(s,t),this.changed={},this.initialize.apply(this,arguments)},m=["url","urlRoot","collection"];i.extend(f.prototype,c,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var s,r,o,a,l,c,h,u;if(null==e)return this;if("object"==typeof e?(r=e,n=t):(r={})[e]=t,n||(n={}),!this._validate(r,n))return!1;o=n.unset,l=n.silent,a=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=i.clone(this.attributes),this.changed={}),u=this.attributes,h=this._previousAttributes,this.idAttribute in r&&(this.id=r[this.idAttribute]);for(s in r)t=r[s],i.isEqual(u[s],t)||a.push(s),i.isEqual(h[s],t)?delete this.changed[s]:this.changed[s]=t,o?delete u[s]:u[s]=t;if(!l){a.length&&(this._pending=!0);for(var d=0,p=a.length;p>d;d++)this.trigger("change:"+a[d],this,u[a[d]],n)}if(c)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?i.clone(this.changed):!1;var t,n=!1,s=this._changing?this._previousAttributes:this.attributes;for(var r in e)i.isEqual(s[r],t=e[r])||((n||(n={}))[r]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=e?i.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(i){return t.set(t.parse(i,e),e)?(n&&n(t,i,e),t.trigger("sync",t,i,e),void 0):!1},z(this,e),this.sync("read",this,e)},save:function(e,t,n){var s,r,o,a=this.attributes;if(null==e||"object"==typeof e?(s=e,n=t):(s={})[e]=t,!(!s||n&&n.wait||this.set(s,n)))return!1;if(n=i.extend({validate:!0},n),!this._validate(s,n))return!1;s&&n.wait&&(this.attributes=i.extend({},a,s)),void 0===n.parse&&(n.parse=!0);var l=this,c=n.success;return n.success=function(e){l.attributes=a;var t=l.parse(e,n);return n.wait&&(t=i.extend(s||{},t)),i.isObject(t)&&!l.set(t,n)?!1:(c&&c(l,e,n),l.trigger("sync",l,e,n),void 0)},z(this,n),r=this.isNew()?"create":n.patch?"patch":"update","patch"===r&&(n.attrs=s),o=this.sync(r,this,n),s&&n.wait&&(this.attributes=a),o},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,s=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(i){(e.wait||t.isNew())&&s(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)},this.isNew())return e.success(),!1;z(this,e);var r=this.sync("delete",this,e);return e.wait||s(),r},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||R();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return this._validate({},i.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,i.extend(t||{},{validationError:n})),!1):!0}});var g=["keys","values","pairs","invert","pick","omit"];i.each(g,function(e){f.prototype[e]=function(){var t=a.call(arguments);return t.unshift(this.attributes),i[e].apply(i,t)}});var v=t.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},b={add:!0,remove:!0,merge:!0},_={add:!0,merge:!1,remove:!1};i.extend(v.prototype,c,{model:f,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.defaults(t||{},_))},remove:function(e,t){e=i.isArray(e)?e.slice():[e],t||(t={});var n,s,r,o;for(n=0,s=e.length;s>n;n++)o=this.get(e[n]),o&&(delete this._byId[o.id],delete this._byId[o.cid],r=this.indexOf(o),this.models.splice(r,1),this.length--,t.silent||(t.index=r,o.trigger("remove",o,this,t)),this._removeReference(o));return this},set:function(e,t){t=i.defaults(t||{},b),t.parse&&(e=this.parse(e,t)),i.isArray(e)||(e=e?[e]:[]);var n,s,r,a,c,h=t.at,u=this.comparator&&null==h&&t.sort!==!1,d=i.isString(this.comparator)?this.comparator:null,p=[],f=[],m={};for(n=0,s=e.length;s>n;n++)(r=this._prepareModel(e[n],t))&&((a=this.get(r))?(t.remove&&(m[a.cid]=!0),t.merge&&(a.set(r.attributes,t),u&&!c&&a.hasChanged(d)&&(c=!0))):t.add&&(p.push(r),r.on("all",this._onModelEvent,this),this._byId[r.cid]=r,null!=r.id&&(this._byId[r.id]=r)));if(t.remove){for(n=0,s=this.length;s>n;++n)m[(r=this.models[n]).cid]||f.push(r);f.length&&this.remove(f,t)}if(p.length&&(u&&(c=!0),this.length+=p.length,null!=h?l.apply(this.models,[h,0].concat(p)):o.apply(this.models,p)),c&&this.sort({silent:!0}),t.silent)return this;for(n=0,s=p.length;s>n;n++)(r=p[n]).trigger("add",r,this,t);return c&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var n=0,s=this.models.length;s>n;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,i.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,i.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return null==e?void 0:this._byId[null!=e.id?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return i.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var i in e)if(e[i]!==t.get(i))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),i.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(i.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,n){t||(t=this.comparator);var s=i.isFunction(t)?t:function(e){return e.get(t)};return i.sortedIndex(this.models,e,s,n)},pluck:function(e){return i.invoke(this.models,"get",e)},fetch:function(e){e=e?i.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,n=this;return e.success=function(i){var s=e.reset?"reset":"set";n[s](i,e),t&&t(n,i,e),n.trigger("sync",n,i,e)},z(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?i.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,s=t.success;return t.success=function(i){t.wait&&n.add(e,t),s&&s(e,i,t)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof f)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var i=new this.model(e,t);return i._validate(e,t)?i:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){("add"!==e&&"remove"!==e||i===this)&&("destroy"===e&&this.remove(t,n),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var y=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];i.each(y,function(e){v.prototype[e]=function(){var t=a.call(arguments);return t.unshift(this.models),i[e].apply(i,t)}});var w=["groupBy","countBy","sortBy"];i.each(w,function(e){v.prototype[e]=function(t,n){var s=i.isFunction(t)?t:function(e){return e.get(t)};return i[e](this.models,s,n)}});var k=t.View=function(e){this.cid=i.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];i.extend(k.prototype,c,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,i){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],i!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=i.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];if(i.isFunction(n)||(n=this[e[t]]),n){var s=t.match(S),r=s[1],o=s[2];n=i.bind(n,this),r+=".delegateEvents"+this.cid,""===o?this.$el.on(r,n):this.$el.on(r,o,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=i.extend({},i.result(this,"options"),e)),i.extend(this,i.pick(e,x)),this.options=e},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"),!1);else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e["class"]=i.result(this,"className"));var n=t.$("<"+i.result(this,"tagName")+">").attr(e);this.setElement(n,!1)}}}),t.sync=function(e,n,s){var r=P[e];i.defaults(s||(s={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:r,dataType:"json"};if(s.url||(o.url=i.result(n,"url")||R()),null!=s.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",o.data=JSON.stringify(s.attrs||n.toJSON(s))),s.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),s.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){o.type="POST",s.emulateJSON&&(o.data._method=r);var a=s.beforeSend;s.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",r),a?a.apply(this,arguments):void 0}}"GET"===o.type||s.emulateJSON||(o.processData=!1),"PATCH"!==o.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=s.xhr=t.ajax(i.extend(o,s));return n.trigger("request",n,l,s),l};var P={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},T=/\((.*?)\)/g,N=/(\(\?)?:\w+/g,E=/\*\w+/g,I=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(C.prototype,c,{initialize:function(){},route:function(e,n,s){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(s=n,n=""),s||(s=this[n]);var r=this;return t.history.route(e,function(i){var o=r._extractParameters(e,i);s&&s.apply(r,o),r.trigger.apply(r,["route:"+n].concat(o)),r.trigger("route",n,o),t.history.trigger("route",r,n,o)}),this},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(I,"\\$&").replace(T,"(?:$1)?").replace(N,function(e,t){return t?e:"([^/]+)"}).replace(E,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,function(e){return e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],i.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},A=/^[#\/]|\s+$/g,O=/^\/+|\/+$/g,L=/msie [\w.]+/,$=/\/$/;M.started=!1,i.extend(M.prototype,c,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var i=this.root.replace($,"");e.indexOf(i)||(e=e.substr(i.length))}else e=this.getHash();return e.replace(A,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=i.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),s=document.documentMode,r=L.exec(navigator.userAgent.toLowerCase())&&(!s||7>=s);this.root=("/"+this.root+"/").replace(O,"/"),r&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(n)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var o=this.location,a=o.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!a?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&a&&o.hash&&(this.fragment=this.getHash().replace(A,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=i.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0});return n},navigate:function(e,t){if(!M.started)return!1;if(t&&t!==!0||(t={trigger:t}),e=this.getFragment(e||""),this.fragment!==e){this.fragment=e;var i=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new M;var H=function(e,t){var n,s=this;n=e&&i.has(e,"constructor")?e.constructor:function(){return s.apply(this,arguments)},i.extend(n,s,t);var r=function(){this.constructor=n
};return r.prototype=s.prototype,n.prototype=new r,e&&i.extend(n.prototype,e),n.__super__=s.prototype,n};f.extend=v.extend=C.extend=k.extend=M.extend=H;var R=function(){throw new Error('A "url" property or function must be specified')},z=function(e,t){var i=t.error;t.error=function(n){i&&i(e,n,t),e.trigger("error",e,n,t)}};return t}),define("core/config",["underscore"],function(){var e,t;return t="core/config",e={appName:"TidePool",debug:!0,googleAnalyticsKey:"UA-41751970-1",kissKey:"e984c464402cf32c0c208795aeede25f8a24d221",apiServer:"",appSecret:"dfb8bfffbc33f9e1c862acf72f602e535bb0005582f574094fecd9cca1d81486",appId:"7b6162eefa790be4c6ebb989a3d5d9297bd25617b6fe82c0c407071d364045b4",fbId:"470347313045508"},window.apiServerUrl=e.apiServer,e}),define("core/analytics",[],function(){var e,t,i,n,s,r,o,a,l;return t="core/analytics",n=function(e){var t;return t=t||[],t.push(["_setAccount",e]),t.push(["_setDomainName","tidepool.co"]),t.push(["_setAllowLinker",!0]),function(){var e,t;return e=document.createElement("script"),e.type="text/javascript",e.async=!0,e.src=("https:"===document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)}()},i=function(e){var t,i,n;return n=function(e){return setTimeout(function(){var t,i,n;return t=document,i=t.getElementsByTagName("script")[0],n=t.createElement("script"),n.type="text/javascript",n.async=!0,n.src=e,i.parentNode.insertBefore(n,i)},1)},i=i||[],t=t||e,n("//i.kissmetrics.com/i.js"),n("//doug1izaerwt3.cloudfront.net/"+t+".1.js")},s=function(){var e,t;return window.UserVoice=window.UserVoice||[],window.UserVoice.push(["showTab","classic_widget",{mode:"full",primary_color:"#eae8e5",link_color:"#188ff4",default_mode:"feedback",forum_id:212724,tab_label:"Feedback",tab_color:"#e43e45",tab_position:"bottom-left",tab_inverted:!1}]),t=document.createElement("script"),t.type="text/javascript",t.async=!0,t.src="//widget.uservoice.com/heZnlXOU7JHatuDLyXHqw.js",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)},l=function(e,t){return null!=e&&"undefined"!=typeof _kmq&&null!==_kmq?_kmq.push(["record",e,t]):void 0},a=function(e){return null!=e&&"undefined"!=typeof _gaq&&null!==_gaq?_gaq.push(["_trackPageview"]):void 0},o=function(e,t,i,n){return"undefined"!=typeof eventName&&null!==eventName&&"undefined"!=typeof _gaq&&null!==_gaq?_gaq.push(["_trackEvent",e,t,i,n]):void 0},r=function(e){return"undefined"!=typeof _kmq&&null!==_kmq?_kmq.push(["identify",e]):setTimeout(function(){return r(e)},250)},e=function(e){var t=this;return e.googleAnalyticsKey&&n(e.googleAnalyticsKey),e.kissKey&&i(e.kissKey),s(),window.onerror=function(e,i,n){return t.track(t.CATEGORIES.jsErr,e,i,n),!1},this},e.prototype={CATEGORIES:{viewPage:"ViewPage: ",viewLightbox:"ViewLightbox: ",jsErr:"JS Error: ",serverError:"Server Error: "},trackPage:function(e){return a(e),l(this.CATEGORIES.viewPage+e)},track:function(e,t,i,n){return null!=e&&null!=t?(o(e,t,i,n),i&&n?l(""+e+":"+t,{label:i,value:n}):l(""+e+":"+t)):void 0},setUserIdentity:function(e){return null!=e?r(e):void 0}},e}),function(){var e={};!function(e){e.VERSION="1.0.rc.1",e.helpers={},e.partials={},e.registerHelper=function(e,t,i){i&&(t.not=i),this.helpers[e]=t},e.registerPartial=function(e,t){this.partials[e]=t},e.registerHelper("helperMissing",function(e){if(2===arguments.length)return void 0;throw new Error("Could not find property '"+e+"'")});var t=Object.prototype.toString,i="[object Function]";e.registerHelper("blockHelperMissing",function(n,s){var r=s.inverse||function(){},o=s.fn,a=t.call(n);return a===i&&(n=n.call(this)),n===!0?o(this):n===!1||null==n?r(this):"[object Array]"===a?n.length>0?e.helpers.each(n,s):r(this):o(n)}),e.K=function(){},e.createFrame=Object.create||function(t){e.K.prototype=t;var i=new e.K;return e.K.prototype=null,i},e.registerHelper("each",function(t,i){var n,s=i.fn,r=i.inverse,o="";if(i.data&&(n=e.createFrame(i.data)),t&&t.length>0)for(var a=0,l=t.length;l>a;a++)n&&(n.index=a),o+=s(t[a],{data:n});else o=r(this);return o}),e.registerHelper("if",function(n,s){var r=t.call(n);return r===i&&(n=n.call(this)),!n||e.Utils.isEmpty(n)?s.inverse(this):s.fn(this)}),e.registerHelper("unless",function(t,i){var n=i.fn,s=i.inverse;return i.fn=s,i.inverse=n,e.helpers["if"].call(this,t,i)}),e.registerHelper("with",function(e,t){return t.fn(e)}),e.registerHelper("log",function(t){e.log(t)})}(e);var t=function(){function e(){this.yy={}}var t={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,DATA:27,param:28,STRING:29,INTEGER:30,BOOLEAN:31,hashSegments:32,hashSegment:33,ID:34,EQUALS:35,pathSegments:36,SEP:37,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",27:"DATA",29:"STRING",30:"INTEGER",31:"BOOLEAN",34:"ID",35:"EQUALS",37:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[17,1],[25,2],[25,1],[28,1],[28,1],[28,1],[28,1],[28,1],[26,1],[32,2],[32,1],[33,3],[33,3],[33,3],[33,3],[33,3],[21,1],[36,3],[36,1]],performAction:function(e,t,i,n,s,r){var o=r.length-1;switch(s){case 1:return r[o-1];case 2:this.$=new n.ProgramNode(r[o-2],r[o]);break;case 3:this.$=new n.ProgramNode(r[o]);break;case 4:this.$=new n.ProgramNode([]);break;case 5:this.$=[r[o]];break;case 6:r[o-1].push(r[o]),this.$=r[o-1];break;case 7:this.$=new n.BlockNode(r[o-2],r[o-1].inverse,r[o-1],r[o]);break;case 8:this.$=new n.BlockNode(r[o-2],r[o-1],r[o-1].inverse,r[o]);break;case 9:this.$=r[o];break;case 10:this.$=r[o];break;case 11:this.$=new n.ContentNode(r[o]);break;case 12:this.$=new n.CommentNode(r[o]);break;case 13:this.$=new n.MustacheNode(r[o-1][0],r[o-1][1]);break;case 14:this.$=new n.MustacheNode(r[o-1][0],r[o-1][1]);break;case 15:this.$=r[o-1];break;case 16:this.$=new n.MustacheNode(r[o-1][0],r[o-1][1]);break;case 17:this.$=new n.MustacheNode(r[o-1][0],r[o-1][1],!0);break;case 18:this.$=new n.PartialNode(r[o-1]);break;case 19:this.$=new n.PartialNode(r[o-2],r[o-1]);break;case 20:break;case 21:this.$=[[r[o-2]].concat(r[o-1]),r[o]];break;case 22:this.$=[[r[o-1]].concat(r[o]),null];break;case 23:this.$=[[r[o-1]],r[o]];break;case 24:this.$=[[r[o]],null];break;case 25:this.$=[[new n.DataNode(r[o])],null];break;case 26:r[o-1].push(r[o]),this.$=r[o-1];break;case 27:this.$=[r[o]];break;case 28:this.$=r[o];break;case 29:this.$=new n.StringNode(r[o]);break;case 30:this.$=new n.IntegerNode(r[o]);break;case 31:this.$=new n.BooleanNode(r[o]);break;case 32:this.$=new n.DataNode(r[o]);break;case 33:this.$=new n.HashNode(r[o]);break;case 34:r[o-1].push(r[o]),this.$=r[o-1];break;case 35:this.$=[r[o]];break;case 36:this.$=[r[o-2],r[o]];break;case 37:this.$=[r[o-2],new n.StringNode(r[o])];break;case 38:this.$=[r[o-2],new n.IntegerNode(r[o])];break;case 39:this.$=[r[o-2],new n.BooleanNode(r[o])];break;case 40:this.$=[r[o-2],new n.DataNode(r[o])];break;case 41:this.$=new n.IdNode(r[o]);break;case 42:r[o-2].push(r[o]),this.$=r[o-2];break;case 43:this.$=[r[o]]}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,27:[1,24],34:[1,26],36:25},{17:27,21:23,27:[1,24],34:[1,26],36:25},{17:28,21:23,27:[1,24],34:[1,26],36:25},{17:29,21:23,27:[1,24],34:[1,26],36:25},{21:30,34:[1,26],36:25},{1:[2,1]},{6:31,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,32],21:23,27:[1,24],34:[1,26],36:25},{10:33,20:[1,34]},{10:35,20:[1,34]},{18:[1,36]},{18:[2,24],21:41,25:37,26:38,27:[1,45],28:39,29:[1,42],30:[1,43],31:[1,44],32:40,33:46,34:[1,47],36:25},{18:[2,25]},{18:[2,41],27:[2,41],29:[2,41],30:[2,41],31:[2,41],34:[2,41],37:[1,48]},{18:[2,43],27:[2,43],29:[2,43],30:[2,43],31:[2,43],34:[2,43],37:[2,43]},{18:[1,49]},{18:[1,50]},{18:[1,51]},{18:[1,52],21:53,34:[1,26],36:25},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:54,34:[1,26],36:25},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:41,26:55,27:[1,45],28:56,29:[1,42],30:[1,43],31:[1,44],32:40,33:46,34:[1,47],36:25},{18:[2,23]},{18:[2,27],27:[2,27],29:[2,27],30:[2,27],31:[2,27],34:[2,27]},{18:[2,33],33:57,34:[1,58]},{18:[2,28],27:[2,28],29:[2,28],30:[2,28],31:[2,28],34:[2,28]},{18:[2,29],27:[2,29],29:[2,29],30:[2,29],31:[2,29],34:[2,29]},{18:[2,30],27:[2,30],29:[2,30],30:[2,30],31:[2,30],34:[2,30]},{18:[2,31],27:[2,31],29:[2,31],30:[2,31],31:[2,31],34:[2,31]},{18:[2,32],27:[2,32],29:[2,32],30:[2,32],31:[2,32],34:[2,32]},{18:[2,35],34:[2,35]},{18:[2,43],27:[2,43],29:[2,43],30:[2,43],31:[2,43],34:[2,43],35:[1,59],37:[2,43]},{34:[1,60]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,61]},{18:[1,62]},{18:[2,21]},{18:[2,26],27:[2,26],29:[2,26],30:[2,26],31:[2,26],34:[2,26]},{18:[2,34],34:[2,34]},{35:[1,59]},{21:63,27:[1,67],29:[1,64],30:[1,65],31:[1,66],34:[1,26],36:25},{18:[2,42],27:[2,42],29:[2,42],30:[2,42],31:[2,42],34:[2,42],37:[2,42]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,36],34:[2,36]},{18:[2,37],34:[2,37]},{18:[2,38],34:[2,38]},{18:[2,39],34:[2,39]},{18:[2,40],34:[2,40]}],defaultActions:{16:[2,1],24:[2,25],38:[2,23],55:[2,21]},parseError:function(e){throw new Error(e)},parse:function(e){function t(){var e;return e=i.lexer.lex()||1,"number"!=typeof e&&(e=i.symbols_[e]||e),e}var i=this,n=[0],s=[null],r=[],o=this.table,a="",l=0,c=0,h=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,"undefined"==typeof this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;r.push(u);var d=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var p,f,m,g,v,b,_,y,w,k={};;){if(m=n[n.length-1],this.defaultActions[m]?g=this.defaultActions[m]:((null===p||"undefined"==typeof p)&&(p=t()),g=o[m]&&o[m][p]),"undefined"==typeof g||!g.length||!g[0]){var S="";if(!h){w=[];for(b in o[m])this.terminals_[b]&&b>2&&w.push("'"+this.terminals_[b]+"'");S=this.lexer.showPosition?"Parse error on line "+(l+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+w.join(", ")+", got '"+(this.terminals_[p]||p)+"'":"Parse error on line "+(l+1)+": Unexpected "+(1==p?"end of input":"'"+(this.terminals_[p]||p)+"'"),this.parseError(S,{text:this.lexer.match,token:this.terminals_[p]||p,line:this.lexer.yylineno,loc:u,expected:w})}}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+m+", token: "+p);switch(g[0]){case 1:n.push(p),s.push(this.lexer.yytext),r.push(this.lexer.yylloc),n.push(g[1]),p=null,f?(p=f,f=null):(c=this.lexer.yyleng,a=this.lexer.yytext,l=this.lexer.yylineno,u=this.lexer.yylloc,h>0&&h--);break;case 2:if(_=this.productions_[g[1]][1],k.$=s[s.length-_],k._$={first_line:r[r.length-(_||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(_||1)].first_column,last_column:r[r.length-1].last_column},d&&(k._$.range=[r[r.length-(_||1)].range[0],r[r.length-1].range[1]]),v=this.performAction.call(k,a,c,l,this.yy,g[1],s,r),"undefined"!=typeof v)return v;_&&(n=n.slice(0,2*-1*_),s=s.slice(0,-1*_),r=r.slice(0,-1*_)),n.push(this.productions_[g[1]][0]),s.push(k.$),r.push(k._$),y=o[n[n.length-2]][n[n.length-1]],n.push(y);break;case 3:return!0}}return!0}},i=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,i=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var n=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var s=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===n.length?this.yylloc.first_column:0)+n[n.length-i.length].length-i[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[s[0],s[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,i,n,s;this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),o=0;o<r.length&&(i=this._input.match(this.rules[r[o]]),!i||t&&!(i[0].length>t[0].length)||(t=i,n=o,this.options.flex));o++);return t?(s=t[0].match(/(?:\r\n?|\n).*/g),s&&(this.yylineno+=s.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:s?s[s.length-1].length-s[s.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,r[n],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e?e:void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return"undefined"!=typeof e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)}};return e.options={},e.performAction=function(e,t,i,n){switch(i){case 0:if("\\"!==t.yytext.slice(-1)&&this.begin("mu"),"\\"===t.yytext.slice(-1)&&(t.yytext=t.yytext.substr(0,t.yyleng-1),this.begin("emu")),t.yytext)return 14;break;case 1:return 14;case 2:return"\\"!==t.yytext.slice(-1)&&this.popState(),"\\"===t.yytext.slice(-1)&&(t.yytext=t.yytext.substr(0,t.yyleng-1)),14;case 3:return 24;case 4:return 16;case 5:return 20;case 6:return 19;case 7:return 19;case 8:return 23;case 9:return 23;case 10:return t.yytext=t.yytext.substr(3,t.yyleng-5),this.popState(),15;case 11:return 22;case 12:return 35;case 13:return 34;case 14:return 34;case 15:return 37;case 16:break;case 17:return this.popState(),18;case 18:return this.popState(),18;case 19:return t.yytext=t.yytext.substr(1,t.yyleng-2).replace(/\\"/g,'"'),29;case 20:return t.yytext=t.yytext.substr(1,t.yyleng-2).replace(/\\"/g,'"'),29;case 21:return t.yytext=t.yytext.substr(1),27;case 22:return 31;case 23:return 31;case 24:return 30;case 25:return 34;case 26:return t.yytext=t.yytext.substr(1,t.yyleng-2),34;case 27:return"INVALID";case 28:return 5}},e.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[} ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@[a-zA-Z]+)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:[0-9]+(?=[}\s]))/,/^(?:[a-zA-Z0-9_$-]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],e.conditions={mu:{rules:[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28],inclusive:!1},emu:{rules:[2],inclusive:!1},INITIAL:{rules:[0,1,28],inclusive:!0}},e}();return t.lexer=i,e.prototype=t,t.Parser=e,new e}();e.Parser=t,e.parse=function(t){return e.Parser.yy=e.AST,e.Parser.parse(t)},e.print=function(t){return(new e.PrintVisitor).accept(t)},e.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(){}},e.log=function(t,i){e.logger.log(t,i)},function(){e.AST={},e.AST.ProgramNode=function(t,i){this.type="program",this.statements=t,i&&(this.inverse=new e.AST.ProgramNode(i))},e.AST.MustacheNode=function(e,t,i){this.type="mustache",this.escaped=!i,this.hash=t;var n=this.id=e[0],s=this.params=e.slice(1),r=this.eligibleHelper=n.isSimple;this.isHelper=r&&(s.length||t)},e.AST.PartialNode=function(e,t){this.type="partial",this.id=e,this.context=t};var t=function(t,i){if(t.original!==i.original)throw new e.Exception(t.original+" doesn't match "+i.original)};e.AST.BlockNode=function(e,i,n,s){t(e.id,s),this.type="block",this.mustache=e,this.program=i,this.inverse=n,this.inverse&&!this.program&&(this.isInverse=!0)},e.AST.ContentNode=function(e){this.type="content",this.string=e},e.AST.HashNode=function(e){this.type="hash",this.pairs=e},e.AST.IdNode=function(e){this.type="ID",this.original=e.join(".");for(var t=[],i=0,n=0,s=e.length;s>n;n++){var r=e[n];".."===r?i++:"."===r||"this"===r?this.isScoped=!0:t.push(r)}this.parts=t,this.string=t.join("."),this.depth=i,this.isSimple=1===e.length&&!this.isScoped&&0===i},e.AST.DataNode=function(e){this.type="DATA",this.id=e},e.AST.StringNode=function(e){this.type="STRING",this.string=e},e.AST.IntegerNode=function(e){this.type="INTEGER",this.integer=e},e.AST.BooleanNode=function(e){this.type="BOOLEAN",this.bool=e},e.AST.CommentNode=function(e){this.type="comment",this.comment=e}}(),e.Exception=function(){var e=Error.prototype.constructor.apply(this,arguments);for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.message=e.message},e.Exception.prototype=new Error,e.SafeString=function(e){this.string=e},e.SafeString.prototype.toString=function(){return this.string.toString()},function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/[&<>"'`]/g,n=/[&<>"'`]/,s=function(e){return t[e]||"&amp;"};e.Utils={escapeExpression:function(t){return t instanceof e.SafeString?t.toString():null==t||t===!1?"":n.test(t)?t.replace(i,s):t},isEmpty:function(e){return"undefined"==typeof e?!0:null===e?!0:e===!1?!0:"[object Array]"===Object.prototype.toString.call(e)&&0===e.length?!0:!1}}}(),e.Compiler=function(){},e.JavaScriptCompiler=function(){},function(t,i){t.prototype={compiler:t,disassemble:function(){for(var e,t,i,n=this.opcodes,s=[],r=0,o=n.length;o>r;r++)if(e=n[r],"DECLARE"===e.opcode)s.push("DECLARE "+e.name+"="+e.value);else{t=[];for(var a=0;a<e.args.length;a++)i=e.args[a],"string"==typeof i&&(i='"'+i.replace("\n","\\n")+'"'),t.push(i);s.push(e.opcode+" "+t.join(" "))}return s.join("\n")},guid:0,compile:function(e,t){this.children=[],this.depths={list:[]},this.options=t;var i=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0},i)for(var n in i)this.options.knownHelpers[n]=i[n];return this.program(e)},accept:function(e){return this[e.type](e)},program:function(e){var t,i=e.statements;this.opcodes=[];for(var n=0,s=i.length;s>n;n++)t=i[n],this[t.type](t);return this.isSimple=1===s,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t,i=(new this.compiler).compile(e,this.options),n=this.guid++;this.usePartial=this.usePartial||i.usePartial,this.children[n]=i;for(var s=0,r=i.depths.list.length;r>s;s++)t=i.depths.list[s],2>t||this.addDepth(t-1);return n},block:function(e){var t=e.mustache,i=e.program,n=e.inverse;i&&(i=this.compileProgram(i)),n&&(n=this.compileProgram(n));var s=this.classifyMustache(t);"helper"===s?this.helperMustache(t,i,n):"simple"===s?(this.simpleMustache(t),this.opcode("pushProgram",i),this.opcode("pushProgram",n),this.opcode("pushLiteral","{}"),this.opcode("blockValue")):(this.ambiguousMustache(t,i,n),this.opcode("pushProgram",i),this.opcode("pushProgram",n),this.opcode("pushLiteral","{}"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(e){var t,i,n=e.pairs;this.opcode("push","{}");for(var s=0,r=n.length;r>s;s++)t=n[s],i=t[1],this.accept(i),this.opcode("assignToHash",t[0])},partial:function(e){var t=e.id;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.original),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){var t=this.options,i=this.classifyMustache(e);"simple"===i?this.simpleMustache(e):"helper"===i?this.helperMustache(e):this.ambiguousMustache(e),e.escaped&&!t.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(e,t,i){var n=e.id,s=n.parts[0];this.opcode("getContext",n.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",i),this.opcode("invokeAmbiguous",s)},simpleMustache:function(e){var t=e.id;"DATA"===t.type?this.DATA(t):t.parts.length?this.ID(t):(this.addDepth(t.depth),this.opcode("getContext",t.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(e,t,i){var n=this.setupFullMustacheParams(e,t,i),s=e.id.parts[0];if(this.options.knownHelpers[s])this.opcode("invokeKnownHelper",n.length,s);else{if(this.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+s);this.opcode("invokeHelper",n.length,s)}},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0];t?this.opcode("lookupOnContext",e.parts[0]):this.opcode("pushContext");for(var i=1,n=e.parts.length;n>i;i++)this.opcode("lookup",e.parts[i])},DATA:function(e){this.options.data=!0,this.opcode("lookupData",e.id)},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("pushLiteral",e.integer)},BOOLEAN:function(e){this.opcode("pushLiteral",e.bool)},comment:function(){},opcode:function(e){this.opcodes.push({opcode:e,args:[].slice.call(arguments,1)})},declare:function(e,t){this.opcodes.push({opcode:"DECLARE",name:e,value:t})},addDepth:function(e){if(isNaN(e))throw new Error("EWOT");0!==e&&(this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e)))},classifyMustache:function(e){var t=e.isHelper,i=e.eligibleHelper,n=this.options;if(i&&!t){var s=e.id.parts[0];n.knownHelpers[s]?t=!0:n.knownHelpersOnly&&(i=!1)}return t?"helper":i?"ambiguous":"simple"},pushParams:function(e){for(var t,i=e.length;i--;)t=e[i],this.options.stringParams?(t.depth&&this.addDepth(t.depth),this.opcode("getContext",t.depth||0),this.opcode("pushStringParam",t.string)):this[t.type](t)},setupMustacheParams:function(e){var t=e.params;return this.pushParams(t),e.hash?this.hash(e.hash):this.opcode("pushLiteral","{}"),t},setupFullMustacheParams:function(e,t,i){var n=e.params;return this.pushParams(n),this.opcode("pushProgram",t),this.opcode("pushProgram",i),e.hash?this.hash(e.hash):this.opcode("pushLiteral","{}"),n}};var n=function(e){this.value=e};i.prototype={nameLookup:function(e,t){return/^[0-9]+$/.test(t)?e+"["+t+"]":i.isValidJavaScriptVariableName(t)?e+"."+t:e+"['"+t+"']"},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":"buffer += "+e+";"},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(t,i,n,s){this.environment=t,this.options=i||{},e.log(e.logger.DEBUG,this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.compileChildren(t,i);var r,o=t.opcodes;for(this.i=0,a=o.length;this.i<a;this.i++)r=o[this.i],"DECLARE"===r.opcode?this[r.name]=r.value:this[r.opcode].apply(this,r.args);return this.createFunctionContext(s)},nextOpcode:function(){var e=this.environment.opcodes;return e[this.i+1],e[this.i+1]},eat:function(){this.i=this.i+1},preamble:function(){var e=[];if(this.isChild)e.push("");else{var t=this.namespace,i="helpers = helpers || "+t+".helpers;";this.environment.usePartial&&(i=i+" partials = partials || "+t+".partials;"),this.options.data&&(i+=" data = data || {};"),e.push(i)}this.environment.isSimple?e.push(""):e.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=e},createFunctionContext:function(t){var i=this.stackVars.concat(this.registers.list);if(i.length>0&&(this.source[1]=this.source[1]+", "+i.join(", ")),!this.isChild)for(var n in this.context.aliases)this.source[1]=this.source[1]+", "+n+"="+this.context.aliases[n];this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");for(var s=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],r=0,o=this.environment.depths.list.length;o>r;r++)s.push("depth"+this.environment.depths.list[r]);if(t)return s.push(this.source.join("\n  ")),Function.apply(this,s);var a="function "+(this.name||"")+"("+s.join(",")+") {\n  "+this.source.join("\n  ")+"}";return e.log(e.logger.DEBUG,a+"\n\n"),a},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e),this.replaceStack(function(t){return e.splice(1,0,t),t+" = blockHelperMissing.call("+e.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e);var t=this.topStack();e.splice(1,0,t),this.source.push("if (!"+this.lastHelper+") { "+t+" = blockHelperMissing.call("+e.join(", ")+"); }")},appendContent:function(e){this.source.push(this.appendToBuffer(this.quotedString(e)))},append:function(){var e=this.popStack();this.source.push("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){var e=this.nextOpcode(),t="";this.context.aliases.escapeExpression="this.escapeExpression",e&&"appendContent"===e.opcode&&(t=" + "+this.quotedString(e.args[0]),this.eat(e)),this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+t))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupOnContext:function(e){this.pushStack(this.nameLookup("depth"+this.lastContext,e,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(e){return"typeof "+e+" === functionType ? "+e+"() : "+e})},lookup:function(e){this.replaceStack(function(t){return t+" == null || "+t+" === false ? "+t+" : "+this.nameLookup(t,e,"context")})},lookupData:function(e){this.pushStack(this.nameLookup("data",e,"data"))},pushStringParam:function(e){this.pushStackLiteral("depth"+this.lastContext),this.pushString(e)},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},push:function(e){this.pushStack(e)},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t){this.context.aliases.helperMissing="helpers.helperMissing";var i=this.lastHelper=this.setupHelper(e,t);this.register("foundHelper",i.name),this.pushStack("foundHelper ? foundHelper.call("+i.callParams+") "+": helperMissing.call("+i.helperMissingParams+")")},invokeKnownHelper:function(e,t){var i=this.setupHelper(e,t);this.pushStack(i.name+".call("+i.callParams+")")},invokeAmbiguous:function(e){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var t=this.setupHelper(0,e),i=this.lastHelper=this.nameLookup("helpers",e,"helper");this.register("foundHelper",i);var n=this.nameLookup("depth"+this.lastContext,e,"context"),s=this.nextStack();this.source.push("if (foundHelper) { "+s+" = foundHelper.call("+t.callParams+"); }"),this.source.push("else { "+s+" = "+n+"; "+s+" = typeof "+s+" === functionType ? "+s+"() : "+s+"; }")},invokePartial:function(e){var t=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"];this.options.data&&t.push("data"),this.context.aliases.self="this",this.pushStack("self.invokePartial("+t.join(", ")+");")},assignToHash:function(e){var t=this.popStack(),i=this.topStack();this.source.push(i+"['"+e+"'] = "+t+";")},compiler:i,compileChildren:function(e,t){for(var i,n,s=e.children,r=0,o=s.length;o>r;r++){i=s[r],n=new this.compiler,this.context.programs.push("");var a=this.context.programs.length;i.index=a,i.name="program"+a,this.context.programs[a]=n.compile(i,t,this.context)}},programExpression:function(e){if(this.context.aliases.self="this",null==e)return"self.noop";for(var t,i=this.environment.children[e],n=i.depths.list,s=[i.index,i.name,"data"],r=0,o=n.length;o>r;r++)t=n[r],1===t?s.push("depth0"):s.push("depth"+(t-1));return 0===n.length?"self.program("+s.join(", ")+")":(s.shift(),"self.programWithDepth("+s.join(", ")+")")},register:function(e,t){this.useRegister(e),this.source.push(e+" = "+t+";")},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},pushStackLiteral:function(e){return this.compileStack.push(new n(e)),e
},pushStack:function(e){return this.source.push(this.incrStack()+" = "+e+";"),this.compileStack.push("stack"+this.stackSlot),"stack"+this.stackSlot},replaceStack:function(e){var t=e.call(this,this.topStack());return this.source.push(this.topStack()+" = "+t+";"),"stack"+this.stackSlot},nextStack:function(){var e=this.incrStack();return this.compileStack.push("stack"+this.stackSlot),e},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),"stack"+this.stackSlot},popStack:function(){var e=this.compileStack.pop();return e instanceof n?e.value:(this.stackSlot--,e)},topStack:function(){var e=this.compileStack[this.compileStack.length-1];return e instanceof n?e.value:e},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'},setupHelper:function(e,t){var i=[];this.setupParams(e,i);var n=this.nameLookup("helpers",t,"helper");return{params:i,name:n,callParams:["depth0"].concat(i).join(", "),helperMissingParams:["depth0",this.quotedString(t)].concat(i).join(", ")}},setupParams:function(e,t){var i,n,s,r=[],o=[];r.push("hash:"+this.popStack()),n=this.popStack(),s=this.popStack(),(s||n)&&(s||(this.context.aliases.self="this",s="self.noop"),n||(this.context.aliases.self="this",n="self.noop"),r.push("inverse:"+n),r.push("fn:"+s));for(var a=0;e>a;a++)i=this.popStack(),t.push(i),this.options.stringParams&&o.push(this.popStack());return this.options.stringParams&&r.push("contexts:["+o.join(",")+"]"),this.options.data&&r.push("data:data"),t.push("{"+r.join(",")+"}"),t.join(", ")}};for(var s="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),r=i.RESERVED_WORDS={},o=0,a=s.length;a>o;o++)r[s[o]]=!0;i.isValidJavaScriptVariableName=function(e){return!i.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(e)?!0:!1}}(e.Compiler,e.JavaScriptCompiler),e.precompile=function(t,i){i=i||{};var n=e.parse(t),s=(new e.Compiler).compile(n,i);return(new e.JavaScriptCompiler).compile(s,i)},e.compile=function(t,i){function n(){var n=e.parse(t),s=(new e.Compiler).compile(n,i),r=(new e.JavaScriptCompiler).compile(s,i,void 0,!0);return e.template(r)}i=i||{};var s;return function(e,t){return s||(s=n()),s.call(this,e,t)}},e.VM={template:function(t){var i={escapeExpression:e.Utils.escapeExpression,invokePartial:e.VM.invokePartial,programs:[],program:function(t,i,n){var s=this.programs[t];return n?e.VM.program(i,n):s?s:s=this.programs[t]=e.VM.program(i)},programWithDepth:e.VM.programWithDepth,noop:e.VM.noop};return function(n,s){return s=s||{},t.call(i,e,n,s.helpers,s.partials,s.data)}},programWithDepth:function(e,t){var i=Array.prototype.slice.call(arguments,2);return function(n,s){return s=s||{},e.apply(this,[n,s.data||t].concat(i))}},program:function(e,t){return function(i,n){return n=n||{},e(i,n.data||t)}},noop:function(){return""},invokePartial:function(t,i,n,s,r,o){var a={helpers:s,partials:r,data:o};if(void 0===t)throw new e.Exception("The partial "+i+" could not be found");if(t instanceof Function)return t(n,a);if(e.compile)return r[i]=e.compile(t,{data:void 0!==o}),r[i](n,a);throw new e.Exception("The partial "+i+" could not be compiled when running in runtime-only mode")}},e.template=e.VM.template,define("Handlebars",[],function(){return e})}(),define("text",["module"],function(e){var t,i,n,s,r=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l="undefined"!=typeof location&&location.href,c=l&&location.protocol&&location.protocol.replace(/\:/,""),h=l&&location.hostname,u=l&&(location.port||void 0),d={},p=e.config&&e.config()||{};return t={version:"2.0.7",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){i=r[t];try{e=new ActiveXObject(i)}catch(n){}if(e){r=[i];break}}return e},parseName:function(e){var t,i,n,s=!1,r=e.indexOf("."),o=0===e.indexOf("./")||0===e.indexOf("../");return-1!==r&&(!o||r>1)?(t=e.substring(0,r),i=e.substring(r+1,e.length)):t=e,n=i||t,r=n.indexOf("!"),-1!==r&&(s="strip"===n.substring(r+1),n=n.substring(0,r),i?i=n:t=n),{moduleName:t,ext:i,strip:s}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,i,n,s){var r,o,a,l=t.xdRegExp.exec(e);return l?(r=l[2],o=l[3],o=o.split(":"),a=o[1],o=o[0],!(r&&r!==i||o&&o.toLowerCase()!==n.toLowerCase()||(a||o)&&a!==s)):!0},finishLoad:function(e,i,n,s){n=i?t.strip(n):n,p.isBuild&&(d[e]=n),s(n)},load:function(e,i,n,s){if(s.isBuild&&!s.inlineText)return n(),void 0;p.isBuild=s.isBuild;var r=t.parseName(e),o=r.moduleName+(r.ext?"."+r.ext:""),a=i.toUrl(o),d=p.useXhr||t.useXhr;!l||d(a,c,h,u)?t.get(a,function(i){t.finishLoad(e,r.strip,i,n)},function(e){n.error&&n.error(e)}):i([o],function(e){t.finishLoad(r.moduleName+"."+r.ext,r.strip,e,n)})},write:function(e,i,n){if(d.hasOwnProperty(i)){var s=t.jsEscape(d[i]);n.asModule(e+"!"+i,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,i,n,s,r){var o=t.parseName(i),a=o.ext?"."+o.ext:"",l=o.moduleName+a,c=n.toUrl(o.moduleName+a)+".js";t.load(l,n,function(){var i=function(e){return s(c,e)};i.asModule=function(e,t){return s.asModule(e,c,t)},t.write(e,l,i,r)},r)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(i=require.nodeRequire("fs"),t.get=function(e,t,n){try{var s=i.readFileSync(e,"utf8");0===s.indexOf("")&&(s=s.substring(1)),t(s)}catch(r){n(r)}}):"xhr"===p.env||!p.env&&t.createXhr()?t.get=function(e,i,n,s){var r,o=t.createXhr();if(o.open("GET",e,!0),s)for(r in s)s.hasOwnProperty(r)&&o.setRequestHeader(r.toLowerCase(),s[r]);p.onXhr&&p.onXhr(o,e),o.onreadystatechange=function(){var t,s;4===o.readyState&&(t=o.status,t>399&&600>t?(s=new Error(e+" HTTP status: "+t),s.xhr=o,n(s)):i(o.responseText),p.onXhrComplete&&p.onXhrComplete(o,e))},o.send(null)}:"rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var i,n,s="utf-8",r=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),s)),l="";try{for(i=new java.lang.StringBuffer,n=a.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),null!==n&&i.append(n);null!==(n=a.readLine());)i.append(o),i.append(n);l=String(i.toString())}finally{a.close()}t(l)}:("xpconnect"===p.env||!p.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(n=Components.classes,s=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,t){var i,r,o={},a=new FileUtils.File(e);try{i=n["@mozilla.org/network/file-input-stream;1"].createInstance(s.nsIFileInputStream),i.init(a,1,0,!1),r=n["@mozilla.org/intl/converter-input-stream;1"].createInstance(s.nsIConverterInputStream),r.init(i,"utf-8",i.available(),s.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),r.readString(i.available(),o),r.close(),i.close(),t(o.value)}catch(l){throw new Error((a&&a.path||"")+": "+l)}}),t}),define("text!composite_views/perch.hbs",[],function(){return'{{#if title}}\n    <div class="modal-header">\n        {{#unless mustUseButton}}\n            <button type="button" class="close" data-dismiss="modal"></button>\n        {{/unless}}\n        <h2>{{{title}}}</h2>\n    </div>\n{{/if}}\n\n<div class="modal-body" id="PerchBody">\n    {{{content}}}\n\n    {{#if btn1Text}}\n        <button id="PerchBtn1" class="btn {{btn1ClassName}}">{{btn1Text}}</button>\n    {{/if}}\n</div>'}),define("composite_views/perch",["jquery","backbone","Handlebars","text!./perch.hbs"],function(e,t,i,n){var s,r,o,a,l,c;return c="composite_views/perch",l="body",a="#PerchBody",r=t.Model.extend({defaults:{title:"",content:"This is the default message.",className:null,onClose:function(){},btn1Text:"Ok",btn1ClassName:"btn-large btn-primary",btn1Callback:function(){},mustUseButton:!1}}),s=t.View.extend({tmpl:i.compile(n),tagName:"aside",className:"perch modal hide fade",events:{"click #PerchBtn1":"_onBtn1Click"},initialize:function(){return e(l).append(this.el)},render:function(){return this.$el.html(this.tmpl(this.model.attributes)),this},_onBtn1Click:function(){var e;return"function"==typeof(e=this.model.attributes).btn1Callback&&e.btn1Callback(),this.hide()},_onBtn2Click:function(){return console.log(""+c+"._onBtn2Click()")},_onModalHidden:function(){var e;return"function"==typeof(e=this.model.attributes).onClose&&e.onClose(),this._viewCleanup()},_showSimpleMsg:function(e){return this._showOptionsObject({msg:e})},_showBackboneView:function(e){return this._childView=e.content,e.content=null,e.title=e.title||null,this._showOptionsObject(e),this._addChildView()},_showOptionsObject:function(e){var t;return e.msg&&(e.content="<p>"+e.msg+"</p>"),this.model.set(e),this._bindDomEvents(),t=e.mustUseButton?"static":!0,this.$el.modal({backdrop:t})},_addChildView:function(){var t;return e(a).prepend(null!=(t=this._childView)?t.render().el:void 0)},_viewCleanup:function(){var e;return this.$el.off("hidden"),null!=this._childView?("function"==typeof(e=this._childView).close&&e.close(),this._childView.remove()):void 0},_bindDomEvents:function(){return this.$el.on("hidden",_.bind(this._onModalHidden,this))},_trackLightbox:function(e){var t;if(!e.supressTracking&&null!=this.options.app){if("string"==typeof e)t=e;else{if(!e.title)return null;t=e.title}return this.options.app.analytics.track(this.options.app.analytics.CATEGORIES.viewLightbox,t,"",e)}},_makeSmall:function(){return this.$el.addClass("small"),this.$el.removeClass("huge")},_makeLarge:function(){return this.$el.removeClass("small"),this.$el.removeClass("huge")},_makeHuge:function(){return this.$el.addClass("huge"),this.$el.removeClass("small")},show:function(e){return this.model=new r,e.large?this._makeLarge():e.huge?this._makeHuge():this._makeSmall(),null!=e.className&&this.$el.addClass(e.className),this.listenTo(this.model,"change",this.render),"string"==typeof e?this._showSimpleMsg(e):(null!=e?e.content:void 0)instanceof t.View?this._showBackboneView(e):this._showOptionsObject(e),this._trackLightbox(e),this},hide:function(){return this.$el.modal("hide")}}),o=new s,o.Klass=s,o}),function(e,t){"function"==typeof define&&define.amd&&define("syphon",["underscore","jquery","backbone"],t)}(this,function(e,t,i){return i.Syphon=function(e,t,i){var n={};n.ignoredTypes=["button","submit","reset","fieldset"],n.serialize=function(e,n){var o={},c=a(n),h=s(e,c);return i.each(h,function(e){var i=t(e),n=r(i),s=c.keyExtractors.get(n),a=s(i),h=c.inputReaders.get(n),u=h(i),d=c.keyAssignmentValidators.get(n);if(d(i,a,u)){var p=c.keySplitter(a);o=l(o,p,u)}}),o},n.deserialize=function(e,n,o){var l=a(o),h=s(e,l),u=c(l,n);i.each(h,function(e){var i=t(e),n=r(i),s=l.keyExtractors.get(n),o=s(i),a=l.inputWriters.get(n),c=u[o];a(i,c)})};var s=function(e,n){var s=o(e),a=s.elements;return a=i.reject(a,function(e){var s,o=r(e),a=n.keyExtractors.get(o),l=a(t(e)),c=i.include(n.ignoredTypes,o),h=i.include(n.include,l),u=i.include(n.exclude,l);return s=h?!1:n.include?!0:u||c})},r=function(e){var i,n=t(e),s=n[0].tagName,r=s;return"input"===s.toLowerCase()&&(i=n.attr("type"),r=i?i:"text"),r.toLowerCase()},o=function(e){return i.isUndefined(e.$el)&&"form"===e.tagName.toLowerCase()?e:e.$el.is("form")?e.el:e.$("form")[0]},a=function(e){var t=i.clone(e)||{};return t.ignoredTypes=i.clone(n.ignoredTypes),t.inputReaders=t.inputReaders||n.InputReaders,t.inputWriters=t.inputWriters||n.InputWriters,t.keyExtractors=t.keyExtractors||n.KeyExtractors,t.keySplitter=t.keySplitter||n.KeySplitter,t.keyJoiner=t.keyJoiner||n.KeyJoiner,t.keyAssignmentValidators=t.keyAssignmentValidators||n.KeyAssignmentValidators,t},l=function(e,t,n){if(!t)return e;var s=t.shift();return e[s]||(e[s]=i.isArray(s)?[]:{}),0===t.length&&(i.isArray(e[s])?e[s].push(n):e[s]=n),t.length>0&&l(e[s],t,n),e},c=function(e,t,n){var s={};return i.each(t,function(t,r){var o={};n&&(r=e.keyJoiner(n,r)),i.isArray(t)?o[r]=t:i.isObject(t)?o=c(e,t,r):o[r]=t,i.extend(s,o)}),s};return n}(i,t,e),i.Syphon.TypeRegistry=function(){this.registeredTypes={}},i.Syphon.TypeRegistry.extend=i.Model.extend,e.extend(i.Syphon.TypeRegistry.prototype,{get:function(e){var t=this.registeredTypes[e];return t||(t=this.registeredTypes["default"]),t},register:function(e,t){this.registeredTypes[e]=t},registerDefault:function(e){this.registeredTypes["default"]=e},unregister:function(e){this.registeredTypes[e]&&delete this.registeredTypes[e]}}),i.Syphon.KeyExtractorSet=i.Syphon.TypeRegistry.extend(),i.Syphon.KeyExtractors=new i.Syphon.KeyExtractorSet,i.Syphon.KeyExtractors.registerDefault(function(e){return e.prop("name")}),i.Syphon.InputReaderSet=i.Syphon.TypeRegistry.extend(),i.Syphon.InputReaders=new i.Syphon.InputReaderSet,i.Syphon.InputReaders.registerDefault(function(e){return e.val()}),i.Syphon.InputReaders.register("checkbox",function(e){var t=e.prop("checked");return t}),i.Syphon.InputWriterSet=i.Syphon.TypeRegistry.extend(),i.Syphon.InputWriters=new i.Syphon.InputWriterSet,i.Syphon.InputWriters.registerDefault(function(e,t){e.val(t)}),i.Syphon.InputWriters.register("checkbox",function(e,t){e.prop("checked",t)}),i.Syphon.InputWriters.register("radio",function(e,t){e.prop("checked",e.val()===t)}),i.Syphon.KeyAssignmentValidatorSet=i.Syphon.TypeRegistry.extend(),i.Syphon.KeyAssignmentValidators=new i.Syphon.KeyAssignmentValidatorSet,i.Syphon.KeyAssignmentValidators.registerDefault(function(){return!0}),i.Syphon.KeyAssignmentValidators.register("radio",function(e){return e.prop("checked")}),i.Syphon.KeySplitter=function(e){var t=e.match(/[^\[\]]+/g);return e.indexOf("[]")===e.length-2&&(lastKey=t.pop(),t.push([lastKey])),t},i.Syphon.KeyJoiner=function(e,t){return e+"["+t+"]"},i.Syphon}),define("text!forms/user/login.hbs",[],function(){return'\n<button class="btn btn-block btn-primary btn-large facebook" id="SignInFacebook">\n  <i class="icon-facebook icon-large"></i>\n  Sign in <span class="muted">with</span> Facebook\n</button>\n\n<div class="divider">\n    <b class="rule"></b>\n    <p>Or</p>\n    <b class="rule"></b>\n</div>\n\n\n\n<form id="SigninForm">\n    <h3>\n        Use Your Email\n        <div class="btn-group btn-rocker" data-toggle="buttons-radio">\n            <button id="ActionSignIn" class="btn active" value="signIn" type="button">Sign In</button>\n            <button id="ActionRegister" class="btn" value="register" type="button">Register</button>\n            <input id="LoginType" type="hidden" name="loginType" value="signIn" />\n        </div>\n    </h3>\n\n    <input name="email" class="large input-block-level" type="email" placeholder="Email Address" />\n    <input name="password" class="large input-block-level" type="password" placeholder="Password" />\n    <input name="passwordConfirm" id="Login-confirm" class="large input-block-level" type="password" style="display:none;" placeholder="Confirm Password" />\n\n    <div id="LoginErrorHolder"></div>\n    <button id="Login-submit" class="btn btn-large btn-block" type="submit">Get Started</button>\n\n    <!--<label for="Login-remember" class="small inlineBlock">-->\n        <!--<input name="rememberMe" id="Login-remember" type="checkbox" checked />-->\n        <!--Remember Me-->\n    <!--</label>-->\n    <!--<a id="Login-forgot" class="pull-right small" href="">Forgot Your Password?</a>-->\n</form>\n\n'}),define("text!ui_widgets/hold_please.hbs",[],function(){return'\n<i class="icon-repeat {{iconSize}}"></i>'}),define("ui_widgets/hold_please",["jquery","backbone","Handlebars","text!./hold_please.hbs"],function(e,t,i,n){var s,r;return r="ui_widgets/hold_please",s=t.View.extend({tmpl:i.compile(n),tagName:"b",className:"holdPlease",events:{click:"_clicked"},initialize:function(){},render:function(e){return this.$el.html(this.tmpl({iconSize:e})),this},_clicked:function(e){return e.preventDefault(),e.stopPropagation()},_showOnSelector:function(t,i){return e(t).hasClass("btn-large")&&(i="icon-large"),e(t).addClass("onHold").css("position","relative").append(this.render(i).$el.clone(!0))},_showFullScreen:function(){return this._showOnSelector("body","icon-4x")},_hideInSelector:function(t){return e(t).removeClass("onHold").css("position","").find("."+this.className).remove()},_hideAll:function(){return e("."+this.className).parent().removeClass("onHold").css("position",""),e("."+this.className).remove()},show:function(e){return e?this._showOnSelector(e):this._showFullScreen()},hide:function(e){return e?this._hideInSelector(e):this._hideAll()}}),new s}),define("text!ui_widgets/psst.hbs",[],function(){return'\n<button type="button" class="close" data-dismiss="alert">&times;</button>\n\n{{#if title}}\n    <h4 class="title">{{title}}</h4>\n{{/if}}\n\n{{msg}}\n\n'}),define("ui_widgets/psst",["jquery","backbone","Handlebars","text!./psst.hbs"],function(e,t,i,n){var s,r,o,a,l,c;return c="ui_widgets/psst",o={good:"good",info:"info",question:"question",warn:"warn",error:"error"},l=o.info,a="psst",s=t.View.extend({tagName:"aside",className:""+a+" alert",initialize:function(){return this.tmpl=i.compile(n)},render:function(e){var t;if(!e.msg||!e.sel)throw new Error("Need .msg and .sel");return t={title:e.title||null,msg:e.msg,type:e.type||l,selector:e.sel},this.$el.html(this.tmpl(t)),this.$el.attr("class",""+this.className+" "+t.type),this.$el.clone().prependTo(t.selector),this},_hide:function(){return this.$el.is(":visible")?(this.$el.attr("class",this.className).remove(),this):void 0},_hideAll:function(){return e("."+a).remove()}}),r=new s,r.render=_.bind(r.render,r),r.render.hide=_.bind(r._hideAll,r),r.render.TYPES=o,r.render}),define("forms/user/login",["jquery","backbone","Handlebars","syphon","text!./login.hbs","ui_widgets/hold_please","ui_widgets/psst","composite_views/perch"],function(e,t,i,n,s,r,o,a){var l,c,h,u,d,p;return u="forms/user/login",c="#Login-confirm",p="#Login-submit",d="#ActionRegister",h="#LoginType",l=t.View.extend({className:"loginDialog",events:{"click #SignInFacebook":"_clickedSignInFacebook","click #ActionSignIn":"_modeSignIn","click #ActionRegister":"_modeRegister","click #Login-forgot":"_clickedForgotPass","focus input":"_jazzifySubmitBtn",submit:"_submittedForm"},initialize:function(){if(null==this.options.app||null==this.model)throw new Error("Need options.app and a model");return this.listenTo(this.model,"sync",this._onSync),this.listenTo(this.model,"invalid",this._onModelInvalid),this.listenTo(this.model,"error",this._onModelError)},render:function(){var e;return this.$el.html(s),null!=(e=this.options.app.analytics)&&e.track(this.className,"show"),this.options.register&&(this.$(d).trigger("click"),this.$(d).siblings().removeClass("active"),this.$(d).addClass("active")),this},_jazzifySubmitBtn:function(){return this.$(p).addClass("btn-inverse")},_showErr:function(e){return e=e||"Unknown Error",o.hide(),o({sel:"#LoginErrorHolder",msg:e,type:"error"})},_clickedSignInFacebook:function(t){var i;return this.options.app.session.loginUsingOauth("facebook",{width:1006,height:775}),r.show(e(t.target)),null!=(i=this.options.app.analytics)?i.track(this.className,"Pressed Facebook Sign In"):void 0},_clickedForgotPass:function(){},_modeSignIn:function(){var e;return this._isRegisterMode=!1,this.$(h).val("signIn"),this.$(c).hide(),this._jazzifySubmitBtn(),o.hide(),null!=(e=this.options.app.analytics)?e.track(this.className,"modeSignIn"):void 0},_modeRegister:function(){var e;return this._isRegisterMode=!0,this.$(h).val("register"),this.$(c).show(),this._jazzifySubmitBtn(),o.hide(),null!=(e=this.options.app.analytics)?e.track(this.className,"modeRegister"):void 0},_submittedForm:function(e){var t,i;return e.preventDefault(),o.hide(),r.show(p),t=n.serialize(e.target),"register"!==t.loginType&&(t.passwordConfirm=""),this.options.app.user.isGuest()||this.options.app.session.logOut(),"register"===t.loginType?(this.model.set(t,{silent:!0}),this.model.isValid({register:!0})&&this.options.app.session.register()):(this.model.set(t,{silent:!0}),this.model.isValid({login:!0})&&this.options.app.session.signIn()),null!=(i=this.options.app.analytics)?i.track(this.className,"Submitted Form",t.loginType):void 0},_onSync:function(){return a.hide()},_onModelInvalid:function(e,t){var i;return this._showErr(t),r.hide(p),null!=(i=this.options.app.analytics)?i.track(this.className,"Validation Issue"):void 0},_onModelError:function(e,t){return this._showErr(""+t.status+": "+t.statusText),r.hide(p)}})}),define("text!forms/user/profile.hbs",[],function(){return'\n\n\n{{#if image}}\n    <i class="avatar interactive">\n        <img src="{{image}}" alt="{{name}}\'s Profile Image" />\n    </i>\n{{else}}\n    <i class="avatar large interactive"></i>\n{{/if}}\n\n\n<!--<form title="{{city}}, {{state}}. {{country}}. DOB: {{date_of_birth}} timezone: {{timezone}}">-->\n    <!--<input type="text" name="name" placeholder="Name" class="input large input-block-level" value="{{name}}" >-->\n    <!--<input type="text" name="email" placeholder="email@address.com" class="input large input-block-level" value="{{email}}">-->\n    <!--<button class="btn btn-large btn-block btn-inverse" type="submit">Save</button>-->\n<!--</form>-->\n\n\n'}),define("entities/properties",["backbone"],function(e){var t,i,n,s,r;return r="entities/properities",n={selectByIcon:"select_by_icon",email:"email",password:"password",url:"url",tel:"tel",date:"date",text:"text",select:"select",rocker:"rocker",checkbox:"checkbox"},s=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},i=e.Model.extend({defaults:{string_id:null,label:null,type:n.text,required:null,value:null,multiSelect:null},initialize:function(){}}),t=e.Collection.extend({model:i}),t.TYPES=n,t}),define("text!ui_widgets/formation/select_by_icon.hbs",[],function(){return'\n\n{{#if label}}\n    <label for="{{string_id}}">{{label}}</label>\n{{else}}\n    {{#if question}}\n        <label for="{{string_id}}">{{question}}</label>\n    {{/if}}\n{{/if}}\n\n\n<select name="{{string_id}}" {{#if multiselect}}multiple{{/if}}>\n    {{#unless multiselect}}\n        <option value="">Select...</option>\n    {{/unless}}\n    {{#options}}\n        <option value="{{value}}">{{value}}</option>\n    {{/options}}\n</select>\n\n\n<span class="purdyBts noDisplay">\n    {{#options}}\n        <button value="{{value}}" class="btn btn-large btn-link btn-tall" type="button">\n            <i class="\n                {{#if icon}}\n                    {{icon}}\n                {{else}}\n                    gfx-{{value}}\n                {{/if}}">\n            </i>\n            <small>\n                {{#if label}}\n                    {{label}}\n                {{else}}\n                    {{value}}\n                {{/if}}\n            </small>\n        </button>\n    {{/options}}\n</span>\n\n\n'}),define("ui_widgets/formation/select_by_icon",["jquery","backbone","Handlebars","text!./select_by_icon.hbs"],function(e,t,i,n){var s,r,o,a,l;return o="ui_widgets/formation/select_by_icon",l=i.compile(n),a="active",r=".purdyBts",s=t.View.extend({className:"field selectByIcon",events:{"click .btn":"onBtnClick","change select":"onSelectChange"},initialize:function(){return this.$el.addClass(this.model.attributes.string_id)},render:function(){return this.$el.html(l(this.model.attributes)),this.$(r).css({display:"inline-block"}),this.$("select").hide(),this},_syncSelectByBtn:function(){var t;return t=[],this.$("button").each(function(){return e(this).hasClass(a)?t.push(e(this).val()):void 0}),this.$("select").val(t),this.model.set("value",this.$("select").val()),this.$("select").trigger("change")},_syncBtnBySelect:function(){var t;return t=this.$("select").val(),this.$("button").each(function(){if(e(this).removeClass(a),_.isArray(t)){if(_.contains(t,e(this).val()))return e(this).addClass(a)}else if(e(this).val()===t)return e(this).addClass(a)})},onBtnClick:function(t){var i,n;return i=e(t.currentTarget),n=i.val(),i.toggleClass(a),i.hasClass(a)&&(this.model.attributes.multiselect||i.siblings("."+a).removeClass(a)),this._syncSelectByBtn()},onSelectChange:function(){return this._syncBtnBySelect(),this.trigger("change",{model:this.model,value:this.$("select").val()})}})}),define("text!ui_widgets/formation/standard_field.hbs",[],function(){return'\n<div class="field {{string_id}}">\n\n    {{#if label}}\n        <label for="{{string_id}}">{{label}}</label>\n    {{/if}}\n\n    <input\n       name="{{string_id}}"\n       class="{{className}}"\n       type="{{type}}"\n       value="{{value}}"\n        {{#if placeholder}}\n           placeholder="{{placeholder}}"\n        {{/if}}\n        {{#if required}}\n            required\n        {{/if}}\n\n\n    />\n\n</div>\n\n'}),define("text!ui_widgets/formation/select_field.hbs",[],function(){return'\n<div class="field {{string_id}}">\n\n    {{#if label}}\n        <label for="{{string_id}}">{{label}}</label>\n    {{/if}}\n\n    <select class="{{className}}" name="{{string_id}}" {{#if multiselect}}multiple{{/if}}>\n        {{#unless multiselect}}\n            {{#if defaultOption}}\n                <option value=\'\'>{{defaultOption}}</option>\n            {{else}}\n                <option value=\'\'>Select...</option>\n            {{/if}}\n        {{/unless}}\n        {{#options}}\n            <option value="{{this}}">{{this}}</option>\n        {{/options}}\n    </select>\n\n</div>\n\n\n\n\n\n'}),define("text!ui_widgets/formation/date_field.hbs",[],function(){return'\n<div class="field {{string_id}}">\n\n    {{#if label}}\n        <label for="{{string_id}}">{{label}}</label>\n    {{/if}}\n\n    <input\n        name="{{string_id}}"\n        type="date"\n        class="{{className}}"\n        value="{{value}}"\n        {{#if placeholder}}\n            placeholder="{{placeholder}}"\n        {{/if}}\n        {{#if required}}\n            required\n        {{/if}}\n        />\n\n</div>\n\n'}),define("text!ui_widgets/formation/button.hbs",[],function(){return'\n<div class="buttonArea">\n    <button type=\'submit\' class="btn {{className}}">\n        {{#if text}}\n            {{text}}\n        {{else}}\n            Save\n        {{/if}}\n    </button>\n</div>'}),define("text!ui_widgets/formation/rocker.hbs",[],function(){return'\n<div class="field {{string_id}}">\n\n    {{#if label}}\n        <label for="{{string_id}}">{{label}}</label>\n    {{/if}}\n\n    <div class="btn-group btn-rocker {{className}}">\n        {{#options}}\n            <button class="btn" type="button" value="{{this}}">{{this}}</button>\n        {{/options}}\n        <input\n            type="hidden"\n            name="{{string_id}}"\n            value="{{value}}"\n        />\n    </div>\n\n</div>\n\n'}),define("text!ui_widgets/formation/checkbox.hbs",[],function(){return'\n<div class="field {{string_id}}">\n\n    <input\n        id="field-{{string_id}}"\n        name="{{string_id}}"\n        class="{{className}}"\n        type="checkbox"\n        value="{{value}}"\n        {{#if required}}\n            required\n        {{/if}}\n    />\n\n    {{#if label}}\n        <label class="forCheckbox" for="field-{{string_id}}">{{label}}</label>\n    {{/if}}\n\n</div>\n\n'}),define("ui_widgets/formation/main",["backbone","Handlebars","entities/properties","syphon","./select_by_icon","text!./standard_field.hbs","text!./select_field.hbs","text!./date_field.hbs","text!./button.hbs","text!./rocker.hbs","text!./checkbox.hbs"],function(e,t,i,n,s,r,o,a,l,c,h){var u,d,p,f,m,g,v;return v=t.compile(r),g=t.compile(o),f=t.compile(a),d=t.compile(l),m=t.compile(c),p=t.compile(h),u=e.View.extend({tagName:"form",className:"formation clearfix",initialize:function(){if(!this.options.data)throw new Error("Need options.data");return this.collection=new i(this.options.data)},render:function(){var e=this;return this.$el.empty(),this.collection.each(function(t){return e.$el.append(e._renderProperty(t))}),null!=this.options.submitBtn&&this.$el.append(d(this.options.submitBtn)),null!=this.options.values&&this.setVals(this.options.values),this},_renderProperty:function(e){var t,n;switch(t=i.TYPES,e.get("type")){case t.select:return g(e.attributes);case t.selectByIcon:return n=new s({model:e}),n.render().el;case t.date:return f(e.attributes);case t.rocker:return m(e.attributes);case t.checkbox:return p(e.attributes);default:return console.log("Building a standard form field for type "+e.get("type")),v(e.attributes)}},getVals:function(){var e,t,i;t=n.serialize(this.el);for(e in t)i=t[e],i||delete t[e];return t},setVals:function(e){return n.deserialize(this.el,e),this.$("select").trigger("change"),this}})}),define("ui_widgets/formation",["ui_widgets/formation/main"],function(e){return e}),define("forms/user/profile-fields",[],function(){return[{string_id:"name",label:"Name",placeholder:"Captain Nemo",className:"large input-block-level"},{string_id:"email",label:"Email",type:"email",placeholder:"email@address.com",className:"large input-block-level"},{string_id:"dob",type:"date",label:"Birthdate",className:"large input-block-level"},{string_id:"education",label:"Education",type:"select",className:"large input-block-level",options:["High School - Freshman (9)","High School - Sophmore (10)","High School - Junior (11)","High School - Senior (12)","College - Less than 2 yrs","College - Associates","College - Bachelor's","College - Master's","College - Ph.D.","Prefer not to answer"]},{string_id:"handedness",type:"select_by_icon",label:"Handedness",options:[{value:"left",label:"Left",icon:"gfx-lefthand"},{value:"right",label:"Right",icon:"gfx-righthand"},{value:"mixed",label:"Mixed",icon:"gfx-bothhands"}]},{string_id:"gender",label:"",type:"select_by_icon",label:"Gender",options:[{value:"female",label:"Female",icon:"gfx-female"},{value:"male",label:"Male",icon:"gfx-male"}]}]}),define("forms/user/profile",["jquery","underscore","backbone","Handlebars","text!./profile.hbs","ui_widgets/formation","./profile-fields","ui_widgets/hold_please","ui_widgets/psst","composite_views/perch"],function(e,t,i,n,s,r,o,a,l,c){var h,u,d,p,f,m;return p="forms/profile/user_profile",f="[type=submit]",d=".formation .buttonArea",u="<div id='ProfileErrorHolder'></div>",m=n.compile(s),h=i.View.extend({className:"userProfile",events:{"submit form":"onSubmit","input change":"onInputChange"},initialize:function(){return this.listenTo(this.model,"error",this.onError),this.listenTo(this.model,"invalid",this.onInvalid),this.listenTo(this.model,"sync",this.onSync)},render:function(){return this.$el.html(m(this.model.attributes)),this.form=new r({data:o,values:this.model.attributes,submitBtn:{className:"btn-large btn-block btn-inverse"}}),this.$el.append(this.form.render().el),this},_showErr:function(e){return l.hide(),l({sel:d,msg:e,type:"error"}),a.hide(this.$(f))},onInputChange:function(){return l.hide()},onSubmit:function(e){var t;return e.preventDefault(),l.hide(),a.show(this.$(f)),t=this.form.getVals(),this.model.save(t,{wait:!0,profile:!0})},onSync:function(){return c.hide()},onError:function(e,t){var i;return i=0===t.status?"Unknown Server Error":""+t.status+": "+t.statusText,this._showErr(i)},onInvalid:function(e,t){return this._showErr(t)}})}),define("text!preferences/personalization.hbs",[],function(){return'\n<ol class="stepsRemainingWizard steps-3 clearfix">\n    <li>Productivity</li>\n    <li>Mood</li>\n    <li>Complete</li>\n</ol>\n\n<div class="explanation"></div>\n\n<div class="content"></div>\n\n<div class="actionZone clearfix">\n    <button\n            id="ActionNext"\n            class="btn btn-large btn-link brandHappy pull-right" type="button">\n        Next\n        <span class="icon-stack">\n            <i class="icon-circle-blank icon-stack-base"></i>\n            <i class="icon-arrow-right"></i>\n        </span>\n    </button>\n</div>\n\n<div class="footer brandHappy small">\n\n</div>\n\n'
}),define("text!preferences/personalization-games.hbs",[],function(){return'\n<p class="bling">\n    You will be guided with daily tasks based on your preferences and your personality. We recommend that you start with these games.\n</p>\n\n<div class="games">\n    <p><a class="btn btn-link" href="#game/emotions">The Emotions Game</a></p>\n    <p><a class="btn btn-link" href="#game/reaction_time">The Reaction Time Game</a></p>\n</div>\n\n'}),define("preferences/personalization-fields-productivity",[],function(){return[{string_id:"f",label:"Accomplish more in less time",type:"checkbox"},{string_id:"g",label:"Stay focused on what is important",type:"checkbox"},{string_id:"h",label:"Understand your daily emotional cycles",type:"checkbox"},{string_id:"i",label:"Develop support networks for personal and professional fulfillment",type:"checkbox"}]}),define("preferences/personalization-fields-mood",[],function(){return[{string_id:"a",label:"Channel your emotional energy to confront and conquer problems",type:"checkbox"},{string_id:"b",label:"Understand and improve stress points with friends, colleagues, and spouses",type:"checkbox"},{string_id:"c",label:"Feel more rested with the same amount of sleep",type:"checkbox"},{string_id:"d",label:"Stop panic, don't let it control you",type:"checkbox"},{string_id:"e",label:"Speak with purpose in front of any size of group",type:"checkbox"}]}),define("preferences/personalization",["jquery","underscore","backbone","Handlebars","text!./personalization.hbs","text!./personalization-games.hbs","ui_widgets/formation","./personalization-fields-productivity","./personalization-fields-mood","ui_widgets/hold_please","ui_widgets/psst","composite_views/perch"],function(e,t,i,n,s,r,o,a,l,c,h,u){var d,p,f,m,g,v,b,_,y,w,k,S,x;return p=".actionZone .btn",m=".content",k=".stepsRemainingWizard li",f="complete",x=n.compile(s),b=[a,l],S=["1. Productivity","2. Mood"],y=["TidePool's patented exercises are designed by top American psychologists.","Many TidePool users report positive results and also shared TidePool with friends and family.","TidePool games will improve your self-awareness and coach you to achieve your goals."],_=".footer",w=n.compile('<i class="icon-info-sign"></i> &nbsp; {{text}}'),g=".explanation",v=n.compile('<h3>{{title}}</h3><p class="small">{{subtitle}}</p>'),d=i.View.extend({className:"personalization",events:{"click #ActionNext":"onClickNext","submit form":"onSubmit","input change":"onInputChange","click .games a":"onGameClicked"},initialize:function(){return this.curPage=0},render:function(){return this.$el.html(x),this._showFields(this.curPage),this},_showFields:function(e){return this._indexActions(e),this.$(g).html(v({title:S[e],subtitle:"Select all options that you are interested to improve."})),this.form=new o({data:b[e]}),this.$(m).html(this.form.render().el),this},_getData:function(){var e;if(null!=this.form)return e=this.form.getVals(),this.data=this.data||{},this.data=t.extend(this.data,e),this},_indexActions:function(e){return this.$(k).eq(e).addClass(f),this.$(_).html(w({text:y[e]}))},_showComplete:function(e){return this._indexActions(e),this.$(g).html(v({title:"Your Personalized Program is ready!",subtitle:"You can go back at any time and change your preferences."})),this.$(m).html(r),this.$(p).remove(),this},_showErr:function(e){return h.hide(),h({sel:_errorHolderSel,msg:e,type:"error"}),c.hide(this.$(_submitBtnSel))},onInputChange:function(){return h.hide()},onSubmit:function(e){var t;return e.preventDefault(),h.hide(),c.show(this.$(_submitBtnSel)),t=this.form.getVals(),this.model.save(t,{wait:!0})},onSync:function(){return u.hide()},onError:function(e,t){var i;return i=0===t.status?"Unknown Server Error":""+t.status+": "+t.statusText,this._showErr(i)},onInvalid:function(e,t){return this._showErr(t)},onClickNext:function(){var e;return this.curPage++,null!=(e=this.form)&&e.remove(),this.curPage===b.length?this._getData()._showComplete(this.curPage):this._getData()._showFields(this.curPage)},onGameClicked:function(){return u.hide()}})}),define("core/mediator",["underscore","backbone","composite_views/perch","forms/user/login","forms/user/profile","preferences/personalization"],function(e,t,i,n,s,r){var o,a;return a="core/mediator",o=t.View.extend({initialize:function(){if(null==this.options.app)throw new Error("Need options.app");return i.options.app=this.options.app,this._mediate()},_mediate:function(){return this.listenTo(this.options.app,"session:showLogin",this._showLogin),this.listenTo(this.options.app,"session:showRegister",this._showRegister),this.listenTo(this.options.app,"session:showProfile",this._showProfile),this.listenTo(this.options.app,"session:logOut",this._actionLogOut),this.listenTo(this.options.app,"action:showPersonalizations",this._showPersonalizations)},_showLogin:function(){return i.show({btn1Text:null,supressTracking:!0,content:new n({model:this.options.app.user,app:this.options.app})})},_showRegister:function(){return i.show({btn1Text:null,supressTracking:!0,content:new n({model:this.options.app.user,app:this.options.app,register:!0})})},_showProfile:function(){return i.show({title:"Profile",btn1Text:null,content:new s({model:this.options.app.user})})},_showPersonalizations:function(){return i.show({title:'<i class="icon-cog"></i> Your Preferences',className:"brandHappy",btn1Text:null,huge:!0,content:new r})},_actionLogOut:function(){return this.options.app.analytics.track("session","Pressed Log Out"),this.options.app.router.navigate("home",{trigger:!0}),this.options.app.session.logOut()}})}),define("text!core/layouts/layout.hbs",[],function(){return'\n\n\n\n\n<header class="header">\n    <div class="inner" id="HeaderRegion"></div>\n</header>\n<div class="content clearfix" id="ContentRegion"></div>\n<div class="noDisplay" id="StagingRegion"></div>\n\n\n\n'}),define("text!ui_widgets/site_logo.hbs",[],function(){return'\n<a class="siteLogo" href="#">\n    <h1>TidePool</h1>\n</a>'}),define("core/layouts/layout",["underscore","backbone","Handlebars","text!./layout.hbs","text!ui_widgets/site_logo.hbs"],function(e,t,i,n,s){var r,o;return o="core/layouts/layout",r=t.View.extend({tmpl:i.compile(n),initialize:function(){return $("body").prop("class","background-"+this.className+" route-"+location.hash.split("#").join(""))},_cleanupChildren:function(){var e,t;return null!=(e=this._curView)&&"function"==typeof e.close&&e.close(),null!=(t=this._curView)?t.remove():void 0},show:function(e){return this._cleanupChildren(),this._curView=e,this.$("#ContentRegion").html(this._curView.render().el)},close:function(){return this._cleanupChildren()},resetHeader:function(){return this.$("#HeaderRegion").html(s)}})}),define("text!ui_widgets/main_nav.hbs",[],function(){return'\n<nav class="mainNav nav">\n    <ul>\n        <li><a href="#about" class="pages-about">About</a></li>\n        <li><a href="#team" class="pages-team">Team</a></li>\n    </ul>\n</nav>\n'}),define("text!ui_widgets/user_menu.hbs",[],function(){return'\n\n\n\n{{#if nickname}}\n\n    <button class="btn btn-clear btn-large dropdown-toggle">\n        <ul class="dropdown-menu">\n            <li><a id="ActionShowProfile">\n                <i class="icon-fixed-width icon-user"></i>\n                Profile\n            </a></li>\n            <li><a href="#dashboard">\n                <i class="icon-fixed-width icon-th-large"></i>\n                Dashboard\n            </a></li>\n            <li><a id="ActionShowPersonalizations">\n                <i class="icon-fixed-width icon-cog"></i>\n                Personalize\n            </a></li>\n            <li><a id="ActionLogOut">\n                <i class="icon-fixed-width icon-unlink"></i>\n                Log Out\n            </a></li>\n        </ul>\n        <i class="avatar">\n            {{#if image}}\n                <img src="{{image}}" alt="{{nickname}}\'s Profile Image" />\n            {{/if}}\n        </i>\n        <span title="{{name}}: {{email}}">{{nickname}}</span>\n        <i class="icon-chevron-sign-down muted"></i>\n    </button>\n\n{{else}}\n\n    <button id="ActionShowLogin" class="btn btn-link btn-large" href="">\n        <i class="icon-lock icon-large"></i>\n        Log In\n    </button>\n\n{{/if}}\n\n\n\n'}),define("ui_widgets/user_menu",["jquery","underscore","backbone","Handlebars","text!./user_menu.hbs"],function(e,t,i,n,s){var r,o;return o="ui_widgets/user_menu",r=i.View.extend({className:"userMenu",tmpl:n.compile(s),events:{"click #ActionShowLogin":"_clickedLogIn","click #ActionLogOut":"_clickedLogOut","click #ActionShowProfile":"_clickedProfile","click #ActionShowPersonalizations":"_clickedPersonalizations"},start:function(e){if(!e.user)throw new Error("Need an options.user to start");return this.app=e,this.model=this.app.user,this.listenTo(this.model,"change",this.render),this.render(),this},stop:function(){return this.stopListening(),delete this.app,delete this.model},render:function(){var e;return e=this._parseModel(this.model),this.$el.html(this.tmpl(e)),this},_parseModel:function(e){return t.pick(e.attributes,"nickname","email","name","city","image","guest")},_clickedLogIn:function(){var e;return null!=(e=this.app)?e.trigger("session:showLogin"):void 0},_clickedLogOut:function(){var e;return null!=(e=this.app)?e.trigger("session:logOut"):void 0},_clickedProfile:function(){var e;return null!=(e=this.app)?e.trigger("session:showProfile"):void 0},_clickedPersonalizations:function(){var e;return null!=(e=this.app)?e.trigger("action:showPersonalizations"):void 0}}),new r}),define("core/layouts/layout-site",["underscore","backbone","Handlebars","./layout","text!ui_widgets/main_nav.hbs","ui_widgets/user_menu"],function(e,t,i,n,s,r){var o,a;return a="core/layouts/layout-site",o=n.extend({className:"siteLayout",initialize:function(){return o.__super__.initialize.call(this),this.render()},render:function(){return this.$el.html(this.tmpl()),o.__super__.resetHeader.call(this),r.delegateEvents(),this.$("#HeaderRegion").append(s).append(r.el),this}})}),define("core/layouts/layout-game",["underscore","backbone","Handlebars","./layout","ui_widgets/user_menu"],function(e,t,i,n){var s,r;return r="core/layouts/layout-game",s=n.extend({className:"gameLayout",initialize:function(){return s.__super__.initialize.call(this),this.render()},render:function(){return this.$el.html(this.tmpl()),s.__super__.resetHeader.call(this),this}})}),define("text!dashboard/action_items.hbs",[],function(){return'\n\n<div class="inner">\n    <hgroup class="welcome">\n        <h2>\n            {{pickOne greetings }}!\n        </h2>\n        <h5>\n            Wow, there\'s lots to do here. <br/>\n            Here\'s something to get you started.\n        </h5>\n    </hgroup>\n\n\n    <ul class="items">\n        <li class="item {{link_type}}"><a href="{{link}}">\n            <i class="icon-rocket {{icon}}"></i>\n            <p class="small">\n                <span class="uppercase">TidePool Recommends:</span> <strong>"{{title}}"</strong><br/>\n                {{sentence}}\n            </p>\n            <!--<p>-->\n            <!--Based on your personality, TidePool recommends this <em>{{link_type}}</em>.-->\n            <!--</p>-->\n        </a></li>\n    </ul>\n</div>\n\n\n'}),define("dashboard/action_items",["underscore","backbone","Handlebars","text!./action_items.hbs"],function(e,t,i,n){var s,r,o,a;return o=["Hello","Hi","Aloha","Bonjour","Hola","Hallo","Ahoy","G'Day","Howdy","Hiya"],i.registerHelper("pickOne",function(e){return e[Math.floor(Math.random()*e.length)]}),a=i.compile(n),s={Website:"gfx-recommend_website",Video:"gfx-recommend_video",Course:"gfx-recommend_course",Comic:"gfx-recommend_comic",Book:"gfx-recommend_book",App:"gfx-recommend_app",Activity:"gfx-recommend_activity"},r=t.View.extend({className:"actionItems",initialize:function(){var e=this;return require(["entities/cur_user_actions"],function(t){return e.collection=new t,e.listenTo(e.collection,"sync",e.onSync),e.collection.fetch()})},render:function(){var t,i;return i=this.collection.at(0),t=e.extend(i.attributes,{greetings:o}),t.icon=s[t.link_type],this.$el.html(a(t)),this},onSync:function(){return this.render()}})}),define("text!dashboard/dash_picker.hbs",[],function(){return'\n\n<nav class="dashPicker">\n    <ul>\n        <li><a class="summary" href="#dashboard">\n            <i class="icon-dashboard"></i>\n            <label>Summary</label>\n        </a></li>\n        <li><a class="productivity" href="#dashboard-productivity">\n            <i class="icon-briefcase"></i>\n            <label>Productivity</label>\n        </a></li>\n        <li><a class="mood" href="#dashboard-mood">\n            <i class="icon-smile"></i>\n            <label>Mood</label>\n        </a></li>\n    </ul>\n</nav>\n\n\n\n\n\n'}),define("core/layouts/layout-dashboard",["underscore","backbone","Handlebars","./layout","ui_widgets/user_menu","dashboard/action_items","text!dashboard/dash_picker.hbs"],function(e,t,i,n,s,r,o){var a,l;return l="core/layouts/layout-dashboard",a=n.extend({className:"dashboardLayout",initialize:function(){return a.__super__.initialize.call(this),this.render()},render:function(){var e;return this.$el.html(this.tmpl()),a.__super__.resetHeader.call(this),s.delegateEvents(),this.$("#HeaderRegion").append(s.el),e=new r,this.$(".content").before(e.el),this.$(".content").before(o)}})}),define("core/view",["underscore","backbone","./layouts/layout-site","./layouts/layout-game","./layouts/layout-dashboard","ui_widgets/user_menu","composite_views/perch","bootstrap"],function(e,t,i,n,s,r,o){var a,l,c,h;return c="core/view",l="TidePool",h=".mainNav",a=t.View.extend({initialize:function(){return $("body").append(this.el),r.start(this.options.app)},render:function(){return this._curLayout.show(this._curView),this.$el.html(this._curLayout.el),this},_cleanupOldView:function(){var e,t;return o.hide(),null!=(e=this._curView)&&"function"==typeof e.close&&e.close(),null!=(t=this._curView)?t.remove():void 0},_loadView:function(t,i){var n=this;return require([t],function(s){var r;return n._cleanupOldView(),n._curView=(null!=i?i.model:void 0)?new s({model:i.model}):new s({params:i}),n.render(),"function"==typeof(r=n._curView).onDomInsert&&r.onDomInsert(),document.title=n._curView.title?""+e.result(n._curView,"title")+" - "+l:l,n.options.app.analytics.trackPage(t)})},asSite:function(e,t){return this._curLayout=new i({app:this.options.app}),$("body").addClass(e.split("/").join("-")),this._loadView(e,t)},asGame:function(e,t){return this._curLayout=new n({app:this.options.app}),this._loadView(e,t)},asDash:function(e,t){return this._curLayout=new s({app:this.options.app}),this._loadView(e,t)}})}),define("core/router",["jquery","backbone"],function(e,t){var i,n,s;return n="routers/main_router",s="/welcome/",i=t.Router.extend({routes:{"":"showHome",home:"showHome",about:"showAbout",team:"showTeam",getStarted:"getStarted",startGame:"getStarted",demographics:"showDemographics","game/:def_id":"createGame",game:"createDefaultGame","gameResults/:id":"showGameResults",dashboard:"showDashboard","dashboard-mood":"showDashMood","dashboard-productivity":"showDashProductivity","referrer/:refId":"recordReferrer","preferences-training":"showTrainingPreferences"},initialize:function(e){return this.app=e},showHome:function(){return null!=this.app.user.attributes.referred_by?window.location.href=s+this.app.user.attributes.referred_by:this.app.view.asSite("pages/home")},getStarted:function(){return null!=this.app.user.attributes.personality?this.navigate("dashboard",{trigger:!0,replace:!0}):this.showDemographics()},showAbout:function(){return this.app.view.asSite("pages/about")},showTeam:function(){return this.app.view.asSite("pages/team")},showDemographics:function(){return this.app.view.asGame("pages/demographics")},createDefaultGame:function(){return this.createGame("baseline")},createGame:function(e){return this.app.view.asGame("pages/play_game",{def_id:e})},showGameResults:function(e){return this.app.view.asGame("pages/game_results",{game_id:e})},showDashboard:function(){return this.app.view.asDash("pages/dashboard/summary")},showDashProductivity:function(){return this.app.view.asDash("pages/dashboard/productivity")},showDashMood:function(){return this.app.view.asDash("pages/dashboard/mood")},recordReferrer:function(e){return this.app.analytics.track("Referral",e),this.app.user.set({referred_by:e}),this.showDemographics(),this.navigate("startGame",{replace:!0})},showTrainingPreferences:function(){return console.log("TODO: show training preferences")}})}),define("entities/games",["jquery","backbone","core"],function(e,t){var i,n;return n="entities/games",i=t.Model.extend({urlRoot:""+window.apiServerUrl+"/api/v1/users/-/games",initialize:function(){return this._levelsSeen=[],this},toJSON:function(){return _.pick(this.attributes,"stage_completed","def_id")},getLatestWithProfile:function(){var t;return t=e.Deferred(),this.fetch({url:""+this.url()+"/latest_with_profile"}).done(function(){return console.log("Got the latest game"),t.resolve()}).fail(function(){return t.reject()}),t.promise()},create:function(e){return e?this.save({def_id:e}):this.save(),this},nextStage:function(){var e;return e=this.get("stage_completed"),this.save({stage_completed:e+1})},setLevelSeen:function(e){return this._levelsSeen.push(e),this._levelsSeen=_.uniq(this._levelsSeen),this},isFirstTimeSeeingLevel:function(e){return e?_.contains(this._levelsSeen,e)?!1:!0:null}})}),define("entities/user",["underscore","backbone","entities/games"],function(e,t,i){var n,s;return s="entities/user",n=t.Model.extend({urlRoot:""+window.apiServerUrl+"/api/v1/users",defaults:function(){return{id:"-",accessToken:sessionStorage.access_token}},initialize:function(){return this.on("change:name",this._calculateNickname),this.on("change:email",this._calculateNickname),this.on("change:guest",this._calculateNickname),this.on("error",this._onModelError),this.on("invalid",this._onModelInvalid)},validate:function(e,t){if(e.guest===!0)return null;if(t.login||t.register){if(!e.email)return"The email address cannot be blank.";if(!e.password)return"The password cannot be blank.";if(!(e.password.length>=8))return"The password should be 8 or more characters."}if(t.register){if(!e.passwordConfirm)return"The confirm password field cannot be blank";if(e.password!==e.passwordConfirm)return"The passwords should match"}return t.profile&&!e.email?"The email address cannot be blank.":null},_calculateNickname:function(){var e;return this.isGuest()||(e=this.get("name")||this.get("email")),this.set({nickname:e},{silent:!0})},_nuke:function(){return delete sessionStorage.access_token,delete sessionStorage.expires_in,delete sessionStorage.token_received,delete sessionStorage.refresh_token,delete sessionStorage.guest},_onModelError:function(e,t){var i;return console.log(""+s+"._onModelError() xhr.statusText: "+t.statusText),console.log({xhr:t}),401===t.status?null!=(i=this.session)?i.logOut():void 0:void 0},_onModelInvalid:function(e,t){return console.log(""+s+"._onModelInvalid(): "+t)},parseHash:function(e){var t,i,n,s;for(i={},n=e.substring(1),s=/([^&=]+)=([^&]*)/g;t=s.exec(n);)i[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return i},addAuthentication:function(t,i){var n,s,r,o;return s=window.screenLeft+50,r=window.screenTop+50,o=i.width,n=i.height,window.addAuthRedirect=e.bind(this.onAddAuthRedirect,this),window.open(this.setupAddAuthUrl(t),"Login","width="+o+", height="+n+", left="+s+", top="+r+", menubar=no")},setupAddAuthUrl:function(e){var t,i,n;return t=""+window.apiServerUrl+"/auth/additional",n=""+window.location.protocol+"//"+window.location.host+"/additional_redirect.html#",n=encodeURIComponent(n),i="provider="+e+"&",""+t+"?redirect_uri="+n+"&user_id="+this.get("id")+"&provider="+e},onAddAuthRedirect:function(e,t){var i;return console.log("onAddAuthRedirect called with "+t+" and hash "+e),i=this.parseHash(e),console.log("params are: "+i.user_id+" and "+i.provider),this.trigger("user:authentication_added",i.provider)},isNew:function(){return!this.get("accessToken")},createGame:function(e){var t,n=this;return t=new i,this.isLoggedIn()?t.create(e):this.session.logInAsGuest().done(function(){return t.create(e)}).fail(function(){return n.trigger("error:createGame"),console.log(""+s+".createGame.fail()")}),t},isGuest:function(){return!!this.get("guest")},hasCurrentToken:function(){var e,t,i,n,s;return e=!1,(null!=(s=this.get("accessToken"))?s.length:void 0)&&(t=(new Date).getTime(),i=parseInt(sessionStorage.expires_in),n=parseInt(sessionStorage.token_received),null!=i&&null!=n&&n+i>t?e=!0:this._nuke()),e},isLoggedIn:function(){return this.hasCurrentToken()},reset:function(){return this.clear().set(this.defaults()),this}})}),define("controllers/session_controller",["jquery","underscore","backbone","Handlebars"],function(e,t){var i,n,s;return s="controllers/session_controller",n="/oauth/authorize",i=function(i){var s=this;return this.options=i,this.user=this.options.app.user,this.cfg=this.options.app.cfg,t.bindAll(this,"onUserSync"),this.user.on("sync",this.onUserSync),this._authUrl=""+this.cfg.apiServer+n,e.ajaxSetup({type:"POST",timeout:5e3,headers:{"X-CSRF-Token":e('meta[name="csrf-token"]').attr("content"),Accept:"application/json"},dataType:"json",beforeSend:function(e){var t;return s.user.hasCurrentToken()?(t="Bearer "+s.user.get("accessToken"),e.setRequestHeader("Authorization",t)):void 0}}),this.user.hasCurrentToken()&&this.user.fetch(),this},i.prototype={signIn:function(){var t,i=this;return t=e.Deferred(),this.user.hasCurrentToken()&&!this.user.isGuest()?this.user.fetch().done(function(){return t.resolve("Success")}).fail(function(e,i){return t.reject(i)}):e.ajax({url:this._authUrl,type:"POST",data:{grant_type:"password",response_type:"password",email:this.user.get("email"),password:this.user.get("password"),client_id:this.cfg.appId,client_secret:this.cfg.appSecret}}).done(function(e){return i._persistLocally(e),i.user.reset().fetch().done(function(){return i.options.app.analytics.track("session","Successful Sign In"),t.resolve("Success")}).fail(function(e,n){return i.options.app.analytics.track("session","Failed Sign In"),t.reject(n)})}).fail(function(e,n){return i.user.trigger("error",i.user,e),t.reject(n)}),t.promise()},register:function(){var t,i=this;return t=e.Deferred(),this.user.save().done(function(){return i.signIn().done(function(){return i.options.app.analytics.track("session","Successful Registration"),t.resolve("Success")}).fail(function(){return i.options.app.analytics.track("session","Failed Registration"),t.reject("Fail")})}),t.promise()},onUserSync:function(e){var t;return t=e.isGuest()?e.attributes.id:e.attributes.email,this.options.app.analytics.setUserIdentity(t)},_nuke:function(){return delete sessionStorage.access_token,delete sessionStorage.expires_in,delete sessionStorage.token_received,delete sessionStorage.refresh_token,delete sessionStorage.guest},_buildExternalServiceUrl:function(e){var t,i,n,s;return n=encodeURIComponent(""+window.location.protocol+"//"+window.location.host+"/redirect.html"),t="provider="+e+"&",i=this.user.get("guest")?"guest_id="+this.user.get("id")+"&":"",s=""+this._authUrl+"?"+t+i+"client_id="+this.cfg.appId+"&redirect_uri="+n+"&response_type=token"},_parseHash:function(e){var t,i,n,s;for(i={},n=e.substring(1),s=/([^&=]+)=([^&]*)/g;t=s.exec(n);)i[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return i},_persistLocally:function(e){return sessionStorage.access_token=e.access_token,sessionStorage.expires_in=1e3*e.expires_in,sessionStorage.token_received=(new Date).getTime(),sessionStorage.refresh_token=e.refresh_token},logInAsGuest:function(){var t;return t=e.Deferred(),this.user.set({guest:!0}),this.register().done(function(){return t.resolve("Success")}).fail(function(){return t.reject("Fail")}),t.promise()},loginUsingOauth:function(e,i){var n,s,r,o;return s=window.screenLeft+50,r=window.screenTop+50,o=i.width,n=i.height,window.OAuthRedirect=t.bind(this.externalAuthServiceCallback,this),window.open(this._buildExternalServiceUrl(e),"Login","width="+o+", height="+n+", left="+s+", top="+r+", menubar=no")},logOut:function(){return this._nuke(),this.user.reset()},externalAuthServiceCallback:function(e){var t;return t=this._parseHash(e),t.access_token?(this.logOut(),this._persistLocally(t),this.user.reset(),this.user.fetch()):console.log("Odd Error, no token received but redirected"),this.options.app.analytics.track("session","Successful External Auth Login")}},i}),define("core/main",["underscore","backbone","./config","./analytics","./mediator","./view","./router","entities/user","controllers/session_controller"],function(e,t,i,n,s,r,o,a,l){var c,h,u;return u="core/main",c=function(){return this.cfg=i,e.extend(this,t.Events),this.user=new a,this},c.prototype={start:function(){return this.analytics=new n(this.cfg),this.session=new l({app:this}),this.user.session=this.session,this.view=new r({app:this}),this.mediator=new s({app:this}),this.router=new o(this),t.history.start(),this}},h=new c}),define("core",["core/main"],function(e){return e}),define("text!dashboard/personality/core.hbs",[],function(){return'\n\n<div class="widget pressable">\n    <div class="hero clearfix">\n        {{#if logo_url}}\n            <img class="personalityBadge" src="/images/badges/{{logo_url}}" alt="{{name}}">\n        {{/if}}\n        {{{one_liner}}}\n    </div>\n    <ul>\n        {{#each bullet_description}}\n            <li>\n                <i class="icon-bookmark icon-2x"></i>\n                {{{ this }}}\n            </li>\n        {{/each}}\n    </ul>\n</div>\n\n\n'}),define("text!dashboard/widgets/base/loading.hbs",[],function(){return'\n\n<div class="widget loading">\n    <b class="holdPlease">\n        <i class="icon-repeat icon-large"></i>\n    </b>\n</div>\n\n\n'}),define("text!dashboard/widgets/base/base.hbs",[],function(){return'\n\n<div class="widget {{className}}">\n    {{#if title}}\n        <h3>{{title}}</h3>\n    {{/if}}\n</div>\n\n\n'}),define("dashboard/widgets/base/main",["backbone","Handlebars","text!./loading.hbs","text!./base.hbs"],function(e,t,i,n){var s,r,o;return o="dashboard/widget",r="holder",s=e.View.extend({className:r,tagName:"section",tmplBase:t.compile(n),initialize:function(){return this.model?(this.renderLoading(),this.listenTo(this.model,"sync",this.onSync),this.listenTo(this.model,"error",this.onErr)):this.collection?(this.renderLoading(),this.listenTo(this.collection,"sync",this.onSync),this.listenTo(this.collection,"error",this.onErr)):this.render(),this.$el.addClass(r),"function"==typeof this.start?this.start():void 0},render:function(){return this.tmpl?this.$el.html(this.tmpl):this.$el.html(n),this},onSync:function(){return this.collection&&0===this.collection.length?this.remove():this.model&&_.isEmpty(this.model.attributes)?this.remove():this.render()},onErr:function(){return console.warn(""+o+" Error with the widget's model, hiding the widget."),this.remove()},renderLoading:function(){return this.$el.html(i),this}})}),define("dashboard/widgets/base",["dashboard/widgets/base/main"],function(e){return e}),function(e){function t(){return"Markdown.mk_block( "+uneval(this.toString())+", "+uneval(this.trailing)+", "+uneval(this.lineNumber)+" )"}function i(){var e=require("util");return"Markdown.mk_block( "+e.inspect(this.toString())+", "+e.inspect(this.trailing)+", "+e.inspect(this.lineNumber)+" )"}function n(e){for(var t=0,i=-1;-1!==(i=e.indexOf("\n",i+1));)t++;return t}function s(e,t){function i(e){this.len_after=e,this.name="close_"+t}var n=e+"_state",s="strong"==e?"em_state":"strong_state";return function(r){if(this[n][0]==t)return this[n].shift(),[r.length,new i(r.length-t.length)];var o=this[s].slice(),a=this[n].slice();this[n].unshift(t);var l=this.processInline(r.substr(t.length)),c=l[l.length-1];if(this[n].shift(),c instanceof i){l.pop();var h=r.length-c.len_after;return[h,[e].concat(l)]}return this[s]=o,this[n]=a,[t.length,t]}}function r(e){for(var t=e.split(""),i=[""],n=!1;t.length;){var s=t.shift();switch(s){case" ":n?i[i.length-1]+=s:i.push("");break;case"'":case'"':n=!n;break;case"\\":s=t.shift();default:i[i.length-1]+=s}}return i}function o(e){return g(e)&&e.length>1&&"object"==typeof e[1]&&!g(e[1])?e[1]:void 0}function l(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function c(e){if("string"==typeof e)return l(e);var t=e.shift(),i={},n=[];for(!e.length||"object"!=typeof e[0]||e[0]instanceof Array||(i=e.shift());e.length;)n.push(arguments.callee(e.shift()));var s="";for(var r in i)s+=" "+r+'="'+l(i[r])+'"';return"img"==t||"br"==t||"hr"==t?"<"+t+s+"/>":"<"+t+s+">"+n.join("")+"</"+t+">"}function h(e,t,i){var n;i=i||{};var s=e.slice(0);"function"==typeof i.preprocessTreeNode&&(s=i.preprocessTreeNode(s,t));var r=o(s);if(r){s[1]={};for(n in r)s[1][n]=r[n];r=s[1]}if("string"==typeof s)return s;switch(s[0]){case"header":s[0]="h"+s[1].level,delete s[1].level;break;case"bulletlist":s[0]="ul";break;case"numberlist":s[0]="ol";break;case"listitem":s[0]="li";break;case"para":s[0]="p";break;case"markdown":s[0]="html",r&&delete r.references;break;case"code_block":s[0]="pre",n=r?2:1;var a=["code"];a.push.apply(a,s.splice(n)),s[n]=a;break;case"inlinecode":s[0]="code";break;case"img":s[1].src=s[1].href,delete s[1].href;break;case"linebreak":s[0]="br";break;case"link":s[0]="a";break;case"link_ref":s[0]="a";var l=t[r.ref];if(!l)return r.original;delete r.ref,r.href=l.href,l.title&&(r.title=l.title),delete r.original;break;case"img_ref":s[0]="img";var l=t[r.ref];if(!l)return r.original;delete r.ref,r.src=l.href,l.title&&(r.title=l.title),delete r.original}if(n=1,r){for(var c in s[1])n=2;1===n&&s.splice(n,1)}for(;n<s.length;++n)s[n]=arguments.callee(s[n],t,i);return s}function u(e){for(var t=o(e)?2:1;t<e.length;)"string"==typeof e[t]?t+1<e.length&&"string"==typeof e[t+1]?e[t]+=e.splice(t+1,1)[0]:++t:(arguments.callee(e[t]),++t)}var d=e.Markdown=function v(e){switch(typeof e){case"undefined":this.dialect=v.dialects.Gruber;break;case"object":this.dialect=e;break;default:if(!(e in v.dialects))throw new Error("Unknown Markdown dialect '"+String(e)+"'");this.dialect=v.dialects[e]}this.em_state=[],this.strong_state=[],this.debug_indent=""};e.parse=function(e,t){var i=new d(t);return i.toTree(e)},e.toHTML=function(t,i,n){var s=e.toHTMLTree(t,i,n);return e.renderJsonML(s)},e.toHTMLTree=function(e,t,i){"string"==typeof e&&(e=this.parse(e,t));var n=o(e),s={};n&&n.references&&(s=n.references);var r=h(e,s,i);return u(r),r};var f=d.mk_block=function(e,n,s){1==arguments.length&&(n="\n\n");var r=new String(e);return r.trailing=n,r.inspect=i,r.toSource=t,void 0!=s&&(r.lineNumber=s),r};d.prototype.split_blocks=function(e){var t,i=/([\s\S]+?)($|\n(?:\s*\n|$)+)/g,s=[],r=1;for(null!=(t=/^(\s*\n)/.exec(e))&&(r+=n(t[0]),i.lastIndex=t[0].length);null!==(t=i.exec(e));)s.push(f(t[1],t[2],r)),r+=n(t[0]);return s},d.prototype.processBlock=function(e,t){var i=this.dialect.block,n=i.__order__;if("__call__"in i)return i.__call__.call(this,e,t);for(var s=0;s<n.length;s++){var r=i[n[s]].call(this,e,t);if(r)return(!g(r)||r.length>0&&!g(r[0]))&&this.debug(n[s],"didn't return a proper array"),r}return[]},d.prototype.processInline=function(e){return this.dialect.inline.__call__.call(this,String(e))},d.prototype.toTree=function(e,t){var i=e instanceof Array?e:this.split_blocks(e),n=this.tree;try{for(this.tree=t||this.tree||["markdown"];i.length;){var s=this.processBlock(i.shift(),i);s.length&&this.tree.push.apply(this.tree,s)}return this.tree}finally{t&&(this.tree=n)}},d.prototype.debug=function(){var e=Array.prototype.slice.call(arguments);e.unshift(this.debug_indent),"undefined"!=typeof print&&print.apply(print,e),"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log.apply(null,e)},d.prototype.loop_re_over_block=function(e,t,i){for(var n,s=t.valueOf();s.length&&null!=(n=e.exec(s));)s=s.substr(n[0].length),i.call(this,n);return s},d.dialects={},d.dialects.Gruber={block:{atxHeader:function(e,t){var i=e.match(/^(#{1,6})\s*(.*?)\s*#*\s*(?:\n|$)/);
if(!i)return void 0;var n=["header",{level:i[1].length}];return Array.prototype.push.apply(n,this.processInline(i[2])),i[0].length<e.length&&t.unshift(f(e.substr(i[0].length),e.trailing,e.lineNumber+2)),[n]},setextHeader:function(e,t){var i=e.match(/^(.*)\n([-=])\2\2+(?:\n|$)/);if(!i)return void 0;var n="="===i[2]?1:2,s=["header",{level:n},i[1]];return i[0].length<e.length&&t.unshift(f(e.substr(i[0].length),e.trailing,e.lineNumber+2)),[s]},code:function(e,t){var i=[],n=/^(?: {0,3}\t| {4})(.*)\n?/;if(!e.match(n))return void 0;e:for(;;){var s=this.loop_re_over_block(n,e.valueOf(),function(e){i.push(e[1])});if(s.length){t.unshift(f(s,e.trailing));break e}if(!t.length)break e;if(!t[0].match(n))break e;i.push(e.trailing.replace(/[^\n]/g,"").substring(2)),e=t.shift()}return[["code_block",i.join("\n")]]},horizRule:function(e,t){var i=e.match(/^(?:([\s\S]*?)\n)?[ \t]*([-_*])(?:[ \t]*\2){2,}[ \t]*(?:\n([\s\S]*))?$/);if(!i)return void 0;var n=[["hr"]];return i[1]&&n.unshift.apply(n,this.processBlock(i[1],[])),i[3]&&t.unshift(f(i[3])),n},lists:function(){function e(e){return new RegExp("(?:^("+l+"{0,"+e+"} {0,3})("+r+")\\s+)|"+"(^"+l+"{0,"+(e-1)+"}[ ]{0,4})")}function t(e){return e.replace(/ {0,3}\t/g,"    ")}function i(e,t,i,n){if(t)return e.push(["para"].concat(i)),void 0;var s=e[e.length-1]instanceof Array&&"para"==e[e.length-1][0]?e[e.length-1]:e;n&&e.length>1&&i.unshift(n);for(var r=0;r<i.length;r++){var o=i[r],a="string"==typeof o;a&&s.length>1&&"string"==typeof s[s.length-1]?s[s.length-1]+=o:s.push(o)}}function n(e,t){for(var i=new RegExp("^("+l+"{"+e+"}.*?\\n?)*$"),n=new RegExp("^"+l+"{"+e+"}","gm"),s=[];t.length>0;){if(i.exec(t[0])){var r=t.shift(),o=r.replace(n,"");s.push(f(o,r.trailing,r.lineNumber))}break}return s}function s(e,t,i){var n=e.list,s=n[n.length-1];if(!(s[1]instanceof Array&&"para"==s[1][0]))if(t+1==i.length)s.push(["para"].concat(s.splice(1)));else{var r=s.pop();s.push(["para"].concat(s.splice(1)),r)}}var r="[*+-]|\\d+\\.",o=/[*+-]/,a=new RegExp("^( {0,3})("+r+")[ 	]+"),l="(?: {0,3}\\t| {4})";return function(r,l){function c(e){var t=o.exec(e[2])?["bulletlist"]:["numberlist"];return p.push({list:t,indent:e[1]}),t}var h=r.match(a);if(!h)return void 0;for(var u,d,p=[],f=c(h),g=!1,v=[p[0].list];;){for(var b=r.split(/(?=\n)/),_="",y=0;y<b.length;y++){var w="",k=b[y].replace(/^\n/,function(e){return w=e,""}),S=e(p.length);if(h=k.match(S),void 0!==h[1]){_.length&&(i(u,g,this.processInline(_),w),g=!1,_=""),h[1]=t(h[1]);var x=Math.floor(h[1].length/4)+1;if(x>p.length)f=c(h),u.push(f),u=f[1]=["listitem"];else{var P=!1;for(d=0;d<p.length;d++)if(p[d].indent==h[1]){f=p[d].list,p.splice(d+1),P=!0;break}P||(x++,x<=p.length?(p.splice(x),f=p[x-1].list):(f=c(h),u.push(f))),u=["listitem"],f.push(u)}w=""}k.length>h[0].length&&(_+=w+k.substr(h[0].length))}_.length&&(i(u,g,this.processInline(_),w),g=!1,_="");var C=n(p.length,l);C.length>0&&(m(p,s,this),u.push.apply(u,this.toTree(C,[])));var T=l[0]&&l[0].valueOf()||"";if(!T.match(a)&&!T.match(/^ /))break;r=l.shift();var N=this.dialect.block.horizRule(r,l);if(N){v.push.apply(v,N);break}m(p,s,this),g=!0}return v}}(),blockquote:function(e,t){if(!e.match(/^>/m))return void 0;var i=[];if(">"!=e[0]){for(var n=e.split(/\n/),s=[];n.length&&">"!=n[0][0];)s.push(n.shift());e=n.join("\n"),i.push.apply(i,this.processBlock(s.join("\n"),[]))}for(;t.length&&">"==t[0][0];){var r=t.shift();e=new String(e+e.trailing+r),e.trailing=r.trailing}var o=e.replace(/^> ?/gm,"");return this.tree,i.push(this.toTree(o,["blockquote"])),i},referenceDefn:function(e,t){var i=/^\s*\[(.*?)\]:\s*(\S+)(?:\s+(?:(['"])(.*?)\3|\((.*?)\)))?\n?/;if(!e.match(i))return void 0;o(this.tree)||this.tree.splice(1,0,{});var n=o(this.tree);void 0===n.references&&(n.references={});var s=this.loop_re_over_block(i,e,function(e){e[2]&&"<"==e[2][0]&&">"==e[2][e[2].length-1]&&(e[2]=e[2].substring(1,e[2].length-1));var t=n.references[e[1].toLowerCase()]={href:e[2]};void 0!==e[4]?t.title=e[4]:void 0!==e[5]&&(t.title=e[5])});return s.length&&t.unshift(f(s,e.trailing)),[]},para:function(e){return[["para"].concat(this.processInline(e))]}}},d.dialects.Gruber.inline={__oneElement__:function(e,t,i){var n,s;t=t||this.dialect.inline.__patterns__;var r=new RegExp("([\\s\\S]*?)("+(t.source||t)+")");if(n=r.exec(e),!n)return[e.length,e];if(n[1])return[n[1].length,n[1]];var s;return n[2]in this.dialect.inline&&(s=this.dialect.inline[n[2]].call(this,e.substr(n.index),n,i||[])),s=s||[n[2].length,n[2]]},__call__:function(e,t){function i(e){"string"==typeof e&&"string"==typeof s[s.length-1]?s[s.length-1]+=e:s.push(e)}for(var n,s=[];e.length>0;)n=this.dialect.inline.__oneElement__.call(this,e,t,s),e=e.substr(n.shift()),m(n,i);return s},"]":function(){},"}":function(){},"\\":function(e){return e.match(/^\\[\\`\*_{}\[\]()#\+.!\-]/)?[2,e[1]]:[1,"\\"]},"![":function(e){var t=e.match(/^!\[(.*?)\][ \t]*\([ \t]*(\S*)(?:[ \t]+(["'])(.*?)\3)?[ \t]*\)/);if(t){t[2]&&"<"==t[2][0]&&">"==t[2][t[2].length-1]&&(t[2]=t[2].substring(1,t[2].length-1)),t[2]=this.dialect.inline.__call__.call(this,t[2],/\\/)[0];var i={alt:t[1],href:t[2]||""};return void 0!==t[4]&&(i.title=t[4]),[t[0].length,["img",i]]}return t=e.match(/^!\[(.*?)\][ \t]*\[(.*?)\]/),t?[t[0].length,["img_ref",{alt:t[1],ref:t[2].toLowerCase(),original:t[0]}]]:[2,"!["]},"[":function b(e){var t=String(e),i=d.DialectHelpers.inline_until_char.call(this,e.substr(1),"]");if(!i)return[1,"["];var b,n,s=1+i[0],r=i[1];e=e.substr(s);var o=e.match(/^\s*\([ \t]*(\S+)(?:[ \t]+(["'])(.*?)\2)?[ \t]*\)/);if(o){var a=o[1];if(s+=o[0].length,a&&"<"==a[0]&&">"==a[a.length-1]&&(a=a.substring(1,a.length-1)),!o[3])for(var l=1,c=0;c<a.length;c++)switch(a[c]){case"(":l++;break;case")":0==--l&&(s-=a.length-c,a=a.substring(0,c))}return a=this.dialect.inline.__call__.call(this,a,/\\/)[0],n={href:a||""},void 0!==o[3]&&(n.title=o[3]),b=["link",n].concat(r),[s,b]}return o=e.match(/^\s*\[(.*?)\]/),o?(s+=o[0].length,n={ref:(o[1]||String(r)).toLowerCase(),original:t.substr(0,s)},b=["link_ref",n].concat(r),[s,b]):1==r.length&&"string"==typeof r[0]?(n={ref:r[0].toLowerCase(),original:t.substr(0,s)},b=["link_ref",n,r[0]],[s,b]):[1,"["]},"<":function(e){var t;return null!=(t=e.match(/^<(?:((https?|ftp|mailto):[^>]+)|(.*?@.*?\.[a-zA-Z]+))>/))?t[3]?[t[0].length,["link",{href:"mailto:"+t[3]},t[3]]]:"mailto"==t[2]?[t[0].length,["link",{href:t[1]},t[1].substr("mailto:".length)]]:[t[0].length,["link",{href:t[1]},t[1]]]:[1,"<"]},"`":function(e){var t=e.match(/(`+)(([\s\S]*?)\1)/);return t&&t[2]?[t[1].length+t[2].length,["inlinecode",t[3]]]:[1,"`"]},"  \n":function(){return[3,["linebreak"]]}},d.dialects.Gruber.inline["**"]=s("strong","**"),d.dialects.Gruber.inline.__=s("strong","__"),d.dialects.Gruber.inline["*"]=s("em","*"),d.dialects.Gruber.inline._=s("em","_"),d.buildBlockOrder=function(e){var t=[];for(var i in e)"__order__"!=i&&"__call__"!=i&&t.push(i);e.__order__=t},d.buildInlinePatterns=function(e){var t=[];for(var i in e)if(!i.match(/^__.*__$/)){var n=i.replace(/([\\.*+?|()\[\]{}])/g,"\\$1").replace(/\n/,"\\n");t.push(1==i.length?n:"(?:"+n+")")}t=t.join("|"),e.__patterns__=t;var s=e.__call__;e.__call__=function(e,i){return void 0!=i?s.call(this,e,i):s.call(this,e,t)}},d.DialectHelpers={},d.DialectHelpers.inline_until_char=function(e,t){for(var i=0,n=[];;){if(e[i]==t)return i++,[i,n];if(i>=e.length)return null;res=this.dialect.inline.__oneElement__.call(this,e.substr(i)),i+=res[0],n.push.apply(n,res.slice(1))}},d.subclassDialect=function(e){function t(){}function i(){}return t.prototype=e.block,i.prototype=e.inline,{block:new t,inline:new i}},d.buildBlockOrder(d.dialects.Gruber.block),d.buildInlinePatterns(d.dialects.Gruber.inline),d.dialects.Maruku=d.subclassDialect(d.dialects.Gruber),d.dialects.Maruku.processMetaHash=function(e){for(var t=r(e),i={},n=0;n<t.length;++n)if(/^#/.test(t[n]))i.id=t[n].substring(1);else if(/^\./.test(t[n]))i["class"]=i["class"]?i["class"]+t[n].replace(/./," "):t[n].substring(1);else if(/\=/.test(t[n])){var s=t[n].split(/\=/);i[s[0]]=s[1]}return i},d.dialects.Maruku.block.document_meta=function(e){if(e.lineNumber>1)return void 0;if(!e.match(/^(?:\w+:.*\n)*\w+:.*$/))return void 0;o(this.tree)||this.tree.splice(1,0,{});var t=e.split(/\n/);for(p in t){var i=t[p].match(/(\w+):\s*(.*)$/),n=i[1].toLowerCase(),s=i[2];this.tree[1][n]=s}return[]},d.dialects.Maruku.block.block_meta=function(e){var t=e.match(/(^|\n) {0,3}\{:\s*((?:\\\}|[^\}])*)\s*\}$/);if(!t)return void 0;var i,n=this.dialect.processMetaHash(t[2]);if(""===t[1]){var s=this.tree[this.tree.length-1];if(i=o(s),"string"==typeof s)return void 0;i||(i={},s.splice(1,0,i));for(a in n)i[a]=n[a];return[]}var r=e.replace(/\n.*$/,""),l=this.processBlock(r,[]);i=o(l[0]),i||(i={},l[0].splice(1,0,i));for(a in n)i[a]=n[a];return l},d.dialects.Maruku.block.definition_list=function(e,t){var i,n=/^((?:[^\s:].*\n)+):\s+([\s\S]+)$/,s=["dl"];if(!(a=e.match(n)))return void 0;for(var r=[e];t.length&&n.exec(t[0]);)r.push(t.shift());for(var o=0;o<r.length;++o){var a=r[o].match(n),l=a[1].replace(/\n$/,"").split(/\n/),c=a[2].split(/\n:\s+/);for(i=0;i<l.length;++i)s.push(["dt",l[i]]);for(i=0;i<c.length;++i)s.push(["dd"].concat(this.processInline(c[i].replace(/(\n)\s+/,"$1"))))}return[s]},d.dialects.Maruku.inline["{:"]=function(e,t,i){if(!i.length)return[2,"{:"];var n=i[i.length-1];if("string"==typeof n)return[2,"{:"];var s=e.match(/^\{:\s*((?:\\\}|[^\}])*)\s*\}/);if(!s)return[2,"{:"];var r=this.dialect.processMetaHash(s[1]),a=o(n);a||(a={},n.splice(1,0,a));for(var l in r)a[l]=r[l];return[s[0].length,""]},d.buildBlockOrder(d.dialects.Maruku.block),d.buildInlinePatterns(d.dialects.Maruku.inline);var m,g=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)};m=Array.prototype.forEach?function(e,t,i){return e.forEach(t,i)}:function(e,t,i){for(var n=0;n<e.length;n++)t.call(i||e,e[n],n,e)},e.renderJsonML=function(e,t){t=t||{},t.root=t.root||!1;var i=[];if(t.root)i.push(c(e));else for(e.shift(),!e.length||"object"!=typeof e[0]||e[0]instanceof Array||e.shift();e.length;)i.push(c(e.shift()));return i.join("\n\n")}}(function(){return"undefined"==typeof exports?(window.markdown={},window.markdown):exports}()),define("markdown",function(e){return function(){var t;return t||e.markdown}}(this)),define("text!ui_widgets/share.hbs",[],function(){return'\n\n\n<!--<button class="btn" type="button">-->\n    <!--Share-->\n    <!--<i class="icon-plus"></i>-->\n<!--</button>-->\n\n<!--<nav class="noDisplay">-->\n    <!--<b class="fluff arrowBottom"></b>-->\n    <i class="action-email icon-envelope" title="Share by Email"></i>\n    <i class="action-twitter icon-twitter" title="Share on Twitter"></i>\n    <i class="action-facebook icon-facebook" title="Share using Facebook"></i>\n<!--</nav>-->\n\n'}),define("entities/careBears/careBear",["backbone"],function(e){var t,i;return i="entities/careBears/careBear",t=e.Model.extend({initialize:function(){return this.on("error",this.onErr),this.on("invalid",this.onInvalid)},sync:function(){var e;if(this.url)return e=""+this.url+"?"+$.param(this.attributes),window.open(e)},onErr:function(){return console.error(""+i+": Trouble sharing")},onInvalid:function(e,t){return console.error(""+i+": Invalid: "+t)}})}),define("entities/careBears/facebook",["backbone","./careBear","core"],function(e,t,i){var n,s;return s="entities/careBears/facebook",n=t.extend({defaults:{app_id:i.cfg.fbId,redirect_uri:"https://alpha.tidepool.co/"+window.location.hash},url:"https://www.facebook.com/dialog/feed/",validate:function(e){return e.name?e.caption?e.link?(e.picture||console.warn("Facebook is better with .pictures"),null):"Need a link":"Need a caption":"Need a name"}})}),define("entities/careBears/twitter",["backbone","./careBear"],function(e,t){var i,n;return n="entities/careBears/twitter",i=t.extend({defaults:{related:"TidePoolInc"},url:"http://twitter.com/share",validate:function(e){return e.text?e.url?void 0:"Need url":"Need text"}})}),define("entities/careBears/mailto",["backbone","./careBear"],function(e,t){var i,n;return n="entities/careBears/mailto",i=t.extend({url:"mailto:",validate:function(e){return e.subject?e.body?void 0:"Need body":"Need subject"}})}),define("ui_widgets/share",["backbone","Handlebars","text!./share.hbs","entities/careBears/facebook","entities/careBears/twitter","entities/careBears/mailto","core"],function(e,t,i,n,s,r,o){var a,l,c,h;return c="ui_widgets/share",h="nav",l=".btn",a=e.View.extend({tagName:"aside",className:"share",events:{"click .action-facebook":"onClickFacebook","click .action-twitter":"onClickTwitter","click .action-email":"onClickMailto"},render:function(){return this.$el.html(i),this},onClickFacebook:function(e){var t;return e.stopPropagation(),t=new n({picture:this.options.data.image,link:this.options.data.link,name:this.options.data.title,caption:this.options.data.text}),t.save(),o.analytics.track(this.className,"clicked facebook")},onClickTwitter:function(e){var t;return e.stopPropagation(),t=new s({text:""+this.options.data.title+" -- ",url:this.options.data.link}),t.save(),o.analytics.track(this.className,"clicked twitter")},onClickMailto:function(e){var t;return e.stopPropagation(),t=new r({subject:this.options.data.title,body:this.options.data.text}),t.save(),o.analytics.track(this.className,"clicked mailto")}})}),define("dashboard/personality/core",["backbone","Handlebars","text!./core.hbs","dashboard/widgets/base","composite_views/perch","markdown","core","ui_widgets/share"],function(e,t,i,n,s,r,o,a){var l,c,h,u;return u=".widget",c="core",h=t.compile(i),l=n.extend({className:"doubleWide tall "+c,events:{"click .widget":"onClick"},render:function(){var e;return this.$el.html(h(this.model.attributes.profile_description)),e=new a({data:{title:"My personality is '"+this.model.attributes.profile_description.name+"'",text:"You can find out your personality, too, at https://alpha.tidepool.co",link:"https://alpha.tidepool.co",image:"https://alpha.tidepool.co/images/badges/"+this.model.attributes.profile_description.logo_url}}),this.$el.append(e.render().el),this},onClick:function(){var e;return e=r.toHTML(this.model.attributes.profile_description.description),s.show({large:!0,title:this.model.attributes.profile_description.name,msg:e,btn1Text:"Ok"}),o.analytics.track(c,"Detailed Personality Results Viewed")}}),l.dependsOn="entities/cur_user_personality",l}),define("charts/chart_colors",[],function(){return["#35a589","#73829d","#e96267","#4c576a","#FABB3D","#b7b7b7"]}),define("charts/chart",["underscore","backbone","Handlebars","./chart_colors"],function(e,t,i,n){var s;return s=t.Model.extend({defaults:{name:"Default Chart Name",width:150,height:150,chartValues:[],colors:e.clone(n),options:{}},_prepareData:function(e){var t,i,s,r;s=[],t=0;for(i in e)r=e[i],s.push({label:i,color:n[t],value:r}),t++;return s},parse:function(e){return e.chartValues=this._prepareData(e.chartValues),e}})}),define("text!charts/chart_with_swatches.hbs",[],function(){return'\n\n<canvas width="{{width}}" height="{{height}}"></canvas>\n<ul class="key">\n    {{#each chartValues}}\n        <li title="{{value}}">\n            <i class="swatch" style="background-color:{{color}}"></i>\n            {{label}}\n        </li>\n    {{/each}}\n </ul>\n\n'});var Chart=function(e){function t(e,t,i){return e=r((e-t.graphMin)/(t.steps*t.stepValue),1,0),i*t.steps*e}function i(e,t,i,n){function s(){l+=o;var c=e.animation?r(a(l),null,0):1;n.clearRect(0,0,h,u),e.scaleOverlay?(i(c),t()):(t(),i(c)),1>=l?b(s):"function"==typeof e.onAnimationComplete&&e.onAnimationComplete()}var o=e.animation?1/r(e.animationSteps,Number.MAX_VALUE,1):1,a=c[e.animationEasing],l=e.animation?0:1;"function"!=typeof t&&(t=function(){}),b(s)}function n(e,t,i,n,r,o){var a;for(e=Math.floor(Math.log(n-r)/Math.LN10),r=Math.floor(r/(1*Math.pow(10,e)))*Math.pow(10,e),n=Math.ceil(n/(1*Math.pow(10,e)))*Math.pow(10,e)-r,e=Math.pow(10,e),a=Math.round(n/e);i>a||a>t;)e=i>a?e/2:2*e,a=Math.round(n/e);return t=[],s(o,t,a,r,e),{steps:a,stepValue:e,graphMin:r,labels:t}}function s(e,t,i,n,s){if(e)for(var r=1;i+1>r;r++)t.push(a(e,{value:(n+s*r).toFixed(0!=s%1?s.toString().split(".")[1].length:0)}))}function r(e,t,i){return!isNaN(parseFloat(t))&&isFinite(t)&&e>t?t:!isNaN(parseFloat(i))&&isFinite(i)&&i>e?i:e}function o(e,t){var i,n={};for(i in e)n[i]=e[i];for(i in t)n[i]=t[i];return n}function a(e,t){var i=/\W/.test(e)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):_[e]=_[e]||a(document.getElementById(e).innerHTML);return t?i(t):i}var l=this,c={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return-1*e*(e-2)},easeInOutQuad:function(e){return 1>(e/=.5)?.5*e*e:-.5*(--e*(e-2)-1)},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return 1*((e=e/1-1)*e*e+1)},easeInOutCubic:function(e){return 1>(e/=.5)?.5*e*e*e:.5*((e-=2)*e*e+2)},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return-1*((e=e/1-1)*e*e*e-1)},easeInOutQuart:function(e){return 1>(e/=.5)?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},easeInQuint:function(e){return 1*(e/=1)*e*e*e*e},easeOutQuint:function(e){return 1*((e=e/1-1)*e*e*e*e+1)},easeInOutQuint:function(e){return 1>(e/=.5)?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},easeInSine:function(e){return-1*Math.cos(e/1*(Math.PI/2))+1},easeOutSine:function(e){return 1*Math.sin(e/1*(Math.PI/2))},easeInOutSine:function(e){return-.5*(Math.cos(Math.PI*e/1)-1)},easeInExpo:function(e){return 0==e?1:1*Math.pow(2,10*(e/1-1))},easeOutExpo:function(e){return 1==e?1:1*(-Math.pow(2,-10*e/1)+1)},easeInOutExpo:function(e){return 0==e?0:1==e?1:1>(e/=.5)?.5*Math.pow(2,10*(e-1)):.5*(-Math.pow(2,-10*--e)+2)},easeInCirc:function(e){return e>=1?e:-1*(Math.sqrt(1-(e/=1)*e)-1)},easeOutCirc:function(e){return 1*Math.sqrt(1-(e=e/1-1)*e)},easeInOutCirc:function(e){return 1>(e/=.5)?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},easeInElastic:function(e){var t=1.70158,i=0,n=1;return 0==e?0:1==(e/=1)?1:(i||(i=.3),n<Math.abs(1)?(n=1,t=i/4):t=i/(2*Math.PI)*Math.asin(1/n),-(n*Math.pow(2,10*(e-=1))*Math.sin(2*(1*e-t)*Math.PI/i)))},easeOutElastic:function(e){var t=1.70158,i=0,n=1;return 0==e?0:1==(e/=1)?1:(i||(i=.3),n<Math.abs(1)?(n=1,t=i/4):t=i/(2*Math.PI)*Math.asin(1/n),n*Math.pow(2,-10*e)*Math.sin(2*(1*e-t)*Math.PI/i)+1)},easeInOutElastic:function(e){var t=1.70158,i=0,n=1;return 0==e?0:2==(e/=.5)?1:(i||(i=.3*1.5),n<Math.abs(1)?(n=1,t=i/4):t=i/(2*Math.PI)*Math.asin(1/n),1>e?-.5*n*Math.pow(2,10*(e-=1))*Math.sin(2*(1*e-t)*Math.PI/i):.5*n*Math.pow(2,-10*(e-=1))*Math.sin(2*(1*e-t)*Math.PI/i)+1)},easeInBack:function(e){return 1*(e/=1)*e*(2.70158*e-1.70158)},easeOutBack:function(e){return 1*((e=e/1-1)*e*(2.70158*e+1.70158)+1)},easeInOutBack:function(e){var t=1.70158;return 1>(e/=.5)?.5*e*e*(((t*=1.525)+1)*e-t):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},easeInBounce:function(e){return 1-c.easeOutBounce(1-e)},easeOutBounce:function(e){return(e/=1)<1/2.75?7.5625*e*e:2/2.75>e?1*(7.5625*(e-=1.5/2.75)*e+.75):2.5/2.75>e?1*(7.5625*(e-=2.25/2.75)*e+.9375):1*(7.5625*(e-=2.625/2.75)*e+.984375)},easeInOutBounce:function(e){return.5>e?.5*c.easeInBounce(2*e):.5*c.easeOutBounce(2*e-1)+.5}},h=e.canvas.width,u=e.canvas.height;window.devicePixelRatio&&(e.canvas.style.width=h+"px",e.canvas.style.height=u+"px",e.canvas.height=u*window.devicePixelRatio,e.canvas.width=h*window.devicePixelRatio,e.scale(window.devicePixelRatio,window.devicePixelRatio)),this.PolarArea=function(t,i){l.PolarArea.defaults={scaleOverlay:!0,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleShowLine:!0,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:!0,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowLabelBackdrop:!0,scaleBackdropColor:"rgba(255,255,255,0.75)",scaleBackdropPaddingY:2,scaleBackdropPaddingX:2,segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,animation:!0,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,onAnimationComplete:null};var n=i?o(l.PolarArea.defaults,i):l.PolarArea.defaults;return new d(t,n,e)},this.Radar=function(t,i){l.Radar.defaults={scaleOverlay:!1,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleShowLine:!0,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:!1,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowLabelBackdrop:!0,scaleBackdropColor:"rgba(255,255,255,0.75)",scaleBackdropPaddingY:2,scaleBackdropPaddingX:2,angleShowLineOut:!0,angleLineColor:"rgba(0,0,0,.1)",angleLineWidth:1,pointLabelFontFamily:"'Arial'",pointLabelFontStyle:"normal",pointLabelFontSize:12,pointLabelFontColor:"#666",pointDot:!0,pointDotRadius:3,pointDotStrokeWidth:1,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,animation:!0,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null};var n=i?o(l.Radar.defaults,i):l.Radar.defaults;return new p(t,n,e)},this.Pie=function(t,i){l.Pie.defaults={segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,animation:!0,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,onAnimationComplete:null};var n=i?o(l.Pie.defaults,i):l.Pie.defaults;return new f(t,n,e)},this.Doughnut=function(t,i){l.Doughnut.defaults={segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animation:!0,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,onAnimationComplete:null};var n=i?o(l.Doughnut.defaults,i):l.Doughnut.defaults;return new m(t,n,e)},this.Line=function(t,i){l.Line.defaults={scaleOverlay:!1,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:!0,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,bezierCurve:!0,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:2,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,animation:!0,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null};var n=i?o(l.Line.defaults,i):l.Line.defaults;return new g(t,n,e)},this.Bar=function(t,i){l.Bar.defaults={scaleOverlay:!1,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:!0,scaleLabel:"<%=value%>",scaleFontFamily:"'Arial'",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,animation:!0,animationSteps:60,animationEasing:"easeOutQuart",onAnimationComplete:null};var n=i?o(l.Bar.defaults,i):l.Bar.defaults;return new v(t,n,e)};var d=function(e,r,o){var a,l,c,d,p,f,m,g,v;for(p=Math.min.apply(Math,[h,u])/2,p-=Math.max.apply(Math,[.5*r.scaleFontSize,.5*r.scaleLineWidth]),d=2*r.scaleFontSize,r.scaleShowLabelBackdrop&&(d+=2*r.scaleBackdropPaddingY,p-=1.5*r.scaleBackdropPaddingY),g=p,d=d?d:5,a=Number.MIN_VALUE,l=Number.MAX_VALUE,c=0;c<e.length;c++)e[c].value>a&&(a=e[c].value),e[c].value<l&&(l=e[c].value);c=Math.floor(g/(.66*d)),d=Math.floor(.5*(g/d)),v=r.scaleShowLabels?r.scaleLabel:null,r.scaleOverride?(m={steps:r.scaleSteps,stepValue:r.scaleStepWidth,graphMin:r.scaleStartValue,labels:[]},s(v,m.labels,m.steps,r.scaleStartValue,r.scaleStepWidth)):m=n(g,c,d,a,l,v),f=p/m.steps,i(r,function(){for(var e=0;e<m.steps;e++)if(r.scaleShowLine&&(o.beginPath(),o.arc(h/2,u/2,f*(e+1),0,2*Math.PI,!0),o.strokeStyle=r.scaleLineColor,o.lineWidth=r.scaleLineWidth,o.stroke()),r.scaleShowLabels){o.textAlign="center",o.font=r.scaleFontStyle+" "+r.scaleFontSize+"px "+r.scaleFontFamily;var t=m.labels[e];if(r.scaleShowLabelBackdrop){var i=o.measureText(t).width;o.fillStyle=r.scaleBackdropColor,o.beginPath(),o.rect(Math.round(h/2-i/2-r.scaleBackdropPaddingX),Math.round(u/2-f*(e+1)-.5*r.scaleFontSize-r.scaleBackdropPaddingY),Math.round(i+2*r.scaleBackdropPaddingX),Math.round(r.scaleFontSize+2*r.scaleBackdropPaddingY)),o.fill()}o.textBaseline="middle",o.fillStyle=r.scaleFontColor,o.fillText(t,h/2,u/2-f*(e+1))}},function(i){var n=-Math.PI/2,s=2*Math.PI/e.length,a=1,l=1;for(r.animation&&(r.animateScale&&(a=i),r.animateRotate&&(l=i)),i=0;i<e.length;i++)o.beginPath(),o.arc(h/2,u/2,a*t(e[i].value,m,f),n,n+l*s,!1),o.lineTo(h/2,u/2),o.closePath(),o.fillStyle=e[i].color,o.fill(),r.segmentShowStroke&&(o.strokeStyle=r.segmentStrokeColor,o.lineWidth=r.segmentStrokeWidth,o.stroke()),n+=l*s},o)},p=function(e,o,a){var l,c,d,p,f,m,g,v,b;for(e.labels||(e.labels=[]),f=Math.min.apply(Math,[h,u])/2,p=2*o.scaleFontSize,l=v=0;l<e.labels.length;l++)a.font=o.pointLabelFontStyle+" "+o.pointLabelFontSize+"px "+o.pointLabelFontFamily,c=a.measureText(e.labels[l]).width,c>v&&(v=c);for(f-=Math.max.apply(Math,[v,1.5*(o.pointLabelFontSize/2)]),f-=o.pointLabelFontSize,v=f=r(f,null,0),p=p?p:5,l=Number.MIN_VALUE,c=Number.MAX_VALUE,d=0;d<e.datasets.length;d++)for(b=0;b<e.datasets[d].data.length;b++)e.datasets[d].data[b]>l&&(l=e.datasets[d].data[b]),e.datasets[d].data[b]<c&&(c=e.datasets[d].data[b]);d=Math.floor(v/(.66*p)),p=Math.floor(.5*(v/p)),b=o.scaleShowLabels?o.scaleLabel:null,o.scaleOverride?(g={steps:o.scaleSteps,stepValue:o.scaleStepWidth,graphMin:o.scaleStartValue,labels:[]},s(b,g.labels,g.steps,o.scaleStartValue,o.scaleStepWidth)):g=n(v,d,p,l,c,b),m=f/g.steps,i(o,function(){var t=2*Math.PI/e.datasets[0].data.length;if(a.save(),a.translate(h/2,u/2),o.angleShowLineOut){a.strokeStyle=o.angleLineColor,a.lineWidth=o.angleLineWidth;for(var i=0;i<e.datasets[0].data.length;i++)a.rotate(t),a.beginPath(),a.moveTo(0,0),a.lineTo(0,-f),a.stroke()}for(i=0;i<g.steps;i++){if(a.beginPath(),o.scaleShowLine){a.strokeStyle=o.scaleLineColor,a.lineWidth=o.scaleLineWidth,a.moveTo(0,-m*(i+1));for(var n=0;n<e.datasets[0].data.length;n++)a.rotate(t),a.lineTo(0,-m*(i+1));a.closePath(),a.stroke()}o.scaleShowLabels&&(a.textAlign="center",a.font=o.scaleFontStyle+" "+o.scaleFontSize+"px "+o.scaleFontFamily,a.textBaseline="middle",o.scaleShowLabelBackdrop&&(n=a.measureText(g.labels[i]).width,a.fillStyle=o.scaleBackdropColor,a.beginPath(),a.rect(Math.round(-n/2-o.scaleBackdropPaddingX),Math.round(-m*(i+1)-.5*o.scaleFontSize-o.scaleBackdropPaddingY),Math.round(n+2*o.scaleBackdropPaddingX),Math.round(o.scaleFontSize+2*o.scaleBackdropPaddingY)),a.fill()),a.fillStyle=o.scaleFontColor,a.fillText(g.labels[i],0,-m*(i+1)))}for(i=0;i<e.labels.length;i++){a.font=o.pointLabelFontStyle+" "+o.pointLabelFontSize+"px "+o.pointLabelFontFamily,a.fillStyle=o.pointLabelFontColor;var n=Math.sin(t*i)*(f+o.pointLabelFontSize),s=Math.cos(t*i)*(f+o.pointLabelFontSize);a.textAlign=t*i==Math.PI||0==t*i?"center":t*i>Math.PI?"right":"left",a.textBaseline="middle",a.fillText(e.labels[i],n,-s)}a.restore()},function(i){var n=2*Math.PI/e.datasets[0].data.length;a.save(),a.translate(h/2,u/2);for(var s=0;s<e.datasets.length;s++){a.beginPath(),a.moveTo(0,-1*i*t(e.datasets[s].data[0],g,m));for(var r=1;r<e.datasets[s].data.length;r++)a.rotate(n),a.lineTo(0,-1*i*t(e.datasets[s].data[r],g,m));if(a.closePath(),a.fillStyle=e.datasets[s].fillColor,a.strokeStyle=e.datasets[s].strokeColor,a.lineWidth=o.datasetStrokeWidth,a.fill(),a.stroke(),o.pointDot)for(a.fillStyle=e.datasets[s].pointColor,a.strokeStyle=e.datasets[s].pointStrokeColor,a.lineWidth=o.pointDotStrokeWidth,r=0;r<e.datasets[s].data.length;r++)a.rotate(n),a.beginPath(),a.arc(0,-1*i*t(e.datasets[s].data[r],g,m),o.pointDotRadius,2*Math.PI,!1),a.fill(),a.stroke();a.rotate(n)}a.restore()},a)},f=function(e,t,n){for(var s=0,r=Math.min.apply(Math,[u/2,h/2])-5,o=0;o<e.length;o++)s+=e[o].value;i(t,null,function(i){var o=-Math.PI/2,a=1,l=1;for(t.animation&&(t.animateScale&&(a=i),t.animateRotate&&(l=i)),i=0;i<e.length;i++){var c=2*(l*e[i].value/s)*Math.PI;n.beginPath(),n.arc(h/2,u/2,a*r,o,o+c),n.lineTo(h/2,u/2),n.closePath(),n.fillStyle=e[i].color,n.fill(),t.segmentShowStroke&&(n.lineWidth=t.segmentStrokeWidth,n.strokeStyle=t.segmentStrokeColor,n.stroke()),o+=c}},n)},m=function(e,t,n){for(var s=0,r=Math.min.apply(Math,[u/2,h/2])-5,o=r*(t.percentageInnerCutout/100),a=0;a<e.length;a++)s+=e[a].value;i(t,null,function(i){var a=-Math.PI/2,l=1,c=1;for(t.animation&&(t.animateScale&&(l=i),t.animateRotate&&(c=i)),i=0;i<e.length;i++){var d=2*(c*e[i].value/s)*Math.PI;n.beginPath(),n.arc(h/2,u/2,l*r,a,a+d,!1),n.arc(h/2,u/2,l*o,a+d,a,!0),n.closePath(),n.fillStyle=e[i].color,n.fill(),t.segmentShowStroke&&(n.lineWidth=t.segmentStrokeWidth,n.strokeStyle=t.segmentStrokeColor,n.stroke()),a+=d}},n)},g=function(e,r,o){var a,l,c,d,p,f,m,g,v,b,_,y,w,k=0;for(p=u,o.font=r.scaleFontStyle+" "+r.scaleFontSize+"px "+r.scaleFontFamily,b=1,d=0;d<e.labels.length;d++)a=o.measureText(e.labels[d]).width,b=a>b?a:b;for(h/e.labels.length<b?(k=45,h/e.labels.length<Math.cos(k)*b?(k=90,p-=b):p-=Math.sin(k)*b):p-=r.scaleFontSize,d=r.scaleFontSize,p=p-5-d,a=Number.MIN_VALUE,l=Number.MAX_VALUE,c=0;c<e.datasets.length;c++)for(g=0;g<e.datasets[c].data.length;g++)e.datasets[c].data[g]>a&&(a=e.datasets[c].data[g]),e.datasets[c].data[g]<l&&(l=e.datasets[c].data[g]);if(c=Math.floor(p/(.66*d)),d=Math.floor(.5*(p/d)),g=r.scaleShowLabels?r.scaleLabel:"",r.scaleOverride?(m={steps:r.scaleSteps,stepValue:r.scaleStepWidth,graphMin:r.scaleStartValue,labels:[]},s(g,m.labels,m.steps,r.scaleStartValue,r.scaleStepWidth)):m=n(p,c,d,a,l,g),f=Math.floor(p/m.steps),d=1,r.scaleShowLabels){for(o.font=r.scaleFontStyle+" "+r.scaleFontSize+"px "+r.scaleFontFamily,a=0;a<m.labels.length;a++)l=o.measureText(m.labels[a]).width,d=l>d?l:d;d+=10}_=h-d-b,v=Math.floor(_/(e.labels.length-1)),y=h-b/2-_,w=p+r.scaleFontSize/2,i(r,function(){o.lineWidth=r.scaleLineWidth,o.strokeStyle=r.scaleLineColor,o.beginPath(),o.moveTo(h-b/2+5,w),o.lineTo(h-b/2-_-5,w),o.stroke(),k>0?(o.save(),o.textAlign="right"):o.textAlign="center",o.fillStyle=r.scaleFontColor;for(var t=0;t<e.labels.length;t++)o.save(),k>0?(o.translate(y+t*v,w+r.scaleFontSize),o.rotate(-(k*(Math.PI/180))),o.fillText(e.labels[t],0,0),o.restore()):o.fillText(e.labels[t],y+t*v,w+r.scaleFontSize+3),o.beginPath(),o.moveTo(y+t*v,w+3),r.scaleShowGridLines&&t>0?(o.lineWidth=r.scaleGridLineWidth,o.strokeStyle=r.scaleGridLineColor,o.lineTo(y+t*v,5)):o.lineTo(y+t*v,w+3),o.stroke();for(o.lineWidth=r.scaleLineWidth,o.strokeStyle=r.scaleLineColor,o.beginPath(),o.moveTo(y,w+5),o.lineTo(y,5),o.stroke(),o.textAlign="right",o.textBaseline="middle",t=0;t<m.steps;t++)o.beginPath(),o.moveTo(y-3,w-(t+1)*f),r.scaleShowGridLines?(o.lineWidth=r.scaleGridLineWidth,o.strokeStyle=r.scaleGridLineColor,o.lineTo(y+_+5,w-(t+1)*f)):o.lineTo(y-.5,w-(t+1)*f),o.stroke(),r.scaleShowLabels&&o.fillText(m.labels[t],y-8,w-(t+1)*f)},function(i){function n(n,s){return w-i*t(e.datasets[n].data[s],m,f)}for(var s=0;s<e.datasets.length;s++){o.strokeStyle=e.datasets[s].strokeColor,o.lineWidth=r.datasetStrokeWidth,o.beginPath(),o.moveTo(y,w-i*t(e.datasets[s].data[0],m,f));for(var a=1;a<e.datasets[s].data.length;a++)r.bezierCurve?o.bezierCurveTo(y+v*(a-.5),n(s,a-1),y+v*(a-.5),n(s,a),y+v*a,n(s,a)):o.lineTo(y+v*a,n(s,a));if(o.stroke(),r.datasetFill?(o.lineTo(y+v*(e.datasets[s].data.length-1),w),o.lineTo(y,w),o.closePath(),o.fillStyle=e.datasets[s].fillColor,o.fill()):o.closePath(),r.pointDot)for(o.fillStyle=e.datasets[s].pointColor,o.strokeStyle=e.datasets[s].pointStrokeColor,o.lineWidth=r.pointDotStrokeWidth,a=0;a<e.datasets[s].data.length;a++)o.beginPath(),o.arc(y+v*a,w-i*t(e.datasets[s].data[a],m,f),r.pointDotRadius,0,2*Math.PI,!0),o.fill(),o.stroke()}},o)},v=function(e,r,o){var a,l,c,d,p,f,m,g,v,b,_,y,w,k,S=0;for(p=u,o.font=r.scaleFontStyle+" "+r.scaleFontSize+"px "+r.scaleFontFamily,b=1,d=0;d<e.labels.length;d++)a=o.measureText(e.labels[d]).width,b=a>b?a:b;
for(h/e.labels.length<b?(S=45,h/e.labels.length<Math.cos(S)*b?(S=90,p-=b):p-=Math.sin(S)*b):p-=r.scaleFontSize,d=r.scaleFontSize,p=p-5-d,a=Number.MIN_VALUE,l=Number.MAX_VALUE,c=0;c<e.datasets.length;c++)for(g=0;g<e.datasets[c].data.length;g++)e.datasets[c].data[g]>a&&(a=e.datasets[c].data[g]),e.datasets[c].data[g]<l&&(l=e.datasets[c].data[g]);if(c=Math.floor(p/(.66*d)),d=Math.floor(.5*(p/d)),g=r.scaleShowLabels?r.scaleLabel:"",r.scaleOverride?(m={steps:r.scaleSteps,stepValue:r.scaleStepWidth,graphMin:r.scaleStartValue,labels:[]},s(g,m.labels,m.steps,r.scaleStartValue,r.scaleStepWidth)):m=n(p,c,d,a,l,g),f=Math.floor(p/m.steps),d=1,r.scaleShowLabels){for(o.font=r.scaleFontStyle+" "+r.scaleFontSize+"px "+r.scaleFontFamily,a=0;a<m.labels.length;a++)l=o.measureText(m.labels[a]).width,d=l>d?l:d;d+=10}_=h-d-b,v=Math.floor(_/e.labels.length),k=(v-2*r.scaleGridLineWidth-2*r.barValueSpacing-(r.barDatasetSpacing*e.datasets.length-1)-(r.barStrokeWidth/2*e.datasets.length-1))/e.datasets.length,y=h-b/2-_,w=p+r.scaleFontSize/2,i(r,function(){o.lineWidth=r.scaleLineWidth,o.strokeStyle=r.scaleLineColor,o.beginPath(),o.moveTo(h-b/2+5,w),o.lineTo(h-b/2-_-5,w),o.stroke(),S>0?(o.save(),o.textAlign="right"):o.textAlign="center",o.fillStyle=r.scaleFontColor;for(var t=0;t<e.labels.length;t++)o.save(),S>0?(o.translate(y+t*v,w+r.scaleFontSize),o.rotate(-(S*(Math.PI/180))),o.fillText(e.labels[t],0,0),o.restore()):o.fillText(e.labels[t],y+t*v+v/2,w+r.scaleFontSize+3),o.beginPath(),o.moveTo(y+(t+1)*v,w+3),o.lineWidth=r.scaleGridLineWidth,o.strokeStyle=r.scaleGridLineColor,o.lineTo(y+(t+1)*v,5),o.stroke();for(o.lineWidth=r.scaleLineWidth,o.strokeStyle=r.scaleLineColor,o.beginPath(),o.moveTo(y,w+5),o.lineTo(y,5),o.stroke(),o.textAlign="right",o.textBaseline="middle",t=0;t<m.steps;t++)o.beginPath(),o.moveTo(y-3,w-(t+1)*f),r.scaleShowGridLines?(o.lineWidth=r.scaleGridLineWidth,o.strokeStyle=r.scaleGridLineColor,o.lineTo(y+_+5,w-(t+1)*f)):o.lineTo(y-.5,w-(t+1)*f),o.stroke(),r.scaleShowLabels&&o.fillText(m.labels[t],y-8,w-(t+1)*f)},function(i){o.lineWidth=r.barStrokeWidth;for(var n=0;n<e.datasets.length;n++){o.fillStyle=e.datasets[n].fillColor,o.strokeStyle=e.datasets[n].strokeColor;for(var s=0;s<e.datasets[n].data.length;s++){var a=y+r.barValueSpacing+v*s+k*n+r.barDatasetSpacing*n+r.barStrokeWidth*n;o.beginPath(),o.moveTo(a,w),o.lineTo(a,w-i*t(e.datasets[n].data[s],m,f)+r.barStrokeWidth/2),o.lineTo(a+k,w-i*t(e.datasets[n].data[s],m,f)+r.barStrokeWidth/2),o.lineTo(a+k,w),r.barShowStroke&&o.stroke(),o.closePath(),o.fill()}}},o)},b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},_={}};define("chart",function(e){return function(){var t;return t||e.Chart}}(this)),define("charts/polar_area",["backbone","Handlebars","./chart","text!./chart_with_swatches.hbs","chart"],function(e,t,i,n){var s,r;return r="canvas",s=e.View.extend({tmpl:t.compile(n),className:"chart polarArea",initialize:function(){return this.model=new i(this.options.data,{parse:!0})},render:function(){return this.$el.html(this.tmpl(this.model.attributes)),this._renderChart(this.model.attributes.chartValues),this},_renderChart:function(e){var t,i,n,s,o;return(t=this.$(r))?(s=_.max(e,function(e){return e.value}),s=Math.ceil(s.value),o=_.extend(this.model.attributes.options,{scaleShowLine:!1,scaleShowLabels:!1,scaleOverride:!0,scaleSteps:s,scaleStepWidth:1,scaleStartValue:0}),n=t[0].getContext("2d"),i=new Chart(n).PolarArea(e,o)):void 0}})}),define("dashboard/personality/big5",["backbone","dashboard/widgets/base","composite_views/perch","charts/polar_area"],function(e,t,i,n){var s,r,o;return o=".widget",r="Personality",s=t.extend({events:{"click .widget":"onClick"},render:function(){return this.$el.html(this.tmplBase({title:r,className:"pressable"})),this.chart=new n({data:{name:r,chartValues:this.model.attributes.big5_score,options:{animation:!1}}}),this.$(o).append(this.chart.render().el),this},onClick:function(){return i.show({title:r,large:!0,btn1Text:null,content:new n({data:{name:r,chartValues:this.model.attributes.big5_score,width:450,height:300}})})}}),s.dependsOn="entities/cur_user_personality",s}),define("charts/doughnut",["backbone","Handlebars","./chart","text!./chart_with_swatches.hbs","chart"],function(e,t,i,n){var s,r;return r="canvas",s=e.View.extend({tmpl:t.compile(n),className:"chart doughnut",initialize:function(){if(!this.options.data)throw new Error("Need options.data");return this.model=new i(this.options.data,{parse:!0})},render:function(){return this.$el.html(this.tmpl(this.model.attributes)),this._renderChart(this.model.attributes.chartValues),this},_renderChart:function(e){var t,i,n,s;return(t=this.$(r))?(s=_.extend(this.model.attributes.options,{percentageInnerCutout:33}),n=t[0].getContext("2d"),i=new Chart(n).Doughnut(e,s)):void 0}})}),define("dashboard/personality/holland6",["backbone","dashboard/widgets/base","composite_views/perch","charts/doughnut"],function(e,t,i,n){var s,r,o;return o=".widget",r="Interests",s=t.extend({events:{"click .widget":"onClick"},render:function(){return this.$el.html(this.tmplBase({title:r,className:"pressable"})),this.chart=new n({data:{name:r,chartValues:this.model.attributes.holland6_score,options:{animation:!1}}}),this.$(o).append(this.chart.render().el),this},onClick:function(){return i.show({title:r,large:!0,btn1Text:null,content:new n({data:{name:r,chartValues:this.model.attributes.holland6_score,width:450,height:300}})})}}),s.dependsOn="entities/cur_user_personality",s}),define("text!dashboard/personality/detailed_report.hbs",[],function(){return'\n\n<div class="widget premium hasFooter pressable">\n    <h3>Personality Report</h3>\n    <!--<b class="dogEar"></b>-->\n    <br/>\n    <p class="small">\n        Seize control of your unconscious cognitive stengths with a personality report today!\n    </p>\n    <i class="icon icon-documents-circle"></i>\n    <div class="footer">Pre-Order Now</div>\n</div>\n\n'}),define("composite_views/perch-psst",["jquery","backbone","Handlebars","./perch"],function(e,t,i,n){var s,r,o,a;return a="composite_views/perch-psst",r="#PerchBody",o=i.compile('    <p class="row">      <i class="icon-2x {{icon}}"></i>    </p>  '),s=n.Klass.extend({_showOptionsObject:function(e){var t;return e.btn1Text=null,e.content="",e.icon&&(e.content+=o(e)),e.msg&&(e.content+="<p class='large'>"+e.msg+"</p>"),e.content="<div class='highlight'>"+e.content+"</div>",this.model.set(e),this._bindDomEvents(),t=e.mustUseButton?"static":!0,this.$el.modal({backdrop:t})}}),new s}),define("dashboard/personality/detailed_report",["backbone","dashboard/widgets/base","text!./detailed_report.hbs","composite_views/perch-psst","core"],function(e,t,i,n,s){var r,o;return o="detailedReport",r=t.extend({className:o,events:{"click .widget":"onClick"},render:function(){return this.$el.html(i),this},onClick:function(){var e;return e=s.user.attributes.email?"Thanks for your interest, we'll notify you at <strong>"+s.user.attributes.email+"</strong> when your report is available":"Thanks for your interest, we'll notify you when your report is available",n.show({msg:e,icon:"icon-ok"}),s.analytics.track(o,"Teaser Pressed"),$.ajax({url:""+s.cfg.apiServer+"/api/v1/users/-/preorders",type:"POST"}).fail(function(){throw new Error("Failed to send preorder for "+s.user.attributes.email)})}})}),define("text!dashboard/personality/recommendation.hbs",[],function(){return'\n<div class="widget featured pressable">\n    <h3>Daily Recomendations</h3>\n    <br/>\n    <p>Today\'s recommendation has been specifically selected for your personality type!</p>\n    <i class="icon icon-bulb-circle"></i>\n</div>\n\n\n'}),define("text!dashboard/personality/recommendation-details.hbs",[],function(){return'\n<div class="dailyReccDetails">\n\n    <hgroup>\n        <i class="icon icon-bulb-circle pull-left"></i>\n        <h2 class="title">Daily Recommendation</h2>\n        <p class="strong">\n            Based on your personality, TidePool recommends this <em>{{link_type}}</em>.\n        </p>\n    </hgroup>\n\n    <p>{{sentence}}</p>\n    {{#if link}}\n        <a href="{{link}}" id="ActionRecommendationLink" class="footer" target="_blank">\n            <i class="linkType {{icon}}"></i>\n            <span class="icon-stack pull-right">\n                <i class="icon-circle-blank icon-stack-base"></i>\n                <i class="icon-arrow-right"></i>\n            </span>\n            {{link_title}}\n        </a>\n    {{/if}}\n\n</div>\n\n\n\n'}),define("dashboard/personality/recommendation",["backbone","Handlebars","dashboard/widgets/base","text!./recommendation.hbs","text!./recommendation-details.hbs","composite_views/perch","core"],function(e,t,i,n,s,r,o){var a,l,c,h;return l="recommendation",c="#ActionRecommendationLink",h=t.compile(s),a=i.extend({className:l,events:{"click .widget":"onClick"},render:function(){var e;switch(this.$el.html(n),e=this.model.attributes,e.link_type){case"Book":e.icon="icon-book";break;case"App":e.icon="icon-cloud-download";break;case"Video":e.icon="icon-youtube-play";break;case"Comic":e.icon="icon-smile";break;case"Lecture":e.icon="icon-bullhorn"}return this._detailsMarkup=h(e),this},onSync:function(e){return e.attributes.sentence?this.render():void 0},onClick:function(){return this._detailsMarkup?(r.show({content:this._detailsMarkup,btn1Text:null,supressTracking:!0,large:!0}),o.analytics.track(l,"Shown"),$(c).one("click",this.onReccClick)):void 0},onReccClick:function(){return o.analytics.track(l,"External Link Clicked")}}),a.dependsOn="entities/cur_user_recommendations",a}),define("text!dashboard/career/jobs.hbs",[],function(){return'\n\n<div class="widget">\n    <h3>Career Recommendations</h3>\n\n\n    <p class="intro">\n        <i class="bottomIcon icon-briefcase"></i>\n        Based on your personality and interests, you are best suited for careers such as:\n    </p>\n\n    <hr>\n\n    <p class="large recommendation">\n        {{commaList careers}}\n    </p>\n\n</div>\n\n\n'}),define("dashboard/career/jobs",["backbone","Handlebars","text!./jobs.hbs","dashboard/widgets/base","ui_widgets/share"],function(e,t,i,n,s){var r,o;return t.registerHelper("commaList",function(e){var t,i,n,s;for(i="",n=0,s=e.length;s>n;n++)t=e[n],i+=""+t+", ";return i.slice(0,-2)}),o=t.compile(i),r=n.extend({className:"holder doubleWide coolTones career-jobs",events:{"click .icon-briefcase":"onClickBriefcase"},render:function(){var e;return this.$el.html(o(this.model.attributes)),e=new s({data:{title:"My recommended careers are: '"+t.helpers.commaList(this.model.attributes.careers)+"'",text:"You can find out your recommended careers, too, at https://alpha.tidepool.co",link:"https://alpha.tidepool.co"}}),this.$el.append(e.render().el),this},onClickBriefcase:function(){return console.log("Magical briefcase clicked")}}),r.dependsOn="entities/cur_user_career",r}),define("text!dashboard/widgets/lister/lister.hbs",[],function(){return'\n\n<div class="widget lister">\n    <h3>{{title}}</h3>\n\n    <ul {{#icon}}class="icons-ul"{{/icon}}>\n        {{#list}}\n            <li>\n                {{#../icon}}<i class="icon-li icon-ok {{../icon}}"></i>{{/../icon}}{{this}}\n            </li>\n        {{/list}}\n    </ul>\n</div>\n\n\n'}),define("dashboard/widgets/lister/main",["backbone","Handlebars","text!./lister.hbs","dashboard/widgets/base"],function(e,t,i,n){var s,r;return r=t.compile(i),s=n.extend({tagName:"section",renderList:function(e){return e.list&&e.title||console.error("Need data.list and data.title"),this.$el.html(r(e)),this}})}),define("dashboard/widgets/lister",["dashboard/widgets/lister/main"],function(e){return e}),define("dashboard/career/skills",["backbone","dashboard/widgets/lister"],function(e,t){var i;return i=t.extend({className:"coolTones",render:function(){return this.renderList({title:"Skills to Work On",icon:"icon-ok",list:this.model.attributes.skills}),this}}),i.dependsOn="entities/cur_user_career",i}),define("dashboard/career/tools",["backbone","dashboard/widgets/lister"],function(e,t){var i,n;return n=i=t.extend({className:"coolTones",render:function(){return this.renderList({title:"Tools of the Trade",list:this.model.attributes.tools}),this}}),i.dependsOn="entities/cur_user_career",i}),define("text!dashboard/career/reaction_results.hbs",[],function(){return'\n\n<a class="widget hasFooter" href="#game/reaction_time">\n    <h3>Latest Results</h3>\n    <div class="contents"></div>\n    <div class="footer">Play Again</div>\n</a>\n\n\n'}),define("game/results/base",["backbone","Handlebars"],function(e,t){var i,n,s;return s="game/results/base",n="result",t.registerHelper("prettyDate",function(e){var t;return t=new Date(e),t.toLocaleDateString()}),t.registerHelper("prettyTime",function(e){var t;return t=new Date(e),t.toLocaleTimeString()}),i=e.View.extend({className:n,initialize:function(){return this.$el.addClass(n),"function"==typeof this.start?this.start():void 0},render:function(){return null==this.model?this:(this.$el.html(this.tmpl(this.model.attributes)),this)}})}),define("text!game/results/reaction_time.hbs",[],function(){return'\n{{#if showTime}}\n    <p class="subTitle">\n        {{prettyTime time_played}}\n        {{prettyDate time_played}}\n    </p>\n{{/if}}\n\n<div class="metricHolder {{#if showTime}}showingTimeAndTitle{{/if}}">\n    <div class="colHalves">\n        <div class="metric good up" title="Fastest: {{score.fastest_time}}ms">\n            <label>\n                {{score.fastest_time}}\n            </label>\n            <small>Milliseconds</small>\n        </div>\n    </div>\n    <div class="colHalves">\n        <div class="metric bad down" title="Slowest: {{score.slowest_time}}ms">\n            <label>\n                {{score.slowest_time}}\n            </label>\n            <small>Milliseconds</small>\n        </div>\n    </div>\n\n</div>\n\n\n\n'}),define("game/results/reaction_time",["backbone","Handlebars","game/results/base","text!./reaction_time.hbs"],function(e,t,i,n){var s;return s=i.extend({className:"reactionTime",tmpl:t.compile(n)})}),define("dashboard/career/reaction_results",["backbone","Handlebars","text!./reaction_results.hbs","dashboard/widgets/base","game/results/reaction_time"],function(e,t,i,n,s){var r,o,a;return a=t.compile(i),o=".contents",r=n.extend({className:"coolTones reaction-results",render:function(){var e,t;return this.$el.html(a),e=this.collection.at(this.collection.length-1),e.set("showTime",!0),t=new s({model:e}),this.$(o).html(t.render().el),this}}),r.dependsOn="entities/results/results",r.fetchOptions={data:{type:"ReactionTimeResult"}},r}),define("text!dashboard/career/reaction_history.hbs",[],function(){return'\n\n<div class="widget">\n    <h3>Reaction Time History</h3>\n\n</div>\n\n\n'}),define("text!game/results/reaction_time_history.hbs",[],function(){return'\n\n<div class="chartHolder">\n    <ul class="results barChart">\n        {{#results}}\n            <li class="bar slowest"\n                style="height: {{normalizeReactionTime score.slowest_time}}%"\n                title="<span class=\'score\'>{{score.slowest_time}}ms</span>\n                        <span class=\'date\'>{{prettyTime time_played}}<br/>{{prettyDate time_played}}</span>">\n            </li>\n            <li class="bar fastest"\n                style="height: {{normalizeReactionTime score.fastest_time}}%"\n                title="<span class=\'score\'>{{score.fastest_time}}ms</span>\n                        <span class=\'date\'>{{prettyTime time_played}}<br/>{{prettyDate time_played}}</span>">\n            </li>\n        {{/results}}\n    </ul>\n</div>\n<div class="divider">\n    <b class="rule"></b>\n    <p>Time</p>\n    <b class="rule"></b>\n</div>\n\n'}),define("game/results/reaction_time_history",["backbone","Handlebars","game/results/base","text!./reaction_time_history.hbs"],function(e,t,i,n){var s,r,o,a,l;return o=".chartHolder",r=".bar",l=50,a="game/results/reaction_time_history",s=i.extend({className:"reactionTimeHistory",render:function(){return null==this.collection&&console.error("Need a collection"),this.listenTo(this.collection,"sync",this.renderChart),this},renderChart:function(){var e=this;return this.collection.length?(this._compileTemplateForData(),this.$el.html(this.tmpl({max:this.collection.max,min:this.collection.min,results:this.collection.toJSON()})),this._addCallbackToTooltipShow(),this.$(r).tooltip({placement:"right",container:"body",html:!0,animation:!1,afterShow:_.bind(this.onTooltipShow,this)}),setTimeout(function(){return e.$(o).scrollLeft(9999)},l)):(this.remove(),void 0)},_addCallbackToTooltipShow:function(){var e;return e=$.fn.tooltip.Constructor.prototype.show,$.fn.tooltip.Constructor.prototype.show=function(){var t;return e.call(this),"function"==typeof(t=this.options).afterShow?t.afterShow(this.$tip,this.$element):void 0}},_compileTemplateForData:function(){var e;return e=this.collection.max(function(e){return e.attributes.score.slowest_time}),e=e.attributes.score.slowest_time,this.collection.max=e,this.collection.min=0,t.registerHelper("normalizeReactionTime",function(t){var i,n,s;return i=e,n=0,s=100*((t-n)/(i-n)),s=s>95?95:s,Math.round(s)}),this.tmpl=t.compile(n)},onTooltipShow:function(e,t){return e.addClass(t.prop("class"))}})}),define("dashboard/career/reaction_history",["backbone","Handlebars","text!./reaction_history.hbs","dashboard/widgets/base","game/results/reaction_time_history"],function(e,t,i,n,s){var r,o;return o=".widget",r=n.extend({className:"coolTones doubleWide reaction-history",render:function(){var e;return this.$el.html(i),e=new s({collection:this.collection}),this.$(o).append(e.render().el),e.renderChart(),this}}),r.dependsOn="entities/results/results",r.fetchOptions={data:{type:"ReactionTimeResult"}},r}),define("text!game/results/emotions.hbs",[],function(){return'\n\n<i class="emoticon" title="{{ score.display_emotion_friendly }}" />\n<h3>\n    {{{ score.display_emotion_title }}}\n</h3>\n<div class="description">\n    {{{ score.display_emotion_description }}}\n</div>\n\n'}),define("game/results/emotions",["backbone","Handlebars","game/results/base","text!./emotions.hbs","markdown"],function(e,t,i,n,s){var r,o,a;return o=".emoticon",a=200,r=i.extend({className:"emotions",tmpl:t.compile(n),render:function(){var e,t,i=this;return t=_.clone(this.model.attributes.score),t.display_emotion_title&&(t.display_emotion_title=s.toHTML(t.display_emotion_title)),t.display_emotion_description&&(t.display_emotion_description=s.toHTML(t.display_emotion_description)),e=this.model.toJSON(),e.score=t,this.$el.html(this.tmpl(e)),setTimeout(function(){return i.$(o).addClass(i.model.attributes.score.display_emotion_name)},a),this}})}),define("text!dashboard/emotions/highest_emotion.hbs",[],function(){return'\n\n<div class="widget {{className}} hasFooter">\n\n\n    <a class="footer muted" href="#game/emotions">Play Again</a>\n</div>\n'}),define("dashboard/emotions/highest_emotion",["backbone","Handlebars","dashboard/widgets/base","game/results/emotions","text!./highest_emotion.hbs"],function(e,t,i,n,s){var r,o;return o=".widget",r=i.extend({className:"doubleWide tall highestEmotion",render:function(){var e,t;return this.$el.html(s),e=this.collection.at(this.collection.length-1),t=new n({model:e}),this.$(o).append(t.render().el),this}}),r.dependsOn="entities/results/results",r.fetchOptions={data:{type:"EmoResult"}},r}),define("text!game/results/emotions_history.hbs",[],function(){return'\n<legend>\n    <i class="gfx-sun" title="Early Morning"></i>\n    <i class="gfx-moon" title="Late Night"></i>\n</legend>\n<div class="chartHolder">\n    <div class="chart">\n        {{#results}}\n            {{#if score.display_emotion_name }}\n                <div class="slice">\n                    <i class="emoticon small {{ score.display_emotion_name }} {{ timeClass }}"\n                       data-id="{{id}}"\n                       title="<div class=\'emotionsHistory\'>{{prettyDate time_played}} {{prettyTime time_played}} <h3 class=\'emoName\'>{{ score.display_emotion_friendly }}</h3></div>">\n                    </i>\n                </div>\n            {{/if}}\n        {{/results}}\n    </div>\n</div>\n\n'}),define("game/results/emotions_history",["backbone","Handlebars","game/results/base","text!./emotions_history.hbs","composite_views/perch","game/results/emotions"],function(e,t,i,n,s,r){var o,a,l,c,h,u,d,p,f;return u=".chartHolder",p=200,h=".emoticon",d="game/results/emotions_history",f=t.compile(n),o=["time1-morning","time2-earlyDay","time3-lateDay","time4-evening","time5-night","time6-lateNight"],a=["Morning","Early Day","Day","Evening","Night","Late Night"],c=function(e,t){var i,n;switch(i=new Date(e),n=i.getHours()+1){case 5:case 6:case 7:case 8:return t[0];case 9:case 10:case 11:case 12:return t[1];case 13:case 14:case 15:case 16:return t[2];case 17:case 18:case 19:case 20:return t[3];case 21:case 22:case 23:case 24:return t[4];case 1:case 2:case 3:case 4:return t[5];default:return null}},l=i.extend({className:"emotionsHistory",events:{"click .emoticon":"onClickEmoticon"},render:function(){var e=this;return null==this.collection&&console.error("Need a collection"),this.listenTo(this.collection,"sync",this.renderChart),this.$el.append(n),setTimeout(function(){return e.$(u).scrollLeft(9999)},p),this},renderChart:function(){return this.collection.length?(this.collection.each(function(e){return e.set("timeClass",c(e.attributes.time_played,o)),e.set("timeString",c(e.attributes.time_played,a))}),this.$el.html(f({results:this.collection.toJSON()})),this.$(h).tooltip({placement:"right",container:"body",html:!0,animation:!1})):(this.remove(),void 0)},onClickEmoticon:function(t){var i;return i=$(t.target).data("id"),s.show({title:"Emotion Details",btn1Text:null,large:!0,content:new r({model:new e.Model(this.collection.get(i).attributes)})})}})}),define("dashboard/emotions/historical_highest",["backbone","Handlebars","dashboard/widgets/base","game/results/emotions_history"],function(e,t,i,n){var s,r;return r=".widget",s=i.extend({className:"doubleWide historicalHighestEmotion",render:function(){var e;return this.$el.html(this.tmplBase({title:"Your Emotional Timeline"})),e=new n({collection:this.collection}),this.$(r).append(e.render().el),e.renderChart(),this}}),s.dependsOn="entities/results/results",s.fetchOptions={data:{type:"EmoResult"}},s}),define("charts/pie",["backbone","Handlebars","./chart","text!./chart_with_swatches.hbs","chart"],function(e,t,i,n){var s,r;return r="canvas",s=e.View.extend({tmpl:t.compile(n),className:"chart polarArea",initialize:function(){return this.model=new i(this.options.data,{parse:!0})},render:function(){return this.$el.html(this.tmpl(this.model.attributes)),this._renderChart(this.model.attributes.chartValues),this},_renderChart:function(e){var t,i,n,s,o;return(t=this.$(r))?(s=_.max(e,function(e){return e.value}),s=Math.ceil(s.value),o=_.extend(this.model.attributes.options,{scaleShowLine:!1,scaleShowLabels:!1,scaleOverride:!0,scaleSteps:s,scaleStepWidth:1,scaleStartValue:0}),n=t[0].getContext("2d"),i=new Chart(n).Pie(e,o)):void 0}})}),define("game/results/emotions_overview",["backbone","Handlebars","game/results/base","text!./emotions.hbs","markdown","charts/pie","composite_views/perch"],function(e,t,i,n,s,r,o){var a,l,c,h;return l="Emotions",h=.2,c=5,a=i.extend({className:"emotionsOverview",events:{click:"onClick"},render:function(){return null==this.collection&&console.error("Need a collection"),this.listenTo(this.collection,"sync",this.renderChart),this},renderChart:function(){return this.chart=new r({data:{name:l,chartValues:this._prepareData(this.collection),options:{animation:!1}}}),this.$el.html(this.chart.render().el),this},_prepareData:function(){var e,t,i,n,s,r,o;n=this.collection.at(this.collection.length-1),t=n.attributes.calculations.emo_distances,r=_.map(t,function(e,t){return[t,e]}),r=_.sortBy(r,function(e){return e[1]}),e={},e[r[0][0]]=r[0][1],e[r[1][0]]=r[1][1],e[r[r.length-1][0]]=r[r.length-1][1],e[r[r.length-2][0]]=r[r.length-2][1],e[r[r.length-3][0]]=r[r.length-3][1];for(i in e)o=e[i],s=c-o,s=h>s?h:s+h,e[i]=s;return e},onClick:function(e){return e.stopPropagation(),o.show({title:l,large:!0,btn1Text:null,content:new r({data:{name:l,chartValues:this._prepareData(this.collection),width:450,height:300}})})}})}),define("dashboard/emotions/strongest_emotions",["backbone","dashboard/widgets/base","game/results/emotions_overview"],function(e,t,i){var n,s,r;return r=".widget",s="Emotions",n=t.extend({events:{"click .widget":"onClick"},render:function(){return this.$el.html(this.tmplBase({title:s,className:"pressable"})),this.emotionsOverviewResult=new i({collection:this.collection}),this.$(r).append(this.emotionsOverviewResult.el),this.emotionsOverviewResult.renderChart(),this},onClick:function(){return this.emotionsOverviewResult.$el.trigger("click")},remove:function(){return this.emotionsOverviewResult.remove(),this.remove()}}),n.dependsOn="entities/results/results",n.fetchOptions={data:{type:"EmoResult"}},n}),define("text!dashboard/teasers/reaction_time.hbs",[],function(){return'\n\n<a class="widget hasFooter" href="#game/reaction_time">\n\n    <hgroup class="fancyTitle">\n        <p>The</p>\n        <p><strong>Reaction Time</strong></p>\n        <p>Game</p>\n    </hgroup>\n\n    <img src="images/game/teasers/reaction_time_disc.jpg" alt="3 partially transparent circles"/>\n\n    <p>Think quick, react fast.</p>\n\n    <div class="footer">Play Now</div>\n</a>\n\n\n'}),define("dashboard/teasers/reaction_time",["backbone","Handlebars","text!./reaction_time.hbs","dashboard/widgets/base"],function(e,t,i,n){return n.extend({tmpl:i})}),define("text!dashboard/teasers/emotions.hbs",[],function(){return'\n\n<a class="widget hasFooter" href="#game/emotions">\n\n    <hgroup class="fancyTitle">\n        <p>The</p>\n        <p><strong>Emotions</strong></p>\n        <p>Game</p>\n    </hgroup>\n\n    <img src="images/game/teasers/emotions.jpg" alt="Flower made up of pastel colored circles"/>\n\n    <p>Track your daily emotions.</p>\n\n    <div class="footer">Play Now</div>\n</a>\n\n\n'}),define("dashboard/teasers/emotions",["backbone","Handlebars","text!./emotions.hbs","dashboard/widgets/base"],function(e,t,i,n){return n.extend({tmpl:i,className:"emotions"})}),define("text!dashboard/teasers/personalizations.hbs",[],function(){return'\n\n<div class="widget hasFooter pressable">\n\n    <h2>Let\'s Get Personal-ized.</h2>\n\n    <p>\n        Your productivity, mood, and how you handle stress are all tied to your personality.\n    </p>\n    <p>\n        Set up your prefernces and Tidepool will guide you daily. Your self-improvement starts with your choices.\n    </p>\n\n    <div class="footer">\n        Set Preferences Now\n        <i class="icon-cog"></i>\n    </div>\n</div>\n\n\n'}),define("dashboard/teasers/personalizations",["backbone","Handlebars","text!./personalizations.hbs","dashboard/widgets/base","core"],function(e,t,i,n,s){return n.extend({tmpl:i,className:"twilight doubleWide",events:{click:"onClick"},onClick:function(){return s.trigger("action:showPersonalizations")}})}),define("entities/cur_user_career",["backbone","core","markdown"],function(e,t){var i,n;return n="entities/cur_user_career",i=e.Model.extend({url:""+t.cfg.apiServer+"/api/v1/users/-/recommendations/career",initialize:function(){return this.on("sync",this.onSync),this.on("error",this.onErr)},onSync:function(){},onErr:function(){return console.error(""+n+": Trouble getting model data")}})}),define("entities/cur_user_recommendations",["backbone","core"],function(e,t){var i;return i=e.Model.extend({urlRoot:""+t.cfg.apiServer+"/api/v1/users/-/recommendations",id:"latest"})}),define("entities/cur_user_personality",["backbone","core","markdown"],function(e,t,i){var n,s;return s="entities/cur_user_personality",n=e.Model.extend({url:""+t.cfg.apiServer+"/api/v1/users/-/personality",initialize:function(){return this.on("sync",this.onSync),this.on("error",this.onErr)},parse:function(e){var t,n,s,r,o,a,l;if(n=[],null!=(null!=e?null!=(o=e.profile_description)?o.one_liner:void 0:void 0)&&(e.profile_description.one_liner=i.toHTML(e.profile_description.one_liner)),null!=(null!=e?null!=(a=e.profile_description)?a.bullet_description:void 0:void 0)){for(l=e.profile_description.bullet_description,s=0,r=l.length;r>s;s++)t=l[s],n.push(i.toHTML(t));e.profile_description.bullet_description=n}return e},onSync:function(){},onErr:function(){return console.error(""+s+": Trouble getting the User Personality Model")}})}),define("entities/results/result",["backbone"],function(e){var t,i;return i="entities/results/result",t=e.Model.extend({defaults:{game_id:null,user_id:null,time_played:null}}),t.STATES={pending:"pending",error:"error",done:"done"},t}),define("entities/results/results",["backbone","entities/results/result","core"],function(e,t,i){var n,s;return s="entities/results/results",n=e.Collection.extend({url:function(){return""+i.cfg.apiServer+"/api/v1/users/-/results"},model:t,initialize:function(){return this.on("error",this.onErr)},onErr:function(){return console.error(""+s+": error")}}),n.STATES=t.STATES,n}),define("dashboard/widgetmaster",["underscore","backbone","dashboard/personality/core","dashboard/personality/big5","dashboard/personality/holland6","dashboard/personality/detailed_report","dashboard/personality/recommendation","dashboard/career/jobs","dashboard/career/skills","dashboard/career/tools","dashboard/career/reaction_results","dashboard/career/reaction_history","dashboard/emotions/highest_emotion","dashboard/emotions/historical_highest","dashboard/emotions/strongest_emotions","dashboard/teasers/reaction_time","dashboard/teasers/emotions","dashboard/teasers/personalizations","entities/cur_user_career","entities/cur_user_recommendations","entities/cur_user_personality","entities/results/results"],function(e,t,i,n,s,r,o,a,l,c,h,u,d,p,f,m,g,v,b,_,y,w){var k,S,x,P,C;return C={"dashboard/career/jobs":a,"dashboard/career/skills":l,"dashboard/career/tools":c,"dashboard/career/reaction_results":h,"dashboard/career/reaction_history":u,"dashboard/personality/core":i,"dashboard/personality/big5":n,"dashboard/personality/holland6":s,"dashboard/personality/detailed_report":r,"dashboard/personality/recommendation":o,"dashboard/emotions/highest_emotion":d,"dashboard/emotions/historical_highest":p,"dashboard/emotions/strongest_emotions":f,"dashboard/teasers/reaction_time":m,"dashboard/teasers/emotions":g,"dashboard/teasers/personalizations":v},P={"entities/cur_user_career":b,"entities/cur_user_recommendations":_,"entities/cur_user_personality":y,"entities/results/results":w},S=function(e){var t,i,n;return i=e.dependsOn,n=e.fetchOptions,t=n?""+i+"?fetchOptions="+JSON.stringify(n):i},x="dashboard/widgetmaster",k=t.View.extend({className:"widgetmaster",id:"Widgetmaster",initialize:function(){var e,t,i,n;if(!this.options.widgets)throw new Error("Need @options.widgets");this.dataSources=this._makeModelsFromWidgets(this.options.widgets),this.widgets=this._makeWidgets(this.options.widgets,this.dataSources),i=this.dataSources,n=[];for(t in i)e=i[t],n.push(e.fetch(e.fetchOptions));return n},render:function(){var e,t,i,n;for(this.$el.empty(),n=this.widgets,t=0,i=n.length;i>t;t++)e=n[t],this.$el.append(e.el);return this},_makeModelsFromWidgets:function(e){var t,i,n,s,r,o,a,l,c;for(r={},n={},l=0,c=e.length;c>l;l++)a=e[l],C[a]?(i=C[a],i.dependsOn&&(P[i.dependsOn]?(s=S(i),r[s]=P[i.dependsOn],n[s]=i.fetchOptions):console.error(""+x+": "+a+".dependsOn `"+i.dependsOn+"`, but there is no model loaded with that name"))):console.error(""+x+": no widget available called `"+a+"`");o={};for(s in r)t=r[s],o[s]=new t,o[s].fetchOptions=n[s];return o},_makeWidgets:function(e,i){var n,s,r,o,a,l,c;for(a=[],l=0,c=e.length;c>l;l++)o=e[l],C[o]?(n=C[o],n.dependsOn?(r=S(n),s=i[r],s instanceof t.Model?a.push(new n({model:s})):s instanceof t.Collection?a.push(new n({collection:s})):(console.error(""+x+": This object is neither a collection nor a model: "),console.log(s))):a.push(new n)):console.error(""+x+": no widget available called `"+o+"`");
return a}})}),define("pages/dashboard/mood",["backbone","Handlebars","core","dashboard/widgetmaster"],function(e,t,i,n){var s;return s=e.View.extend({title:"Mood Dashboard",className:"dashboard-mood",initialize:function(){return this.listenTo(i.user,"sync",this.render),i.user.isLoggedIn()?void 0:i.trigger("session:showLogin")},render:function(){return this.widgetmaster=new n({widgets:["dashboard/emotions/highest_emotion","dashboard/emotions/historical_highest","dashboard/emotions/strongest_emotions","dashboard/teasers/reaction_time"]}),this.$el.html(this.widgetmaster.render().el),this}})}),define("pages/dashboard/productivity",["backbone","Handlebars","core","dashboard/widgetmaster"],function(e,t,i,n){var s;return s=e.View.extend({title:"Productivity Dashboard",className:"dashboard-productivity",initialize:function(){return this.listenTo(i.user,"sync",this.render),i.user.isLoggedIn()?void 0:i.trigger("session:showLogin")},render:function(){return this.widgetmaster=new n({widgets:["dashboard/career/reaction_history","dashboard/career/reaction_results","dashboard/teasers/emotions","dashboard/career/jobs","dashboard/career/skills","dashboard/career/tools"]}),this.$el.html(this.widgetmaster.render().el),this}})}),define("pages/dashboard/summary",["backbone","Handlebars","core","dashboard/widgetmaster"],function(e,t,i,n){var s;return s=e.View.extend({title:"Summary Dashboard",className:"dashboard-summary",initialize:function(){return this.listenTo(i.user,"sync",this.render),i.user.isLoggedIn()?void 0:i.trigger("session:showLogin")},render:function(){return this.widgetmaster=new n({widgets:["dashboard/personality/core","dashboard/teasers/personalizations","dashboard/career/reaction_history","dashboard/emotions/historical_highest","dashboard/personality/big5","dashboard/personality/holland6","dashboard/teasers/reaction_time","dashboard/personality/detailed_report"]}),this.$el.html(this.widgetmaster.render().el),this}})}),define("text!pages/about.hbs",[],function(){return'\n<section class="col3rds">\n    <p>\n        All you have to do is play games.\n        <br/>\n        It\'s just that simple.\n    </p>\n    <img src="images/home_page/about-graphics_01.png" alt="Game being played"/>\n</section>\n\n<section class="col3rds">\n    <p>Our patented technology will decode your dominant personality traits, short-term cognitive processes, and your emotions.</p>\n    <img src="images/home_page/about-graphics_02.png" alt="Personality Badges"/>\n</section>\n\n<section class="col3rds">\n    <p>Based on your results, we can help empower your self-improvement.</p>\n    <img src="images/home_page/about-graphics_03.png" alt="Self Improvement Map"/>\n</section>\n\n\n<hr>\n\n\n<span class="shadowWarrior">\n    <a href="#startGame" class="btn btn-large btn-primary">Get Started</a>\n</span>\n\n\n\n\n\n'}),define("pages/about",["backbone","Handlebars","text!./about.hbs"],function(e,t,i){var n;return n=e.View.extend({title:"About Us",className:"aboutPage",initialize:function(){},render:function(){return this.$el.html(i),this}})}),define("text!pages/demographics.hbs",[],function(){return'\n\n<p>Before you start the game, wanna tell us a little about yourself?</p>\n\n<div id="FormRegion"></div>\n\n\n<a id="ActionStartGame" class="btn btn-link btn-large pull-right" href="#game">No thanks, I\'ll do this later.</a>\n\n\n'}),define("pages/demographics-fields",[],function(){return[{string_id:"dob",type:"date",label:"Birthdate"},{string_id:"education",type:"select",label:"Education",options:["High School - Freshman (9)","High School - Sophmore (10)","High School - Junior (11)","High School - Senior (12)","College - Less than 2 yrs","College - Associates","College - Bachelor's","College - Master's","College - Ph.D.","Prefer not to answer"]},{string_id:"handedness",type:"select_by_icon",label:"Handedness",options:[{value:"left",label:"Left",icon:"gfx-lefthand"},{value:"right",label:"Right",icon:"gfx-righthand"},{value:"mixed",label:"Mixed",icon:"gfx-bothhands"}]},{string_id:"gender",type:"select_by_icon",label:"Sex",options:[{value:"female",label:"Female",icon:"gfx-female"},{value:"male",label:"Male",icon:"gfx-male"}]}]}),define("pages/demographics",["backbone","Handlebars","text!./demographics.hbs","ui_widgets/formation","./demographics-fields","core"],function(e,t,i,n,s,r){var o,a,l,c,h,u;return a="#FormRegion",h="#ActionStartGame",c='    <a id="ActionStartGame" class="btn btn-large btn-primary btn-alt pull-right" href="#game">Save My Info and Let\'s Go</a>  ',u='<div class="col3rds"></div>',l=[".dob, .education",".handedness",".gender"],o=e.View.extend({title:"Demographics",className:"demographicsPage",events:{"change input":"onChangeInput","change select":"onChangeInput","click #ActionStartGame":"onClickContinue"},initialize:function(){return this.formation=new n({data:s,values:r.user.attributes})},render:function(){return this.$el.html(i),this.$(a).html(this.formation.render().el),this},onDomInsert:function(){return this._wrapGroups()},_wrapGroups:function(){var e,t,i,n;for(n=[],t=0,i=l.length;i>t;t++)e=l[t],n.push($(e).wrapAll(u));return n},onChangeInput:function(){return this._alreadyChanged?void 0:(this.$(h).replaceWith(c),this._alreadyChanged=!0)},onClickContinue:function(){var e,t;return e=this.formation.getVals(),_.isEmpty(e)||(r.user.set(e),r.user.isNew())?void 0:t=r.user.save}})}),define("text!pages/game_results.hbs",[],function(){return'\n<div id="ResultsDisplay" class="results">\n    <p class="textAlignCenter">\n        <b class="holdPlease inline">\n            <i class="icon-repeat icon-4x"></i>\n        </b>\n        <br/>\n    </p>\n    <p class="muted textAlignCenter">\n        Loading Results...\n    </p>\n</div>\n\n<p id="CallToAction" class="textAlignCenter">\n    <a class="btn btn-large btn-primary" href="#dashboard">View My Dashboard</a>\n</p>\n\n'}),define("text!pages/game_results-rt.hbs",[],function(){return'\n\n<b class="gfx-badge">\n    <img src="images/game/teasers/reaction_time_disc.jpg" alt="3 partially transparent circles"/>\n</b>\n\n\n<hgroup class="mainHeading">\n    <h3>Your Results For</h3>\n    <h1>Reaction Time</h1>\n</hgroup>\n\n\n<div id="ResultsDisplay" class="results">\n\n</div>\n\n<div class="explanation">\n    <p class="large"><strong>The Reaction Time Game</strong> Measures the time it takes for your brain to recieve a message and send that message to the muscles in your fingers.</p>\n    <p class="large">Average time for men: 253ms, women: 261ms</p>\n</div>\n\n\n<p id="CallToAction" class="textAlignCenter">\n    <a class="btn btn-large btn-primary btn-alt" href="#dashboard-productivity">Dashboard</a>\n    <a class="btn btn-large btn-primary" href="#game/reaction_time">Play Again</a>\n</p>\n\n'}),define("text!pages/game_results-emo.hbs",[],function(){return'\n\n<b class="gfx-badge">\n    <img src="images/game/teasers/emotions.jpg" alt="3 partially transparent circles"/>\n</b>\n\n\n<hgroup class="mainHeading">\n    <h3>Your Results For</h3>\n    <h1>Emotions</h1>\n</hgroup>\n\n\n<div id="ResultsDisplay" class="results">\n\n</div>\n\n<div class="explanation">\n    <p class="large">\n        Emotional well-being can greatly affect your physical health.\n        Stress, depression, and anxiety can contribute to a host of physical ailments including digestive disorders,\n        sleep disturbances, and lack of energy.\n    </p>\n</div>\n\n\n<p id="CallToAction" class="textAlignCenter">\n    <a class="btn btn-large btn-primary btn-alt" href="#dashboard-mood">Dashboard</a>\n    <a class="btn btn-large btn-primary" href="#game/emotions">Play Again</a>\n</p>\n\n'}),define("text!game/results/personality.hbs",[],function(){return'\n<img\n    class="img-badge"\n    src="/images/badges/{{score.logo_url}}"\n    alt="Badge representing the personalty type of: {{score.name}}"\n    title="Personality game played on {{prettyDate time_played}} at {{prettyTime time_played}} "\n/>\n\n\n<hgroup class="mainHeading">\n    <h3>You are</h3>\n    <h1>{{score.name}}</h1>\n</hgroup>\n\n<div class="explanation">\n    {{{score.one_liner}}}\n</div>\n\n\n'}),define("game/results/personality",["backbone","Handlebars","game/results/base","text!./personality.hbs","markdown"],function(e,t,i,n,s){var r,o;return o="game/results/personality",r=i.extend({className:"personality",tmpl:t.compile(n),start:function(){return this._prepareData()},_prepareData:function(){var e;return e=this.model.get("score"),e.one_liner=s.toHTML(e.one_liner),this.model.set("score",e),this}})}),define("entities/results/game",["backbone","entities/results/result","core","game/results/reaction_time","game/results/personality","game/results/emotions"],function(e,t,i,n,s,r){var o,a,l;return a="entities/results/game",l={ReactionTimeResult:n,PersonalityResult:s,Holland6Result:null,Big5Result:null,SurveyResult:null,EmoResult:r},o=e.Collection.extend({url:function(){return""+i.cfg.apiServer+"/api/v1/users/-/games/"+this.game_id+"/results"},model:t,initialize:function(e){if(null==e.game_id)throw new Error("Need game_id");return this.game_id=e.game_id,this.on("error",this.onErr),this.on("sync",this.onSync)},_makeViewsForModels:function(){return this.each(function(e){var t;return t=l[e.attributes.type],null!=t?e.view=new t({model:e}):null!==t?console.error("No view class has been built and configured for result type `"+e.attributes.type+"`"):void 0})},onSync:function(e,i){var n;return(null!=(n=i.status)?n.state:void 0)===t.STATES.pending?console.error("Data synced but it doesn't look like a result set"):this._makeViewsForModels()},onErr:function(){return console.error(""+a+": error")}})}),define("text!ui_widgets/guest_signup.hbs",[],function(){return'\n\n<p class="textAlignCenter large">\n    Create a free account to see your detailed personality and interests reports.\n</p>\n\n<p class="textAlignCenter">\n    <button class="btn btn-large btn-primary" id="ActionShowSignup">Sign Up</button>\n</p>\n'}),define("ui_widgets/guest_signup",["backbone","text!./guest_signup.hbs","core"],function(e,t,i){var n;return n=e.View.extend({className:"guestSignup",events:{"click #ActionShowSignup":"onClickedSignUp"},initialize:function(){return this.listenTo(i.user,"sync",this.onUserSync)},render:function(){return this.$el.html(t),this},onClickedSignUp:function(){return i.analytics.track(this.className,"Pressed Sign Up"),i.trigger("session:showRegister")},onUserSync:function(e){return e.isGuest()?void 0:i.router.navigate("dashboard",{trigger:!0})}})}),define("pages/game_results",["backbone","Handlebars","text!./game_results.hbs","text!./game_results-rt.hbs","text!./game_results-emo.hbs","entities/results/game","entities/results/results","game/results/reaction_time_history","game/results/emotions_history","game/results/emotions_overview","ui_widgets/psst","core","ui_widgets/guest_signup"],function(e,t,i,n,s,r,o,a,l,c,h,u,d){var p,f,m,g,v;return g="#ResultsDisplay",v="#CallToAction",m={pers:"PersonalityResult",rt:"ReactionTimeResult",emo:"EmoResult"},f={ReactionTimeResult:n,EmoResult:s},p=e.View.extend({title:"Results",className:"gameResultsPage",initialize:function(){var e;if(null==(null!=(e=this.options.params)?e.game_id:void 0))throw new Error("Need game_id");return this.collection=new r({game_id:this.options.params.game_id}),this.listenTo(this.collection,"sync",this.onSync),this.listenTo(this.collection,"error",this.onError),this.collection.fetch()},render:function(){var e;return this.$el.html(i),u.user.isGuest()&&(e=new d,this.$(v).html(e.render().el)),this},_renderResults:function(){return this.$(g).empty(),this._hasType(this.collection,m.rt)?this._renderAsType(m.rt):this._hasType(this.collection,m.emo)?this._renderAsType(m.emo):this._hasType(this.collection,m.pers)?this._renderAsType(m.pers):this._renderGeneric(),this},_hasType:function(e,t){return e.find(function(e){return e.attributes.type===t})},_renderGeneric:function(){return this.collection.each(function(e){var t;return this.$(g).append(null!=(t=e.view)?t.render().el:void 0)})},_renderAsType:function(e){var t,i;switch($("body").addClass(""+this.className+"-"+e),null!=f[e]&&this.$el.html(f[e]),this.collection.each(function(e){var t;return this.$(g).append(null!=(t=e.view)?t.render().el:void 0)}),e){case m.rt:return this._appendReactionTimeHistory();case m.emo:return this._appendEmotionCharts();case m.pers:return t=this.collection.find(function(e){return e.attributes.type===m.pers}),i=t.attributes.score.name.split(" ").join("-"),console.log({coll:this.collection.toJSON(),pers:t,stringId:i}),$("body").addClass(""+this.className+"-"+i);default:return console.warn("Unknown type: "+e)}},_appendReactionTimeHistory:function(){var e,t;return t=new o,e=new a({collection:t}),e.collection.fetch({data:{type:m.rt}}),this.$(g).append(e.render().el)},_appendEmotionCharts:function(){var e,t,i;return e=new o,t=new l({collection:e}),i=new c({collection:e}),t.collection.fetch({data:{type:m.emo}}),this.$(g).append(t.render().el),this.$(g).prepend(i.render().el)},onSync:function(e,t){var i;return(null!=t?null!=(i=t.status)?i.state:void 0:void 0)===o.STATES.pending?(this._renderResults(),h({sel:g,title:"Results Are Pending",msg:"Sorry, but for some reason results haven't yet been calculated for game "+e.game_id,type:h.TYPES.error})):e.length?this._renderResults():(this.$(g).empty(),h({sel:g,title:"No Results Found",msg:"Sorry, but we didn't find any results for game "+e.game_id,type:h.TYPES.error}))},onError:function(e){return this.$(g).empty(),h({sel:g,title:"Error Getting Results",msg:"Sorry, but we coudln't get any results for game "+e.game_id,type:h.TYPES.error})}})}),define("text!pages/home.hbs",[],function(){return'\n\n<div class="hero">\n    <h2>\n        Awareness is<br/>\n        the beginning<br/>\n        of improvement.\n    </h2>\n\n    <!--<h1>Meet TidePool.</h1>-->\n\n    <span class="shadowWarrior">\n        <a href="#startGame" class="btn btn-large btn-primary">Get Started</a>\n    </span>\n\n</div>'}),define("pages/home",["backbone","Handlebars","text!./home.hbs"],function(e,t,i){var n;return n=e.View.extend({title:"Home",className:"homePage",tmpl:t.compile(i),render:function(){return this.$el.html(this.tmpl()),this}})}),define("entities/results_calculator",["jquery","backbone","entities/results/result"],function(e,t){var i,n,s;return s="entities/results_calculator",n=20,i=t.Model.extend({STATES:{pending:"pending",error:"error",done:"done"},urlRoot:function(){return""+window.apiServerUrl+"/api/v1/users/-/games/"+this.get("game_id")+"/results"},initialize:function(){return this.attempts=0,this.fetch(),this.on("sync",this.onSync)},pollForProgress:function(t){var i,s=this;return i=e.ajax({type:"GET",url:t}),i.done(function(e,t,i){switch(200!==i.status&&console.log("Unexpected StatusCode: "+i.status),e.status.state){case s.STATES.pending:return s.attempts+=1,s.attempts>=n?s.trigger("error",s,"Timed out waiting for results."):setTimeout(function(){return s.pollForProgress(e.status.link)},500);case s.STATES.done:return s.set("status",e.status);case s.STATES.error:return s.trigger("error",s,e.status.message);default:return s.trigger("error",s,"Unexpected status "+e.status.state)}}),i.fail(function(e,t,i){return this.trigger("error",this,t,{jqXHR:e,textStatus:t,errorThrown:i})})},onSync:function(e){return this.pollForProgress(e.attributes.status.link)}})}),define("text!ui_widgets/steps_remaining.hbs",[],function(){return'\n{{#each levels}}\n    <div\n        class="step {{#isComplete}}completed{{/isComplete}}"\n        title="{{ friendly_name }}"\n    >\n    </div>\n{{/each}}\n\n'}),define("ui_widgets/steps_remaining",["backbone","Handlebars","text!./steps_remaining.hbs"],function(e,t,i){var n,s;return s=t.compile(i),n=e.View.extend({className:"stepsRemaining",initialize:function(){if(!this.collection)throw new Error("Need a collection");return this.listenTo(this.collection,"change:isComplete",this.render)},render:function(){return this.$el.html(s({levels:this.collection.toJSON()})),this},setComplete:function(e){var t;return t=this.collection.at(e),null!=t?t.set("isComplete",!0):void 0}})}),define("text!ui_widgets/proceed.hbs",[],function(){return'\n<i class="icon-circle-blank"></i>\n<i class="icon-arrow-right"></i>'}),define("ui_widgets/proceed",["jquery","backbone","text!./proceed.hbs"],function(e,t,i){var n,s,r;return s="ui_widgets/proceed",r="body",n=t.View.extend({tagName:"button",className:"proceed",events:{click:"onClick"},initialize:function(){return _.bindAll(this,"show","hide")},render:function(){return this.$el.is(":visible")?void 0:(this.$el.html(i),e(r).append(this.el),this.delegateEvents(),this._animateIn(),this)},_animateIn:function(){var e=this;return this.$el.removeClass("bounceIn"),setTimeout(function(){return e.$el.addClass("bounceIn",1)})},onClick:function(){return this.trigger("click")},show:function(){return this.render()},hide:function(){return this.remove()}}),new n}),define("entities/user_event",["underscore","backbone","core"],function(e,t,i){var n,s;return s="entities/user_event",n=t.Model.extend({urlRoot:""+i.cfg.apiServer+"/api/v1/user_events",defaults:function(){return{game_id:null,module:null,stage:null,record_time:(new Date).getTime(),event_desc:"Default Event Description"}},initialize:function(){return this.on("sync",this.onSync),this.on("error",this.onErr)},onSync:function(){},onErr:function(){return console.error(""+s+" error event")}})}),define("game/levels/_base/main",["underscore","backbone","composite_views/perch","ui_widgets/proceed","entities/user_event"],function(e,t,i,n,s){var r,o,a,l;return a="game/levels/_base",o={start:"test_started",interact:"interacted",change:"changed",readyToProceed:"ready_to_proceed",notReadyToProceed:"not_ready_to_proceed",end:"test_completed"},l={ImageRank:"image_rank",CirclesTest:"circles_test",ReactionTime:"reaction_time",Survey:"survey",emotions_circles:"emotions_circles"},r=t.View.extend({initialize:function(){if(null==this.options.assessment||null==this.options.stageNo)throw new Error("Need assessment and stageNo");return null!=this.model.attributes.data&&(this.collection=new t.Collection(this.model.attributes.data)),"function"==typeof this.start?this.start():this.track(o.start)},_close:function(){return n.hide(),null!=this.finalEventData?this.track(o.end,this.finalEventData):this.track(o.end),this.trigger("done"),"function"==typeof this.close&&this.close(),this.remove(),this.options.assessment.nextStage()},checkAllInteracted:function(e){var t;return t=e.filter(function(e){return e.get("interacted")}),t.length===e.length?!0:void 0},readyToProceed:function(){return this.alreadyReady?void 0:(this.alreadyReady=!0,n.show(),this.listenToOnce(n,"click",this._close),this.track(o.readyToProceed))},notReadyToProceed:function(){return this.alreadyReady?(this.alreadyReady=!1,n.hide(),this.stopListening(n),this.track(o.notReadyToProceed)):void 0},track:function(t,i){var n,r;return n={event_desc:t,game_id:this.options.assessment.attributes.id,module:l[this.model.attributes.view_name],stage:this.options.stageNo},r=new s(e.extend(n,i)),r.save()},remove:function(){return n.hide(),this.$el.remove(),this.stopListening(),this}}),r.EVENTS=o,r}),define("game/levels/_base",["game/levels/_base/main"],function(e){return e}),define("text!game/levels/reaction_time_disc/main.hbs",[],function(){return'\n\n<div id="CircleColorizer">\n    <a id="ReactionTimeTarget" class="circle" href="#">\n        <i class="icon-ok icon-4x"></i>\n    </a>\n</div>\n\n\n\n'}),define("text!game/levels/reaction_time_disc/instructions-simple.hbs",[],function(){return'\n<p>\n    Click on the circle as soon as it turns red.\n</p>\n<p class="textAlignCenter">\n    <img src="images/game/instructions/reaction_time_disc_a.jpg" alt="Hand pressing a red disc"/>\n</p>\n'}),define("text!game/levels/reaction_time_disc/instructions-complex.hbs",[],function(){return'\n<p>\n    Click the red circle only when it appears AFTER a yellow circle.\n</p>\n<p class="textAlignCenter">\n    <img src="images/game/instructions/reaction_time_disc_b.jpg" alt="Hand pressing a red disc"/>\n</p>\n'}),define("game/levels/reaction_time_disc/main",["underscore","backbone","Handlebars","game/levels/_base","text!./main.hbs","text!./instructions-simple.hbs","text!./instructions-complex.hbs","composite_views/perch"],function(e,t,i,n,s,r,o,a){var l,c,h,u,d,p,f,m,g,v,b;return g="game/levels/reaction_time_disc",d="#CircleColorizer",b="yellow",v="red",p="target",f="hit",u=750,m=1500,h={simple:"simple",complex:"complex"},c={shown:"circle_shown",correct:"correct_circle_clicked",incorrect:"wrong_circle_clicked"},l=n.extend({className:"reactionTimeDisc",events:{"click #ReactionTimeTarget":"_onCircleClicked","click .target #ReactionTimeTarget":"_onCorrectClick"},start:function(){return this.stageNo=this.options.stageNo,this.assessment=this.options.assessment,this.sequenceType=this.model.get("sequence_type"),this.colorSequence=this.model.get("sequence"),this.sequenceNo=-1,this.numOfSequences=this.colorSequence.length,e.bindAll(this,"_showCircle","_end","_start")},render:function(){var e;return e=this.sequenceType===h.simple?r:o,this.$el.html(s),a.show({content:e,large:!0,btn1Text:"I'm Ready",onClose:this._start,supressTracking:!0}),this},_start:function(){var e,t;return t=function(){var t,i,n,s;for(n=this.colorSequence,s=[],t=0,i=n.length;i>t;t++)e=n[t],s.push(e.color+":"+e.interval);return s}.call(this).slice(0),this.track(n.EVENTS.start,{sequence_type:this.sequenceType,color_sequence:t}),$("#infobox").css("visibility","hidden"),this._waitAndShow()},_showCircle:function(){var e,t,i;if(this.sequenceNo++,this.sequenceNo<this.numOfSequences){if(e=this.colorSequence[this.sequenceNo],i=this.colorSequence[this.sequenceNo-1],this.track(c.shown,{circle_color:e.color,sequence_no:this.sequenceNo,time_interval:e.interval}),$(d).prop("class",e.color),this.sequenceType===h.simple&&e.color===v?$(d).addClass(p):this.sequenceType===h.complex&&e.color===v&&(null!=i?i.color:void 0)===b&&$(d).addClass(p),t=this.sequenceNo+1,t<this.numOfSequences)return this._waitAndShow();if(t===this.numOfSequences)return this._waitAndEnd()}},_waitAndShow:function(){var e;return e=this.colorSequence[this.sequenceNo+1].interval,this.step=setTimeout(this._showCircle,e)},_waitAndEnd:function(){return this.step=setTimeout(this._end,m)},_end:function(){return this.track(n.EVENTS.end,{sequence_no:this.sequenceNo}),this.assessment.nextStage()},_onCircleClicked:function(e){var t,i;return e.preventDefault(),t=this.colorSequence[this.sequenceNo],i=this.colorSequence[this.sequenceNo-1],this.sequenceNo<=0?this._trackIncorrect():this.sequenceType===h.simple&&t.color===v?this._trackCorrect():this.sequenceType===h.complex&&t.color===v&&i.color===b?this._trackCorrect():this._trackIncorrect()},_onCorrectClick:function(){return $(d).addClass(f)},_trackCorrect:function(){var e;return e=this.colorSequence[this.sequenceNo],e.alreadyTracked?void 0:(this.track(c.correct,{circle_color:e.color,sequence_no:this.sequenceNo}),e.alreadyTracked=!0)},_trackIncorrect:function(){var e;return this.track(c.incorrect,{circle_color:(null!=(e=this.colorSequence[this.sequenceNo])?e.color:void 0)||"blank",sequence_no:this.sequenceNo})},close:function(){return this.step?clearTimeout(this.step):void 0}})}),define("game/levels/reaction_time_disc",["game/levels/reaction_time_disc/main"],function(e){return e}),define("text!game/levels/rank_images/main.hbs",[],function(){return'\n\n<ul id="RankingArea" class="rankingArea connectedSortable">\n\n</ul>\n\n<ul id="UnrankedArea" class="unrankedArea connectedSortable">\n\n</ul>\n\n\n'}),define("text!game/levels/rank_images/rankable_image_view.hbs",[],function(){return'\n\n<img src="{{url}}" alt="{{image_id}}" data-id="{{image_id}}" />\n\n\n'}),define("game/levels/rank_images/rankable_image_view",["backbone","Handlebars","text!./rankable_image_view.hbs"],function(e,t,i){var n,s,r,o;return s="game/levels/rank_images/rankable_image_view",r=".rankImages",o=".dropTarget",n=e.View.extend({tmpl:t.compile(i),className:"rankableImage",tagName:"li",initialize:function(){},render:function(){return this.$el.html(this.tmpl(this.model.attributes)),this}})}),define("game/levels/rank_images/rankable_images",["backbone","./rankable_image_view"],function(e,t){var i,n,s,r;return r="game/levels/rank_images/rankable_images Model",n=e.Model.extend({defaults:{rank:null},initialize:function(){return this.view=new t({model:this})}}),s="game/levels/rank_images/rankable_images Collection",i=e.Collection.extend({model:n})}),define("jqueryui/core",["jquery"],function(e){!function(e,t){function i(t,i){var s,r,o,a=t.nodeName.toLowerCase();return"area"===a?(s=t.parentNode,r=s.name,t.href&&r&&"map"===s.nodeName.toLowerCase()?(o=e("img[usemap=#"+r+"]")[0],!!o&&n(o)):!1):(/input|select|textarea|button|object/.test(a)?!t.disabled:"a"===a?t.href||i:i)&&n(t)}function n(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var s=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(i,n){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),n&&n.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var n,s,r=e(this[0]);r.length&&r[0]!==document;){if(n=r.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(s=parseInt(r.css("zIndex"),10),!isNaN(s)&&0!==s))return s;r=r.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++s)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,n){return!!e.data(t,n[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),s=isNaN(n);return(s||n>=0)&&i(t,!s)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(i,n){function s(t,i,n,s){return e.each(r,function(){i-=parseFloat(e.css(t,"padding"+this))||0,n&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var r="Width"===n?["Left","Right"]:["Top","Bottom"],o=n.toLowerCase(),a={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(i){return i===t?a["inner"+n].call(this):this.each(function(){e(this).css(o,s(this,i)+"px")})},e.fn["outer"+n]=function(t,i){return"number"!=typeof t?a["outer"+n].call(this,t):this.each(function(){e(this).css(o,s(this,t,!0,i)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,n){var s,r=e.ui[t].prototype;for(s in n)r.plugins[s]=r.plugins[s]||[],r.plugins[s].push([i,n[s]])},call:function(e,t,i){var n,s=e.plugins[t];if(s&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(n=0;n<s.length;n++)e.options[s[n][0]]&&s[n][1].apply(e.element,i)}},hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",s=!1;return t[n]>0?!0:(t[n]=1,s=t[n]>0,t[n]=0,s)}})}(e)}),define("jqueryui/widget",["jquery"],function(e){!function(e,t){var i=0,n=Array.prototype.slice,s=e.cleanData;e.cleanData=function(t){for(var i,n=0;null!=(i=t[n]);n++)try{e(i).triggerHandler("remove")}catch(r){}s(t)},e.widget=function(t,i,n){var s,r,o,a,l={},c=t.split(".")[0];t=t.split(".")[1],s=c+"-"+t,n||(n=i,i=e.Widget),e.expr[":"][s.toLowerCase()]=function(t){return!!e.data(t,s)},e[c]=e[c]||{},r=e[c][t],o=e[c][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,r,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),a=new i,a.options=e.widget.extend({},a.options),e.each(n,function(t,n){return e.isFunction(n)?(l[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},s=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,r=this._superApply;return this._super=e,this._superApply=s,t=n.apply(this,arguments),this._super=i,this._superApply=r,t}}(),void 0):(l[t]=n,void 0)}),o.prototype=e.widget.extend(a,{widgetEventPrefix:r?a.widgetEventPrefix:t},l,{constructor:o,namespace:c,widgetName:t,widgetFullName:s}),r?(e.each(r._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,o,i._proto)}),delete r._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(i){for(var s,r,o=n.call(arguments,1),a=0,l=o.length;l>a;a++)for(s in o[a])r=o[a][s],o[a].hasOwnProperty(s)&&r!==t&&(i[s]=e.isPlainObject(r)?e.isPlainObject(i[s])?e.widget.extend({},i[s],r):e.widget.extend({},r):r);return i},e.widget.bridge=function(i,s){var r=s.prototype.widgetFullName||i;e.fn[i]=function(o){var a="string"==typeof o,l=n.call(arguments,1),c=this;return o=!a&&l.length?e.widget.extend.apply(null,[o].concat(l)):o,a?this.each(function(){var n,s=e.data(this,r);return s?e.isFunction(s[o])&&"_"!==o.charAt(0)?(n=s[o].apply(s,l),n!==s&&n!==t?(c=n&&n.jquery?c.pushStack(n.get()):n,!1):void 0):e.error("no such method '"+o+"' for "+i+" widget instance"):e.error("cannot call methods on "+i+" prior to initialization; "+"attempted to call method '"+o+"'")}):this.each(function(){var t=e.data(this,r);t?t.option(o||{})._init():e.data(this,r,new s(o,this))}),c}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),n!==this&&(e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")
},_destroy:e.noop,widget:function(){return this.element},option:function(i,n){var s,r,o,a=i;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof i)if(a={},s=i.split("."),i=s.shift(),s.length){for(r=a[i]=e.widget.extend({},this.options[i]),o=0;o<s.length-1;o++)r[s[o]]=r[s[o]]||{},r=r[s[o]];if(i=s.pop(),n===t)return r[i]===t?null:r[i];r[i]=n}else{if(n===t)return this.options[i]===t?null:this.options[i];a[i]=n}return this._setOptions(a),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i,n){var s,r=this;"boolean"!=typeof t&&(n=i,i=t,t=!1),n?(i=s=e(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,s=this.widget()),e.each(n,function(n,o){function a(){return t||r.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?r[o]:o).apply(r,arguments):void 0}"string"!=typeof o&&(a.guid=o.guid=o.guid||a.guid||e.guid++);var l=n.match(/^(\w+)\s*(.*)$/),c=l[1]+r.eventNamespace,h=l[2];h?s.delegate(h,c,a):i.bind(c,a)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,n){var s,r,o=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],r=i.originalEvent)for(s in r)s in i||(i[s]=r[s]);return this.element.trigger(i,n),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(n,s,r){"string"==typeof s&&(s={effect:s});var o,a=s?s===!0||"number"==typeof s?i:s.effect||i:t;s=s||{},"number"==typeof s&&(s={duration:s}),o=!e.isEmptyObject(s),s.complete=r,s.delay&&n.delay(s.delay),o&&e.effects&&e.effects.effect[a]?n[t](s):a!==t&&n[a]?n[a](s.duration,s.easing,r):n.queue(function(i){e(this)[t](),r&&r.call(n[0]),i()})}})}(e)}),define("jqueryui/mouse",["jquery","./widget"],function(e){!function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!t){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,s=1===i.which,r="string"==typeof this.options.cancel&&i.target.nodeName?e(i.target).closest(this.options.cancel).length:!1;return s&&!r&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===e.data(i.target,this.widgetName+".preventClickEvent")&&e.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return n._mouseMove(e)},this._mouseUpDelegate=function(e){return n._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(e)}),define("jqueryui/sortable",["jquery","./core","./mouse","./widget"],function(e){!function(e){function t(e,t,i){return e>t&&t+i>e}function i(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||i(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,i){"disabled"===t?(this.options[t]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var n=null,s=!1,r=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,r.widgetName+"-item")===r?(n=e(this),!1):void 0}),e.data(t.target,r.widgetName+"-item")===r&&(n=e(t.target)),n?!this.options.handle||i||(e(this.options.handle,n).find("*").addBack().each(function(){this===t.target&&(s=!0)}),s)?(this.currentItem=n,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,n){var s,r,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(r=this.document.find("body"),this.storedCursor=r.css("cursor"),r.css("cursor",o.cursor),this.storedStylesheet=e("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(r)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(s=this.containers.length-1;s>=0;s--)this.containers[s]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,n,s,r,o=this.options,a=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-e(document).scrollTop()<o.scrollSensitivity?a=e(document).scrollTop(e(document).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<o.scrollSensitivity&&(a=e(document).scrollTop(e(document).scrollTop()+o.scrollSpeed)),t.pageX-e(document).scrollLeft()<o.scrollSensitivity?a=e(document).scrollLeft(e(document).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<o.scrollSensitivity&&(a=e(document).scrollLeft(e(document).scrollLeft()+o.scrollSpeed))),a!==!1&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(n=this.items[i],s=n.item[0],r=this._intersectsWithPointer(n),r&&n.instance===this.currentContainer&&s!==this.currentItem[0]&&this.placeholder[1===r?"next":"prev"]()[0]!==s&&!e.contains(this.placeholder[0],s)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],s):!0)){if(this.direction=1===r?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(n))break;this._rearrange(t,n),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var n=this,s=this.placeholder.offset(),r=this.options.axis,o={};r&&"x"!==r||(o.left=s.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),r&&"y"!==r||(o.top=s.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){n._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&n.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!n.length&&t.key&&n.push(t.key+"="),n.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},i.each(function(){n.push(e(t.item||this).attr(t.attribute||"id")||"")}),n},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,n=this.positionAbs.top,s=n+this.helperProportions.height,r=e.left,o=r+e.width,a=e.top,l=a+e.height,c=this.offset.click.top,h=this.offset.click.left,u="x"===this.options.axis||n+c>a&&l>n+c,d="y"===this.options.axis||t+h>r&&o>t+h,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:r<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<o&&a<n+this.helperProportions.height/2&&s-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var i="x"===this.options.axis||t(this.positionAbs.top+this.offset.click.top,e.top,e.height),n="y"===this.options.axis||t(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=i&&n,r=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return s?this.floating?o&&"right"===o||"down"===r?2:1:r&&("down"===r?2:1):!1},_intersectsWithSides:function(e){var i=t(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),n=t(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return this.floating&&r?"right"===r&&n||"left"===r&&!n:s&&("down"===s&&i||"up"===s&&!i)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i,n,s,r,o=[],a=[],l=this._connectWith();if(l&&t)for(i=l.length-1;i>=0;i--)for(s=e(l[i]),n=s.length-1;n>=0;n--)r=e.data(s[n],this.widgetFullName),r&&r!==this&&!r.options.disabled&&a.push([e.isFunction(r.options.items)?r.options.items.call(r.element):e(r.options.items,r.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),r]);for(a.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=a.length-1;i>=0;i--)a[i][0].each(function(){o.push(this)});return e(o)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;i<t.length;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,n,s,r,o,a,l,c,h=this.items,u=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(s=e(d[i]),n=s.length-1;n>=0;n--)r=e.data(s[n],this.widgetFullName),r&&r!==this&&!r.options.disabled&&(u.push([e.isFunction(r.options.items)?r.options.items.call(r.element[0],t,{item:this.currentItem}):e(r.options.items,r.element),r]),this.containers.push(r));for(i=u.length-1;i>=0;i--)for(o=u[i][1],a=u[i][0],n=0,c=a.length;c>n;n++)l=e(a[n]),l.data(this.widgetName+"-item",o),h.push({item:l,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,n,s,r;for(i=this.items.length-1;i>=0;i--)n=this.items[i],n.instance!==this.currentContainer&&this.currentContainer&&n.item[0]!==this.currentItem[0]||(s=this.options.toleranceElement?e(this.options.toleranceElement,n.item):n.item,t||(n.width=s.outerWidth(),n.height=s.outerHeight()),r=s.offset(),n.left=r.left,n.top=r.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)r=this.containers[i].element.offset(),this.containers[i].containerCache.left=r.left,this.containers[i].containerCache.top=r.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,n=t.options;n.placeholder&&n.placeholder.constructor!==String||(i=n.placeholder,n.placeholder={element:function(){var n=t.currentItem[0].nodeName.toLowerCase(),s=e("<"+n+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===n?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(s)}):"img"===n&&s.attr("src",t.currentItem.attr("src")),i||s.css("visibility","hidden"),s},update:function(e,s){(!i||n.forcePlaceholderSize)&&(s.height()||s.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),s.width()||s.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(n.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),n.placeholder.update(t,t.placeholder)},_contactContainers:function(n){var s,r,o,a,l,c,h,u,d,p,f=null,m=null;for(s=this.containers.length-1;s>=0;s--)if(!e.contains(this.currentItem[0],this.containers[s].element[0]))if(this._intersectsWith(this.containers[s].containerCache)){if(f&&e.contains(this.containers[s].element[0],f.element[0]))continue;f=this.containers[s],m=s}else this.containers[s].containerCache.over&&(this.containers[s]._trigger("out",n,this._uiHash(this)),this.containers[s].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",n,this._uiHash(this)),this.containers[m].containerCache.over=1);else{for(o=1e4,a=null,p=f.floating||i(this.currentItem),l=p?"left":"top",c=p?"width":"height",h=this.positionAbs[l]+this.offset.click[l],r=this.items.length-1;r>=0;r--)e.contains(this.containers[m].element[0],this.items[r].item[0])&&this.items[r].item[0]!==this.currentItem[0]&&(!p||t(this.positionAbs.top+this.offset.click.top,this.items[r].top,this.items[r].height))&&(u=this.items[r].item.offset()[l],d=!1,Math.abs(u-h)>Math.abs(u+this.items[r][c]-h)&&(d=!0,u+=this.items[r][c]),Math.abs(u-h)<o&&(o=Math.abs(u-h),a=this.items[r],this.direction=d?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[m])return;a?this._rearrange(n,a,null,!0):this._rearrange(n,null,this.containers[m].element,!0),this._trigger("change",n,this._uiHash()),this.containers[m]._trigger("change",n,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",n,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(!n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,n,s=this.options;"parent"===s.containment&&(s.containment=this.helper[0].parentNode),("document"===s.containment||"window"===s.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===s.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===s.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(s.containment)||(t=e(s.containment)[0],i=e(s.containment).offset(),n="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(n?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(n?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"===t?1:-1,s="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(s[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():r?0:s.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():r?0:s.scrollLeft())*n}},_generatePosition:function(t){var i,n,s=this.options,r=t.pageX,o=t.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(r=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(r=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(o=this.containment[3]+this.offset.click.top)),s.grid&&(i=this.originalPageY+Math.round((o-this.originalPageY)/s.grid[1])*s.grid[1],o=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-s.grid[1]:i+s.grid[1]:i,n=this.originalPageX+Math.round((r-this.originalPageX)/s.grid[0])*s.grid[0],r=this.containment?n-this.offset.click.left>=this.containment[0]&&n-this.offset.click.left<=this.containment[2]?n:n-this.offset.click.left>=this.containment[0]?n-s.grid[0]:n+s.grid[0]:n)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(e,t,i,n){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var s=this.counter;this._delay(function(){s===this.counter&&this.refreshPositions(!n)})},_clear:function(e,t){this.reverting=!1;var i,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)("auto"===this._storedCSS[i]||"static"===this._storedCSS[i])&&(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)t||n.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(n.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),i=0;i<n.length;i++)n[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(i=0;i<n.length;i++)n[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}})}(e)}),define("game/levels/rank_images/main",["backbone","Handlebars","game/levels/_base","text!./main.hbs","./rankable_images","entities/user_event","jqueryui/sortable"],function(e,t,i,n,s){var r,o,a,l,c,h,u;return a="game/levels/rank_images",c="#RankingArea",u="#UnrankedArea",h=".connectedSortable",l='<li class="message">Rank from favorite to least favorite by clicking or dragging images.</li>',o={ranked:"image_ranked",unranked:"image_rank_cleared",dragged:"image_drag_start"},r=i.extend({className:"rankImages",start:function(){return this.collection=new s(this.model.get("image_sequence")),_.bindAll(this,"onOver","onSortStart","onSortEnd","onUnrankedImageClick","onRankedImageClick"),this.listenTo(this.collection,"change:rank",this.onRankChange),this.track(i.EVENTS.start,{image_sequence:this.collection.toJSON()})},render:function(){var e=this;return this.$el.html(n),require(["jquiTouchPunch"],function(){return e.collection.each(function(t){return e.$(u).append(t.view.render().el)}),e.$msg=$(l),e._checkOnMsg(),e.$(h).sortable({containment:"."+e.className,placeholder:"rankableImage placeholder",connectWith:h,cancel:"."+e.$msg.prop("class"),over:e.onOver,start:e.onSortStart,stop:e.onSortEnd}),e.$(h).disableSelection(),e.$(u).on("click",".rankableImage",e.onUnrankedImageClick),e.$(c).on("click",".rankableImage",e.onRankedImageClick)}),this},_checkOnMsg:function(){return this.$(c).children().length?this._hideMsg():this._showMsg()},_showMsg:function(){return this.$(c).append(this.$msg)},_hideMsg:function(){return this.$msg.remove()},_checkOnRanks:function(){var e;return this.collection.each(function(e){return e.view.$el.parent(c).length?e.set({rank:e.view.$el.index()}):e.set({rank:e.defaults.rank})}),this._buildRankArrayForServer(),e=this.collection.filter(function(e){var t;return t=e.attributes.rank,t||0===t?!0:void 0}),e.length===this.collection.length?this.readyToProceed():this.notReadyToProceed()},_buildRankArrayForServer:function(){return this.finalEventData={final_rank:this.collection.pluck("rank")}},onUnrankedImageClick:function(e){return this.$(c).append(e.currentTarget),this._checkOnMsg(),this._checkOnRanks()},onRankedImageClick:function(e){return this.$(u).append(e.currentTarget),this._checkOnMsg(),this._checkOnRanks()},onOver:function(){return this._checkOnMsg()
},onSortStart:function(e){var t;return t=$(e.currentTarget).find("img").data("id"),this._trackDragged(t)},onSortEnd:function(){return this._checkOnRanks()},onRankChange:function(e,t){return-1===t?this._trackRankCleared(e.attributes.image_id,e.previous("rank")):this._trackRanked(e.attributes.image_id,t)},_trackRanked:function(e,t){return this.track(o.ranked,{image_no:e,rank:t})},_trackRankCleared:function(e,t){return this.track(o.unranked,{image_no:e,rank:t})},_trackDragged:function(e){return this.track(o.dragged,{image_no:e})}})}),define("game/levels/rank_images",["game/levels/rank_images/main"],function(e){return e}),define("entities/circles",["backbone"],function(e){var t,i,n;return n="game/levels/circle_proximity/circles",i=e.Model.extend({maxSize:4,baseSizePx:75,sizeToScale:[.4,.7,1,1.3,1.6],sizeToClass:["size1","size2","size3","size4","size5"],defaults:{selfProximityPx:null,selfProximityRank:null,selfOverlapPx:null,selfOverlapRatio:null,image:null,userChangedSize:!1,userChangedPos:!1,width:null,top:0,left:0,pos:{x:0,y:0}},initialize:function(){return this._calcAbbreviation(),this._calcImageUrl(),this.set("size",2),this.on("change:size",this.onChangeSize),this.on("change:pos",this.onChangePos)},_calcAbbreviation:function(){var e,t,i;return t=this.get("trait1"),i=this.get("trait2"),t&&i?(t=t.charAt(0),i=i.charAt(0),e=""+t+"<em>/</em>"+i,this.set("abbreviation",e)):void 0},_calcImageUrl:function(){var e;return(e=this.get("image_id"))?this.set("image_url","/images/game/emotions/"+e+".png"):void 0},_setWidthBySize:function(e){return this.set({width:this.sizeToScale[e]*this.baseSizePx})},onChangeSize:function(e,t){return this.set("userChangedSize",!0),this._setWidthBySize(t)},onChangePos:function(){return this.set("userChangedPos",!0)},getScale:function(){return this.sizeToScale[this.get("size")]}}),t=e.Collection.extend({model:i})}),define("text!game/levels/circle_size/instructions.hbs",[],function(){return"<p>\n    You are on a roll!\n</p>\n<p>\n    In this next game, each circle represents a psychological trait.\n</p>\n<p>\n    Collapse or expand each circle to show how well each trait describes you.\n</p>\n<p>\n    Make sure to change the size of all five circles.\n</p>\n\n\n\n\n\n\n"}),define("game/levels/circle_size/circle_view",["backbone"],function(e){var t,i;return i="game/levels/circle_proximity/circle_view",t=e.View.extend({className:"circle",initialize:function(){return this.listenTo(this.model,"change:size",this.onChangeSize)},render:function(){return this.$el.html(this.model.get("abbreviation")),this.setClassBySize(this.model.get("size")),this},onChangeSize:function(e,t){return this.setClassBySize(t)},removeSizeClass:function(){var e,t,i,n,s;for(n=this.model.sizeToClass,s=[],t=0,i=n.length;i>t;t++)e=n[t],s.push(this.$el.removeClass(e));return s},setClassBySize:function(e){return this.removeSizeClass(),this.$el.addClass(this.model.sizeToClass[e])}})}),define("text!game/levels/circle_size/sizey_view.hbs",[],function(){return'\n<div class="slider"></div>\n\n<label>\n    {{trait1}}<br/>\n    {{trait2}}\n</label>'}),define("jqueryui/slider",["jquery","./core","./mouse","./widget"],function(e){!function(e){var t=5;e.widget("ui.slider",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,n=this.options,s=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),r="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=[];for(i=n.values&&n.values.length||1,s.length>i&&(s.slice(i).remove(),s=s.slice(0,i)),t=s.length;i>t;t++)o.push(r);this.handles=s.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,i="";t.range?(t.range===!0&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):this.range=e([])},_setupEvents:function(){var e=this.handles.add(this.range).filter("a");this._off(e),this._on(e,this._handleEvents),this._hoverable(e),this._focusable(e)},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,n,s,r,o,a,l,c,h=this,u=this.options;return u.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},n=this._normValueFromMouse(i),s=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(n-h.values(t));(s>i||s===i&&(t===h._lastChangedValue||h.values(t)===u.min))&&(s=i,r=e(this),o=t)}),a=this._start(t,o),a===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,r.addClass("ui-state-active").focus(),l=r.offset(),c=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=c?{left:0,top:0}:{left:t.pageX-l.left-r.width()/2,top:t.pageY-l.top-r.height()/2-(parseInt(r.css("borderTopWidth"),10)||0)-(parseInt(r.css("borderBottomWidth"),10)||0)+(parseInt(r.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,n),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,n,s,r;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/t,n>1&&(n=1),0>n&&(n=0),"vertical"===this.orientation&&(n=1-n),s=this._valueMax()-this._valueMin(),r=this._valueMin()+n*s,this._trimAlignValue(r)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var n,s,r;this.options.values&&this.options.values.length?(n=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>n||1===t&&n>i)&&(i=n),i!==this.values(t)&&(s=this.values(),s[t]=i,r=this._trigger("slide",e,{handle:this.handles[t],value:i,values:s}),n=this.values(t?0:1),r!==!1&&this.values(t,i,!0))):i!==this.value()&&(r=this._trigger("slide",e,{handle:this.handles[t],value:i}),r!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(t,i){var n,s,r;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t),void 0;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(n=this.options.values,s=arguments[0],r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(s[r]),this._change(null,r);this._refreshValue()},_setOption:function(t,i){var n,s=0;switch("range"===t&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(s=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;s>n;n+=1)this._change(null,n);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,n;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(i[n]);return i}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,n=e-i;return 2*Math.abs(i)>=t&&(n+=i>0?t:-t),parseFloat(n.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,n,s,r,o=this.options.range,a=this.options,l=this,c=this._animateOff?!1:a.animate,h={};this.options.values&&this.options.values.length?this.handles.each(function(n){i=100*((l.values(n)-l._valueMin())/(l._valueMax()-l._valueMin())),h["horizontal"===l.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[c?"animate":"css"](h,a.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===n&&l.range.stop(1,1)[c?"animate":"css"]({left:i+"%"},a.animate),1===n&&l.range[c?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:a.animate})):(0===n&&l.range.stop(1,1)[c?"animate":"css"]({bottom:i+"%"},a.animate),1===n&&l.range[c?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:a.animate}))),t=i}):(n=this.value(),s=this._valueMin(),r=this._valueMax(),i=r!==s?100*((n-s)/(r-s)):0,h["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[c?"animate":"css"](h,a.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({width:i+"%"},a.animate),"max"===o&&"horizontal"===this.orientation&&this.range[c?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:a.animate}),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({height:i+"%"},a.animate),"max"===o&&"vertical"===this.orientation&&this.range[c?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:a.animate}))},_handleEvents:{keydown:function(i){var n,s,r,o,a=e(i.target).data("ui-slider-handle-index");switch(i.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(i.target).addClass("ui-state-active"),n=this._start(i,a),n===!1))return}switch(o=this.options.step,s=r=this.options.values&&this.options.values.length?this.values(a):this.value(),i.keyCode){case e.ui.keyCode.HOME:r=this._valueMin();break;case e.ui.keyCode.END:r=this._valueMax();break;case e.ui.keyCode.PAGE_UP:r=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.PAGE_DOWN:r=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(s===this._valueMax())return;r=this._trimAlignValue(s+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(s===this._valueMin())return;r=this._trimAlignValue(s-o)}this._slide(i,a,r)},click:function(e){e.preventDefault()},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}})}(e)}),define("game/levels/circle_size/sizey_view",["backbone","Handlebars","./circle_view","text!./sizey_view.hbs","jqueryui/slider"],function(e,t,i,n){var s,r,o,a;return o="game/levels/circle_proximity/sizey_view",a=".slider",r=".circle",s=e.View.extend({className:"sizey",tmpl:t.compile(n),initialize:function(){return _.bindAll(this,"onSlide"),this.circle=new i({model:this.model})},render:function(){return this.$el.html(this.circle.render().el),this.$el.append(this.tmpl(this.model.attributes)),this.$el.find(a).slider({value:this.model.get("size"),max:this.model.maxSize,slide:this.onSlide}),this},onSlide:function(e,t){return this.model.set({size:t.value})}})}),define("game/levels/circle_size/main",["underscore","backbone","entities/circles","text!./instructions.hbs","./sizey_view","composite_views/perch","ui_widgets/proceed"],function(e,t,i,n,s,r,o){var a,l,c,h;return c="game/levels/circle_size",h=0,l={resized:"circle_resized"},a=t.View.extend({className:"circleSize",initialize:function(){return this.listenTo(this.collection,"change:userChangedSize",this.onChangeUserChangedSize),this.listenTo(this.collection,"change:size",this.onChangeSize),this.listenToOnce(o,"click",this._close),e.bindAll(this,"render"),this.options.showInstructions?r.show({content:n,btn1Text:"I'm Ready",onClose:this.render,mustUseButton:!0,supressTracking:!0}):this.render()},render:function(){var e=this;return this.collection.each(function(t){return t.view=new s({model:t}),e.$el.append(t.view.render().el)}),this},_checkDone:function(){var e;return e=this.collection.filter(function(e){return e.get("userChangedSize")}),e.length>=this.collection.length-h?!0:void 0},_close:function(){return this.collection.each(function(e){var t;return null!=(t=e.view)?"function"==typeof t.remove?t.remove():void 0:void 0}),o.hide(),this.trigger("done"),this.remove()},onChangeSize:function(e,t){return this.options.runner.track(l.resized,{circle_no:e.collection.indexOf(e),new_size:t})},onChangeUserChangedSize:function(){return this._checkDone()?o.show():void 0}})}),define("game/levels/circle_size",["game/levels/circle_size/main"],function(e){return e}),define("text!game/levels/circle_proximity/instructions.hbs",[],function(){return'\n<p>\n    Great!\n</p>\n<p>\n    Now, place the circles that you consider most important closer to the large green circle, and place the less important ones further away.\n</p>\n<p class="textAlignCenter">\n    <img src="images/game/instructions/circle_proximity.jpg" alt="Hand dragging a blue circle towards a green one"/>\n</p>'}),define("text!game/levels/circle_proximity/self.hbs",[],function(){return'\n<div class="line"></div>\n<i class="user gfx-user_circles"></i>\n<div class="borderPatrol"></div>\n\n'}),define("game/levels/circle_proximity/self_view",["backbone","text!./self.hbs"],function(e,t){var i,n,s;return i=e.Model.extend({defaults:{pxSize:200,size:200,top:200,left:0}}),s="game/levels/circle_proximity/self_view",n=e.View.extend({id:"SelfCircle",className:"self",initialize:function(){return this.model=new i},render:function(){return this.$el.html(t),this},_setCssStyling:function(e){return this.$el.css({top:e.top,left:e.left})},_calculateSelfCenter:function(){return this._center={x:this.$el.parent().width()/2,y:this.model.get("top")+this.getSelfRadius()},this._center},getSelfCenter:function(){return this._center||this._calculateSelfCenter()},getSelfRadius:function(){return this._radius||this.model.get("pxSize")/2},position:function(){var e;return e=this.getSelfCenter().x-this.model.get("pxSize")/2,this.model.set({left:e}),this._setCssStyling(this.model.attributes),this}})}),define("text!game/levels/circle_proximity/proxy_view.hbs",[],function(){return'\n\n{{#if image_url}}\n\n    <div class="circle hasImage">\n        {{#if image_url}}\n            <img src="{{image_url}}" alt="Image representing emotion(s)"/>\n        {{/if}}\n    </div>\n\n{{else}}\n\n    <div class="circle">{{{abbreviation}}}</div>\n    <label>\n        <span class="inner">\n            <b class="fluff arrowTop"></b>\n            {{trait1}}<br/>\n            {{trait2}}\n        </span>\n    </label>\n\n{{/if}}\n'}),define("jqueryui/draggable",["jquery","./core","./mouse","./widget"],function(e){!function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(this._trigger("drag",t,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,n=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1),"original"!==this.options.helper||e.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!n||"valid"===this.options.revert&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1):!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,n,s=this.options;return s.containment?"window"===s.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===s.containment?(this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):s.containment.constructor===Array?(this.containment=s.containment,void 0):("parent"===s.containment&&(s.containment=this.helper[0].parentNode),i=e(s.containment),n=i[0],n&&(t="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"===t?1:-1,s="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:s.scrollTop(),left:s.scrollLeft()}),{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*n}},_generatePosition:function(t){var i,n,s,r,o=this.options,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=t.pageX,c=t.pageY;return this.offset.scroll||(this.offset.scroll={top:a.scrollTop(),left:a.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(n=this.relative_container.offset(),i=[this.containment[0]+n.left,this.containment[1]+n.top,this.containment[2]+n.left,this.containment[3]+n.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(c=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(c=i[3]+this.offset.click.top)),o.grid&&(s=o.grid[1]?this.originalPageY+Math.round((c-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,c=i?s-this.offset.click.top>=i[1]||s-this.offset.click.top>i[3]?s:s-this.offset.click.top>=i[1]?s-o.grid[1]:s+o.grid[1]:s,r=o.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,l=i?r-this.offset.click.left>=i[0]||r-this.offset.click.left>i[2]?r:r-this.offset.click.left>=i[0]?r-o.grid[0]:r+o.grid[0]:r)),{top:c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,n){return n=n||this._uiHash(),e.ui.plugin.call(this,t,[i,n]),"drag"===t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var n=e(this).data("ui-draggable"),s=n.options,r=e.extend({},i,{item:n.element});n.sortables=[],e(s.connectToSortable).each(function(){var i=e.data(this,"ui-sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,r))})},stop:function(t,i){var n=e(this).data("ui-draggable"),s=e.extend({},i,{item:n.element});e.each(n.sortables,function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"===n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,s))})},drag:function(t,i){var n=e(this).data("ui-draggable"),s=this;e.each(n.sortables,function(){var r=!1,o=this;this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(r=!0,e.each(n.sortables,function(){return this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this!==o&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(o.instance.element[0],this.instance.element[0])&&(r=!1),r})),r?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(s).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",t),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",t),n.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("ui-draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){var n=e(i.helper),s=e(this).data("ui-draggable").options;n.css("opacity")&&(s._opacity=n.css("opacity")),n.css("opacity",s.opacity)},stop:function(t,i){var n=e(this).data("ui-draggable").options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("ui-draggable"),n=i.options,s=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(n.axis&&"x"===n.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?i.scrollParent[0].scrollTop=s=i.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-i.overflowOffset.top<n.scrollSensitivity&&(i.scrollParent[0].scrollTop=s=i.scrollParent[0].scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?i.scrollParent[0].scrollLeft=s=i.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-i.overflowOffset.left<n.scrollSensitivity&&(i.scrollParent[0].scrollLeft=s=i.scrollParent[0].scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(document).scrollTop()<n.scrollSensitivity?s=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(s=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(document).scrollLeft()<n.scrollSensitivity?s=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(s=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed)))),s!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)
}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var i=e(this),n=i.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:n.top,left:n.left})})},drag:function(t,i){var n,s,r,o,a,l,c,h,u,d,p=e(this).data("ui-draggable"),f=p.options,m=f.snapTolerance,g=i.offset.left,v=g+p.helperProportions.width,b=i.offset.top,_=b+p.helperProportions.height;for(u=p.snapElements.length-1;u>=0;u--)a=p.snapElements[u].left,l=a+p.snapElements[u].width,c=p.snapElements[u].top,h=c+p.snapElements[u].height,a-m>v||g>l+m||c-m>_||b>h+m||!e.contains(p.snapElements[u].item.ownerDocument,p.snapElements[u].item)?(p.snapElements[u].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[u].item})),p.snapElements[u].snapping=!1):("inner"!==f.snapMode&&(n=Math.abs(c-_)<=m,s=Math.abs(h-b)<=m,r=Math.abs(a-v)<=m,o=Math.abs(l-g)<=m,n&&(i.position.top=p._convertPositionTo("relative",{top:c-p.helperProportions.height,left:0}).top-p.margins.top),s&&(i.position.top=p._convertPositionTo("relative",{top:h,left:0}).top-p.margins.top),r&&(i.position.left=p._convertPositionTo("relative",{top:0,left:a-p.helperProportions.width}).left-p.margins.left),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:l}).left-p.margins.left)),d=n||s||r||o,"outer"!==f.snapMode&&(n=Math.abs(c-b)<=m,s=Math.abs(h-_)<=m,r=Math.abs(a-g)<=m,o=Math.abs(l-v)<=m,n&&(i.position.top=p._convertPositionTo("relative",{top:c,left:0}).top-p.margins.top),s&&(i.position.top=p._convertPositionTo("relative",{top:h-p.helperProportions.height,left:0}).top-p.margins.top),r&&(i.position.left=p._convertPositionTo("relative",{top:0,left:a}).left-p.margins.left),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:l-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[u].snapping&&(n||s||r||o||d)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[u].item})),p.snapElements[u].snapping=n||s||r||o||d)}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,i=this.data("ui-draggable").options,n=e.makeArray(e(i.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});n.length&&(t=parseInt(e(n[0]).css("zIndex"),10)||0,e(n).each(function(i){e(this).css("zIndex",t+i)}),this.css("zIndex",t+n.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){var n=e(i.helper),s=e(this).data("ui-draggable").options;n.css("zIndex")&&(s._zIndex=n.css("zIndex")),n.css("zIndex",s.zIndex)},stop:function(t,i){var n=e(this).data("ui-draggable").options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}})}(e)}),define("game/levels/circle_proximity/proxy_view",["underscore","backbone","Handlebars","text!./proxy_view.hbs","jqueryui/draggable"],function(e,t,i,n){var s,r,o,a,l,c,h,u;return u="game/levels/circle_proximity/proxy_view",l=".circle",o="yay",h="fresh",c=".ui-draggable",r={dragStart:"circle_start_move",dragStop:"circle_end_move"},a=function(e,t){var i;return i={x:e.x-t.x,y:e.y-t.y}},s=t.View.extend({className:"proxy "+h,tmpl:i.compile(n),initialize:function(){return e.bindAll(this,"onDragStart","onDrag","onDragStop")},render:function(){var e=this;return this.$el.html(this.tmpl(this.model.attributes)),this.$(l).addClass(this.model.sizeToClass[this.model.attributes.size]),require(["jquiTouchPunch"],function(){return e._makeDraggable()}),this},_makeDraggable:function(){return this.$el.draggable({handle:l,stack:c,start:this.onDragStart,drag:this.onDrag,stop:this.onDragStop})},_shimmerSelf:function(){var e,t=this;if(null!=(e=this.options.selfView)?e.$el:void 0)return this.options.selfView.$el.removeClass(o),setTimeout(function(){return t.options.selfView.$el.addClass(o,1)})},_showLine:function(){return null!=this.options.$line?this.options.$line.show():void 0},_maintainLine:function(e,t){var i,n,s,r,o;if(null!=this.options.$line)return r=this.coordToCenter({x:t.position.left,y:t.position.top}),s=this._calculateDistanceFromSelf(r),o=(s-200)/200,o>1&&(o=1),0>o&&(o=0),o=1-o,n=a(r,this.options.selfView.getSelfCenter()),i=180/Math.PI*Math.acos(n.y/s),n.x>0&&(i*=-1),this.options.$line.css({height:s,opacity:o,"-webkit-transform":"rotate("+i+"deg)","-moz-transform":"rotate("+i+"deg)","-o-transform":"rotate("+i+"deg)","-ms-transform":"rotate("+i+"deg)",transform:"rotate("+i+"deg)"})},_hideLine:function(){return null!=this.options.$line?this.options.$line.hide():void 0},_calculateDistanceFromSelf:function(e){var t,i,n;return n=this.options.selfView.getSelfCenter(),i=a(e,n),t=Math.sqrt(i.x*i.x+i.y*i.y)},_updateModelSelfOverlap:function(){var e,t,i,n,s;return s=this.options.selfView.getSelfRadius(),e=this.getCircleSize()/2,t=this.model.get("selfProximityPx"),s+e>t?(n=s+e-t,n>2*e&&(n=2*e)):n=null,i=n/(2*e),this.model.set({selfOverlapPx:n,selfOverlapRatio:i})},_updateModelPosition:function(e){var t;return t=this.coordToCenter({x:e.left,y:e.top}),this.model.set({pos:{x:t.x,y:t.y},left:e.left,top:e.top,selfProximityPx:Math.round(this._calculateDistanceFromSelf(t))}),this._updateModelSelfOverlap()},onChangePos:function(){},onDragStart:function(){return this.$el.removeClass(h),this._showLine(),this.options.track(r.dragStart,{circle_no:this.model.collection.indexOf(this.model),circle:this.model.toJSON()})},onDrag:function(e,t){return this._maintainLine(e,t)},onDragStop:function(e,t){return this._shimmerSelf(),this._hideLine(),this._updateModelPosition(t.position),this.options.track(r.dragStop,{circle_no:this.model.collection.indexOf(this.model),circle:this.model.toJSON()})},positionByCenter:function(e){var t;return t=this.centerToCoord(e),this.$el.css({left:Math.round(t.x),top:Math.round(t.y)})},getCircleSize:function(){return this._width=this._width||this.$(l).width(),this._width},coordToCenter:function(e){var t,i;return i=this.getCircleSize()/2,t={x:e.x+i,y:e.y+i}},centerToCoord:function(e){var t,i;return i=this.getCircleSize()/2,t={x:e.x-i,y:e.y-i}}})}),define("game/levels/circle_proximity/main",["underscore","backbone","entities/circles","text!./instructions.hbs","composite_views/perch","./self_view","./proxy_view","ui_widgets/proceed"],function(e,t,i,n,s,r,o,a){var l,c,h,u;return u="game/levels/circle_proximity",c={dragStart:"",dragStop:""},h=function(e){return e*Math.PI/180},l=t.View.extend({className:"circleProximity",initialize:function(){return this.listenTo(this.collection,"change:userChangedPos",this.onChangeUserChangedPos),this.listenToOnce(a,"click",this._close),e.bindAll(this,"_renderLevel")},render:function(){return this.options.showInstructions?s.show({content:n,btn1Text:"I'm Ready",large:!0,onClose:this._renderLevel,mustUseButton:!0,supressTracking:!0}):this._renderLevel()},_renderLevel:function(){var t,i=this;return this.selfView=new r,this.$el.html(this.selfView.render().el),this.selfView.position(),this.$line=this.$(".line"),t=this.selfView.$el.width()/2,this.$line.css({left:t,top:t}),this.collection.each(function(t){return t.view=new o({model:t,$line:i.$line,selfView:i.selfView,track:e.bind(i.options.runner.track,i.options.runner)}),i.$el.append(t.view.render().el)}),this._positionCirclesAround(this.selfView.getSelfCenter()),this},_positionCirclesAround:function(e){var t,i,n,s;return t=this.collection.length,s=360/t,i=s/2+270,n=250,this.collection.each(function(t){return t.view.positionByCenter({x:Math.cos(h(i))*n+e.x,y:Math.sin(h(i))*n+e.y}),i+=s})},_checkDone:function(){var e;return e=this.collection.filter(function(e){return e.get("userChangedPos")}),e.length===this.collection.length?!0:void 0},_close:function(){return this.collection.each(function(e){return e.view.remove()}),a.hide(),this.trigger("done"),this.remove()},onChangeUserChangedPos:function(){return this._checkDone()?a.show():void 0}})}),define("game/levels/circle_proximity",["game/levels/circle_proximity/main"],function(e){return e}),define("game/levels/circle_size_and_proximity",["jquery","underscore","backbone","Handlebars","game/levels/_base","entities/circles","game/levels/circle_size","game/levels/circle_proximity"],function(e,t,i,n,s,r,o,a){var l,c,h;return h="game/levels/circle_size_and_proximity",c={startedSizing:"size_circles_started",startedProximity:"move_circles_started"},l=s.extend({className:"circleSizeAndProximity",start:function(){return this.circlesCollection=new r(this.model.get("circles")),this.track(s.EVENTS.start)},render:function(){return this._showCircleSize(),this},_showCircleSize:function(){return this.curView=new o({collection:this.circlesCollection,runner:this,showInstructions:this.options.showInstructions}),this.$el.html(this.curView.el),this.track(c.startedSizing),this.circlesCollection=this.curView.collection,this.listenToOnce(this.curView,"done",this._showCircleProximity)},_showCircleProximity:function(){return this.curView=new a({collection:this.circlesCollection,runner:this,showInstructions:this.options.showInstructions}),this.$el.html(this.curView.el),this.curView.render(),this.track(c.startedProximity,{circles:this.circlesCollection.toJSON()}),this.listenToOnce(this.curView,"done",this.onTestDone)},onTestDone:function(){return this.remove(),this.track(s.EVENTS.end,{circles:this.circlesCollection.toJSON(),self_coord:{top:this.curView.selfView.getSelfCenter().y-this.curView.selfView.getSelfRadius(),left:this.curView.selfView.getSelfCenter().x-this.curView.selfView.getSelfRadius(),size:2*this.curView.selfView.getSelfRadius()}}),this.options.assessment.nextStage()},close:function(){}})}),define("text!ui_widgets/icon_slider.hbs",[],function(){return'\n<p>{{question}}</p>\n<div class="slider"></div>\n<legend>\n    {{#labels}}\n        <label style="left:{{position}}">{{label}}</label>\n    {{/labels}}\n</legend>'}),define("ui_widgets/icon_slider",["backbone","Handlebars","text!./icon_slider.hbs","jqueryui/slider"],function(e,t,i){var n,s,r,o,a,l;return r="ui_widgets/icon_slider",l=t.compile(i),a=".slider",o=".ui-slider-handle",s="yay",n=e.View.extend({className:"iconSlider",initialize:function(){return _.bindAll(this,"onSlide","onStop")},render:function(){return this.$el.html(l(this.model.attributes)),this.$(a).slider({min:1,max:this.model.attributes.steps,range:"min",slide:this.onSlide,stop:this.onStop}),this.$(o).append("<i class='"+this.model.attributes.icon+"'></i>"),this},_shimmer:function(e){return e?(e.removeClass(s),setTimeout(function(){return e.addClass(s,1)})):void 0},onSlide:function(e,t){return this.trigger("slide",{model:this.model,value:t.value})},onStop:function(e,t){return this._shimmer($(t.handle)),this.trigger("stop",{model:this.model,value:t.value})}})}),define("game/levels/alex_trebek/main",["underscore","backbone","game/levels/_base","ui_widgets/icon_slider","ui_widgets/formation/select_by_icon"],function(e,t,i,n,s){var r,o,a,l;return l="game/levels/alex_trebek",r={icon_slider:"icon_slider",select_by_icon:"select_by_icon"},o={icon_slider:n,select_by_icon:s},a=i.extend({className:"alexTrebek",render:function(){var e=this;return this.$el.empty(),null!=this.collection&&this.collection.each(function(t){return e._renderOneQuestion(t)}),this},_renderOneQuestion:function(e){var t,i;if(i=e.attributes.question_type,!o[i])return console.warn(""+i+" is not a known question type");switch(t=new o[i]({model:e}),this.$el.append(t.render().el),i){case r.icon_slider:return this.listenTo(t,"slide",this.onSlide),this.listenTo(t,"stop",this.onChange);case r.select_by_icon:return this.listenTo(t,"change",this.onChange)}},_setDataForServer:function(){return this.finalEventData={questions:this.collection.toJSON()}},onSlide:function(e){return this.track(i.EVENTS.interact,{question_id:e.model.attributes.question_id,question_topic:e.model.attributes.question_topic,answer:e.value})},onChange:function(e){return e.model.set({interacted:!0}),e.model.set("answer",e.value),this.track(i.EVENTS.change,{question_id:e.model.attributes.question_id,question_topic:e.model.attributes.question_topic,answer:e.value}),this.checkAllInteracted(this.collection)&&this.readyToProceed(),this._setDataForServer()}})}),define("game/levels/alex_trebek",["game/levels/alex_trebek/main"],function(e){return e}),define("game/levels/emotions_circles/main",["underscore","backbone","game/levels/_base","entities/circles","game/levels/circle_proximity"],function(e,t,i,n,s){var r,o;return o="game/levels/emotions_circles",r=i.extend({className:"emotionsCircles",start:function(){return this.collection=new n(this.model.attributes.circles),this.collection.each(function(e){return e.set("size",4)}),this.track(i.EVENTS.start,{circles:this.collection.toJSON()})},render:function(){var e=this;return this.circleProximity=new s({collection:this.collection,runner:this,showInstructions:this.options.showInstructions}),this.$el.html(this.circleProximity.el),setTimeout(function(){return e.circleProximity.render()},1),this.listenToOnce(this.circleProximity,"done",this.onTestDone),this},onTestDone:function(){return this.track(i.EVENTS.end,{circles:this.collection.toJSON(),self_coord:{top:this.circleProximity.selfView.getSelfCenter().y-this.circleProximity.selfView.getSelfRadius(),left:this.circleProximity.selfView.getSelfCenter().x-this.circleProximity.selfView.getSelfRadius(),size:2*this.circleProximity.selfView.getSelfRadius()}}),this.remove(),this.options.assessment.nextStage()}})}),define("game/levels/emotions_circles",["game/levels/emotions_circles/main"],function(e){return e}),define("text!game/calculate_results.hbs",[],function(){return'\n<h1>Congratulations!</h1>\n<h3>You have completed the game.</h3>\n<p id="StatusMessage" class="muted">\n    Calculating Results...\n</p>\n\n<b class="holdPlease inline">\n    <i class="icon-repeat icon-4x"></i>\n</b>\n\n'}),define("game/calculate_results",["backbone","Handlebars","text!./calculate_results.hbs","core","composite_views/perch"],function(e,t,i,n,s){var r,o,a;return o="game/calculate_results",a="#StatusMessage",r=e.View.extend({className:"calculateResults",initialize:function(){return this.listenTo(this.model,"change",this.onChange),this.listenTo(this.model,"error",this.onError),n.analytics.track(this.className,"Starting game results calculation")},render:function(){return this.$el.html(i),this},_updateStatusMsg:function(e){return e.attributes.status.message?this.$(a).text(e.attributes.status.message):void 0},_showResults:function(){return n.router.navigate("gameResults/"+this.model.attributes.game_id,{trigger:!0})},_gotGameResults:function(){return n.analytics.track(this.className,"Successfully calculated game results"),this._showResults()},onError:function(e,t){return n.analytics.track(this.className,"Error Getting game results"),s.show({title:"Doh. Pretty Srs Error.",msg:t,btn1Text:"Ok",onClose:function(){return n.router.navigate("home",{trigger:!0})},mustUseButton:!0})},onChange:function(e){return this._updateStatusMsg(e),e.attributes.status.state===e.STATES.done?this._gotGameResults():void 0}})}),define("pages/play_game",["backbone","Handlebars","core","composite_views/perch","entities/results_calculator","ui_widgets/steps_remaining","game/levels/reaction_time_disc","game/levels/rank_images","game/levels/circle_size_and_proximity","game/levels/alex_trebek","game/levels/emotions_circles","game/calculate_results"],function(e,t,i,n,s,r,o,a,l,c,h,u){var d,p,f,m,g,v,b;return g="pages/playGame",v="#HeaderRegion",b={ReactionTime:o,ImageRank:a,CirclesTest:l,Survey:c,emotions_circles:h},f="Play a Game",p=1,m="This short, fun, and interactive assessment helps you discover your personality type.",d=e.View.extend({title:f,className:"playGamePage",initialize:function(){if(!this.options.params)throw new Error("Need params");return this.model=i.user.createGame(this.options.params.def_id),this.listenTo(this.model,"error",this._curGameErr),this.listenTo(this.model,"change:stage_completed",this._onStageChanged)},_showWelcome:function(){var e,t=this;return this._trackLevels(),(null!=(e=this.model.attributes.definition)?e.instructions:void 0)?n.show({title:"Welcome",msg:this.model.attributes.definition.instructions,btn1Text:"Let's Go",onClose:function(){return setTimeout(_.bind(t.model.nextStage,t.model),p)},mustUseButton:!0}):this.model.nextStage()},_onStageChanged:function(e){var t,i,n;return t=e.attributes.stage_completed,i=e.attributes.stages.length,null!=(n=this.stepsRemaining)&&n.setComplete(t),-1===t?this._showWelcome():i>t?this._showLevel(t):t===i?this._calculateResults(e):console.log(""+g+"._curGameSync: unusual curStage: "+t)},_curGameErr:function(){return console.error(""+g+": Error on the curGame model")},_trackLevels:function(){return this.stepsRemaining=new r({collection:new e.Collection(this.model.attributes.stages)}),$(v).append(this.stepsRemaining.render().el),window.steps=this.stepsRemaining},_finishPreviousLevel:function(t){var n;return t&&t instanceof e.View?(t.remove(),n=t.model.get("view_name"),i.analytics.track(this.className,""+n+" Finished")):void 0},_showLevel:function(t){var n,s;if(s=this.model.get("stages")[t],n=b[s.view_name],!n)throw new Error("View Class not found for game level of type "+s.view_name);return this._finishPreviousLevel(this.curLevel),this.curLevel=new n({model:new e.Model(s),assessment:this.model,stageNo:t,showInstructions:this.model.isFirstTimeSeeingLevel(s.view_name)}),this.$el.html(this.curLevel.render().el),this.model.setLevelSeen(s.view_name),i.analytics.track(this.className,"game/1/level/"+t,"levelName",s.view_name),i.analytics.track(this.className,""+s.view_name+" Started")},_calculateResults:function(e){return this.curLevel=new u({game:this.model,model:new s({game_id:e.get("id")})}),this.$el.html(this.curLevel.render().el)},close:function(){var e,t;return null!=(e=this.curLevel)&&"function"==typeof e.close&&e.close(),null!=(t=this.curLevel)?t.remove():void 0}})}),define("text!pages/team.hbs",[],function(){return'\n\n\n<h2>Meet the TidePool Team</h2>\n<p>\n    <div class="coolPerson"><i class="avatar huge"><img src="images/people/galen.jpg" alt="Photo of Team Member"/></i>\n        <p>Galen<br/>Buckwalter</p>\n    </div>\n    <div class="coolPerson"><i class="avatar huge"><img src="images/people/vamsee.jpg" alt="Photo of Team Member"/></i>\n        <p>Vamsee<br/>Nalamothu</p>\n    </div>\n    <div class="coolPerson"><i class="avatar huge"><img src="images/people/kerem.jpg" alt="Photo of Team Member"/></i>\n        <p>Kerem<br/>Karatal</p>\n    </div>\n    <div class="coolPerson"><i class="avatar huge"><img src="images/people/miraj.jpg" alt="Photo of Team Member"/></i>\n        <p>Miraj<br/>Sanghvi</p>\n    </div>\n    <div class="coolPerson"><i class="avatar huge"><img src="images/people/eric.jpg" alt="Photo of Team Member"/></i>\n        <p>Eric<br/>Miller</p>\n    </div>\n    <div class="coolPerson"><i class="avatar huge"><img src="images/people/jenni.jpg" alt="Photo of Team Member"/></i>\n        <p>Jenni<br/>Leder</p>\n    </div>\n</p>\n\n<hr>\n\n<h2>Our Awesome Investors</h2>\n<p>\n    <div class="supercoolPerson"><i class="avatar large"><img src="images/people/md.jpg" alt="Photo of Investor"/></i>\n        <p>Michael Dearing</p>\n        <p class="muted">Harrison Metal</p>\n    </div>\n    <div class="supercoolPerson"><i class="avatar large"><img src="images/people/mike.jpg" alt="Photo of Investor"/></i>\n        <p>Mike Hirshland</p>\n        <p class="muted">Resolute.VC</p>\n    </div>\n    <div class="supercoolPerson"><i class="avatar large"><img src="images/people/tim.jpg" alt="Photo of Investor"/></i>\n        <p>Tim Draper</p>\n        <p class="muted">DFJ</p>\n    </div>\n\n    <br/>\n</p>\n\n<br/>\n\n<h3>And Support From</h3>\n\n<p class="supercoolPerson caps">\n    Diego Berdakin,\n    Dan Gould,\n    Rich Rygg,\n    Jeff Lipp,\n    Jarl Mohn,<br/>\n    Jim & Peggy Davis,\n    Rak Tech Fund,\n    and Amplify\n</p>\n\n\n'}),define("pages/team",["backbone","Handlebars","text!./team.hbs"],function(e,t,i){var n;return n=e.View.extend({title:"Our Team",className:"teamPage",render:function(){return this.$el.html(i),this}})});
//# sourceMappingURL=main.js.map